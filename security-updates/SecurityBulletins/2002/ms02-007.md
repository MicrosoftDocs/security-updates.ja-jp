---
TOCTitle: 'MS02-007'
Title: 'マイクロソフト セキュリティ情報 MS02-007 - 警告'
ms:assetid: 'ms02-007'
ms:contentKeyID: 61228432
ms:mtpsurl: 'https://technet.microsoft.com/ja-JP/library/ms02-007(v=Security.10)'
---


マイクロソフト セキュリティ情報 MS02-007 - 警告
===============================================

SQL Server のリモート データ ソース関数に未チェックのバッファが含まれる
-----------------------------------------------------------------------

公開日: 2002年2月21日 | 最終更新日: 2002年4月2日

#### 概要 :

**このセキュリティ情報の対象となるユーザー** **:**  
Microsoft® SQL Server™ を使用しているデータベース管理者

**脆弱性の影響** **:**  
攻撃者の選択したコードがサーバーで実行される

**最大深刻度** **:**  
中

**推奨する対応策** **:**  
SQL Server 用の更新プログラムを影響を受けるシステムに直ちに適用して下さい。

**影響を受けるソフトウェア** **:**

-   Microsoft SQL Server 7.0
-   Microsoft SQL Server 2000

### 詳細

問題
----


**技術的な説明** **:**  
SQL Server 7.0 および SQL Server 2000 の Structured Query Language (SQL) の機能の 1 つに、リモート データ ソースへ接続できるものがあります。この機能の 1 つは、比較的頻繁に使用されないデータソースに対してリンク サーバーをセット アップせずに、リモート データ ソースへの接続に “ad hoc” 接続を使用できることです。これは低レベルなデータ ソース プロバイダである OLE DB プロバイダを使用することにより可能となります。この機能は、リモート データ ソースに接続するクエリの中で、直接、名前を指定して OLE DB プロバイダを呼び出すことにより、可能となります。  
ad hoc 接続における OLE DB プロバイダ名の処理に未チェックのバッファが存在します。このため、バッファのオーバーランが発生する可能性があり、これは SQL Server サービスを異常終了させる、または SQL Server のセキュリティ コンテキスト内でコードを実行するために利用される可能性があります。SQL Server は様々なセキュリティ コンテキストで実行されるように設定することができますが、既定ではドメイン ユーザーとして実行されます。攻撃者が取得する実際の特権は、実行されているサービスの特定のセキュリティ コンテキストに依存します。  
攻撃者はこの脆弱性を次のいずれかの方法で利用することができます。まず、攻撃者はこの脆弱性の影響を受ける関数の 1 つを呼び出すデータベース クエリを読み込み、実行しようとします。逆に、Web サイトまたはそのほかのデータベースのフロントエンドが任意のクエリにアクセスし、処理するように構成されている場合、攻撃用の不正なパラメータを使用して、攻撃者はクエリがここで問題となっている関数の 1 つを呼び出す入力を提供する可能性があります。

**問題を緩和する要素** **:**

-   この脆弱性による影響は SQL Server サービスの特定の構成により異なります。SQL Server は管理者が選択したセキュリティ コンテキストで実行するように構成することができます。既定で、このコンテキストはドメイン ユーザーです。「最小限の特権管理」 の対応策が講じられている場合、攻撃者がもたらす損害を最小限にすることができます。
-   脆弱性が利用される可能性はセキュリティ上の対応策を講じることによって阻止することができます。具体的には、データベース サーバーで、信頼されないユーザーはそのユーザーが選択したクエリを読み込み、実行することができるべきではありません。さらに、公的にアクセス可能なデータベース クエリは、処理の前にすべての入力をフィルタする必要があります。

**深刻度** **:**

|                     | インターネット サーバー | イントラネット サーバー | クライアント システム |
|---------------------|-------------------------|-------------------------|-----------------------|
| **SQL Server 7.0**  | 中                      | 中                      | 中                    |
| **SQL Server 2000** | 中                      | 中                      | 中                    |

上記の[評価](http://www.microsoft.com/japan/technet/security/policy/rating1.mspx)はこの脆弱性の影響を受けるシステムの種類、システムの典型的な展開形式およびこの脆弱性がシステムに及ぼす影響に基づいています。この脆弱性により、攻撃者はサーバーでコードを実行することができる可能性がありますが、セキュリティ上の対応策が講じられていれば、この脆弱性が利用される可能性、および攻撃が成功した場合にもたらされる損害は制限されます。

**脆弱性識別番号** **:**  
[CAN-2002-0056](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=can-2002-0056)

**テストしたバージョン** **:**  
マイクロソフトは SQL Server 7.0 および SQL Server 2000 のテストを行い、これらの脆弱性による影響を評価しました。それより前のバージョンに関しては[サポート](http://support.microsoft.com/lifecycle/)の対象となっていないため、この脆弱性による影響は不明です。

よく寄せられる質問
------------------


**どのようなことが起こる可能性がありますか?**

これは[バッファ オーバーラン](http://www.microsoft.com/japan/security/glossary.mspx)の脆弱性です。この脆弱性を利用できる攻撃者は、データベースまたはサーバーそのものを制御することができる可能性があります。最悪の場合、攻撃者はデータベースのデータを追加、変更、削除したり、またオペレーティング システムを再構成し、新たなソフトウェアをインストールし、ハード ドライブを再フォーマットすることができる可能性があります。  
しかし、この脆弱性の与える影響の範囲は、セキュリティ上の最善策に従っている場合には大幅に軽減されます。具体的には以下の通りです。

-   SQL Server は、「最小限の特権管理」 の法則に従って一定のセキュリティ コンテキストで実行するように設定することができます。既定で SQL Server は、ドメイン ユーザーのセキュリティ コンテキストで実行されます。ドメイン ユーザーのセキュリティ コンテキストは、サーバー上での権限が非常に制限されています。この対策が取られている場合、攻撃者が攻撃に成功したときに実行される可能性がある操作を制限することができます。
-   この脆弱性の利用するには、攻撃者は自ら作成したクエリをサーバー上でロードし、実行するか、または任意の情報をシステム上の既存のクエリに渡すことができる必要があります。セキュリティ上の最善策としてこれらの両方に対する対策が推奨されます。

**何が原因で起こりますか?**

この脆弱性は、SQL Server が提供するいくつかの関数に未チェックのバッファが含まれるために発生します。具体的には、["アド ホック名"](http://msdn2.microsoft.com/en-us/library/aa213283(sql.80).aspx) (英語情報) を使用したリモート データ ソースへの接続に関連する関数に未チェックのバッファが含まれます。攻撃者は、特別に選択したパラメータでこれらの関数を呼び出すことによって、バッファ オーバーランの状況を作ることができます。

**"アドホック名"** **とは何ですか?**

SQL Server により、様々なプラットフォーム上のリモート データ ソースから情報を引き出すために SQL Server に接続し、データ ウェアハウジング、分析、集計を実行することができます。リモート データ ソースへの接続は、「リンク サーバー」 の接続を通常の接続として確立するか、または比較的頻繁に確立しない接続に対して "アド ホック名" を使用することによって確立することができます。

**その機能の何が問題になっていますか?**

この脆弱性の影響を受ける関数には同じ問題があります。渡される情報が提供されたバッファに合っているかどうかを適切に確認しません。このため、攻撃者はバッファのオーバーランを発生させ、SQL Server プロセス自体のメモリを上書きしてしまうテキストを作成することができます。

**この脆弱性を利用して攻撃者は何ができますか?**

攻撃者が選択したデータの種類によって、以下の 2 つのうちいずれかが起こります。

-   データがランダム データである場合、SQL Server プロセスが異常終了します。
-   データが綿密に選択されたものである場合、攻撃者は SQL Server ソフトウェアの実行中に、それを変更することができます。

**攻撃者がランダムデータをテキストとして送信した場合、通常の操作を回復するためには何が必要ですか?**

管理者は SQL Server サービスを再起動する必要があります。

**攻撃者が綿密に選択したデータを送信し、SQL Server** **ソフトウェアを変更した場合、その新しいソフトウェアで何をすることができますか?**

SQL Server の構成方法によって異なります。既定で SQL Server は特権を所有しないセキュリティ コンテキストで実行されます。 （具体的には、ドメイン ユーザーとして実行されます。）この方法で構成したサーバーに対してこの脆弱性を利用できる攻撃者は、データベースを制御することができるようになりますが、そのほかにはほとんど影響はありません。しかし、管理者が SQL Server をより高いアクセス権限で実行するように設定している場合、攻撃者はこれらの特権が得られる可能性があります。攻撃が成功した場合の潜在的な被害は、SQL Server の構成で 「最小限の特権管理」 の対応策がとられている程度に比例することになります。

**攻撃者はどのようにしてこの脆弱性を利用しますか?**

攻撃者がこの脆弱性を利用しようとする方法はいくつかあります。最も直接的な攻撃の方法は、攻撃者が影響を受ける関数の 1 つを呼び出し、バッファのオーバーラン攻撃を実行するクエリを作成することです。しかし、これを成功させるためには、信頼されないユーザーがそのユーザ自身の選択したクエリをロードし、実行できるようにサーバーを構成する必要があります。信頼されないユーザーがそのユーザ自身の作成したクエリをロードし、実行しないようにセキュリティ上の最善策を講じることが強く推奨されます。

**攻撃者がこの脆弱性を利用するそのほかの方法はありますか?**

攻撃者が任意のクエリをロードし、実行することができない場合、攻撃者はシステムに既にあるクエリを使用してこの脆弱性を利用しようとする可能性があります。  
たとえば、データベースが Web ベースの検索ツールの一部で、問題になっている関数の 1 つがその Web サイトで呼び出される場合、攻撃者はこの脆弱性を利用できるクエリを作成しようとする可能性があります。しかし、このようなクエリを作成するためには、Web サイトの検索機能の内部に関する詳しい知識が必要になります。  
あるサイトで入力の適切なチェックを行わない Web ベースのクエリが実装されている場合、攻撃者は影響を受ける関数の呼び出しを含むデータベース コマンドを、データベース クエリ パラメータに組み込むことができる可能性があります。これにより、データベース サーバーに入力パラメータを渡す前に、それをチェックすることの重要性が示されます。

**更新プログラムは何を修正しますか?**

更新プログラムは、影響を受ける関数に適切なチェック機能を実装することによって、この脆弱性を排除します。

更新プログラム
--------------


-   SQL Server 7.0:
    この問題に対する修正は SQL Server 7.0 Service Pack 4 以降に含まれています。

    なお、個別の更新プログラムは以下の Web サイトから入手できます。全ての言語環境に適用することができます。

    この問題に対する修正は次のリンク先の SQL Server 7.0 の累積的な更新プログラムに含まれています。

    <http://support.microsoft.com/kb/318268>
-   SQL Server 2000:
    この問題に対する修正は SQL Server 2000 Service Pack 3 以降に含まれています。SQL Server 2000 日本語版の最新の Service Pack は、以下の Web サイトから入手できます。

    <http://www.microsoft.com/japan/sql/prodinfo/previousversions/downloads/70/sp3.mspx>
    なお、個別の更新プログラムは以下の Web サイトから入手できます。全ての言語環境に適用することができます。

    この問題に対する修正は次のリンク先の SQL Server 2000 の累積的な更新プログラムに含まれています。

    <http://support.microsoft.com/kb/316333>

#### 更新プログラムに関する追加情報

**対象プラットフォーム** **:**

-   SQL Server 7.0 用の更新プログラムは SQL Server 7.0 [Service Pack 3](http://www.microsoft.com/japan/sql/prodinfo/previousversions/downloads/70/sp3.mspx) を実行しているシステムにインストールすることができます。
-   SQL Server 2000 用の更新プログラムは SQL Server 2000 [Service Pack 2](http://www.microsoft.com/japan/sql/prodinfo/previousversions/downloads/2000/sp2.mspx) を実行しているシステムにインストールすることができます。

**この更新プログラムを含む予定のサービスパック** **:**

-   SQL Server 7.0 Service Pack 4 に含まれています。
-   SQL Server 2000 Service Pack 3 に含まれています。

**再起動の必要性** **:**  
なし。この更新プログラムの適用後、SQL Server サービスのみを再起動する必要があります。

**更新プログラムに含まれる過去の修正** **:**  
[MS01-060](http://technet.microsoft.com/security/bulletin/ms01-060)

**更新プログラムが正しくインストールされたかどうか確認する方法** **:**  
SQL Server 7.0 :

-   更新プログラムが正しくインストールされたかどうかを確認するためには、コマンド プロンプトから次のコマンドを実行して下さい。

    -   "SELECT @@VERSION" (引用符は必要ありません。)

    更新プログラムが正しくインストールされている場合、"SQL Server 7.00 - 7.00.1021" またはそれ
    以降のバージョン番号が表示されます。

-   各ファイルを確認するためには、マイクロソフト サポート技術情報 [317979](http://support.microsoft.com/kb/317979) のファイル Manifest にあるファイルの日付/時間のタイム スタンプを参照して下さい。

SQL Server 2000 :

-   更新プログラムが正しくインストールされたかどうかを確認するためには、コマンド プロンプトから次のコマンドを実行して下さい。

    -   "SELECT @@VERSION" (引用符は必要ありません。)

    更新プログラムが正しくインストールされている場合、"SQL Server 8.00 - 8.00.0578" またはそれ
    以降のバージョン番号が表示されます。

-   各ファイルを確認するためには、マイクロソフト サポート技術情報 [317979](http://support.microsoft.com/kb/317979) のファイル Manifest にあるファイルの日付/時間のタイム スタンプを参照して下さい。

**警告** **:**  
空のテーブルに対し、ログに記録されない一括挿入操作を使用するシステムにこの更新プログラムを適用すると、副作用として、データが破損する場合があります。サポート技術情報 [320434](http://support.microsoft.com/kb/320434) で、この問題の詳細を掲載しています。

**他のセキュリティ更新プログラムの入手先** **:**  
他のセキュリティ問題を解決する更新プログラムは以下のサイトから入手できます。

-   セキュリティ更新プログラムはマイクロソフト [ダウンロード センター](http://www.microsoft.com/downloads/results.aspx?displaylang=ja&freetext=security_patch)からダウンロードすることができます。「security\_patch」のキーワード検索によって容易に見つけることができます。
-   コンシューマ プラットフォーム用の更新プログラムは、[Microsoft Update](http://update.microsoft.com/microsoftupdate/)Web サイトからダウンロードできます。

更新プログラムについてのご質問は、マイクロソフト プロダクト サポート までご連絡ください。マイクロソフトでは、ご質問の内容が弊社製品の不具合が原因の場合、サポート料金はいただきません。それ以外の場合には、サポート料金を請求させていただきますのでご注意ください。

[マイクロソフト プロダクト サポートへの連絡方法はこちらをご覧ください。](http://www.microsoft.com/japan/security/support/patchqa.mspx)

### その他の情報

**詳細情報** **:**

-   US マイクロソフトセキュリティ情報（MS02-007）
    [http://www.microsoft.com/technet/security/bulletin/ms02-007.mspx](http://technet.microsoft.com/security/bulletin/ms02-007)
-   サポート技術情報 （KB） 文書番号 ： 317979
    [\[FIX\] リモート データ ソースへの接続時に未チェックのバッファが発生する](http://support.microsoft.com/kb/317979)

**更新履歴** **:**

-   2002/2/21: このセキュリティ情報ページを公開しました。
-   2002/3/1: この問題に対する日本語版 KB を公開しました。
-   2002/4/2: 「警告」 欄を更新し、更新プログラムと一括データ転送に関して、発生する可能性のある問題について情報を追加しました。

本セキュリティ情報に含まれている情報は、いかなる保証もない現状ベースで提供されるものです。Microsoft Corporation 及びその関連会社は、市場性および特定の目的への適合性を含めて、明示的にも黙示的にも、一切の保証をいたしません。さらに、Microsoft Corporation 及びその関連会社は、本文書に含まれている情報の使用及び使用結果につき、正確性、真実性等、いかなる表明・保証も行ないません。Microsoft Corporation、その関連会社及びこれらの権限ある代理人による口頭または書面による一切の情報提供またはアドバイスは、保証を意味するものではなく、かつ上記免責条項の範囲を狭めるものではありません。Microsoft Corporation、その関連会社 及びこれらの者の供給者は、直接的、間接的、偶発的、結果的損害、逸失利益、懲罰的損害、または特別損害を含む全ての損害に対して、状況のいかんを問わず一切責任を負いません。（Microsoft Corporation、その関連会社 またはこれらの者の供給者がかかる損害の発生可能性を了知している場合を含みます。) 結果的損害または偶発的損害に対する責任の免除または制限を認めていない地域においては、上記制限が適用されない場合があります。

*Built at 2014-04-18T01:50:00Z-07:00*
