---
TOCTitle: パフォーマンスの最適化
Title: パフォーマンスの最適化
ms:assetid: '24dc9ca4-652b-41a6-9a99-95fdeca9120b'
ms:contentKeyID: 18122125
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Cc720220(v=WS.10)'
---

パフォーマンスの最適化
======================

このセクションの各トピックでは、RMS のパフォーマンスの最適化について説明します。

ディレクトリ サービス パフォーマンスの最適化
--------------------------------------------

ディレクトリ サービスのパフォーマンスは、RMS に用意されているパフォーマンス カウンタで監視できます。必要な場合は、Active Directory キャッシュの属性を制御するレジストリの設定を変更して、パフォーマンスを最適化できます。

レジストリの設定は、Active Directory キャッシュの次の属性を制御しています。

-   キャッシュに格納可能なプリンシパルの最大数
-   プリンシパルに対してキャッシュに格納された情報の有効期間
-   キャッシュに格納可能なグループの最大数
-   グループに対してキャッシュに格納された情報の有効期間
-   グループ メンバシップの最大エントリ数
-   グループ メンバシップに対してキャッシュに格納された情報の有効期間

一般に、キャッシュに格納される情報の有効期間が長いほど、あるいは、キャッシュに格納されるエントリ数が多いほど、ディレクトリ サービス情報を取得する要求に対して、RMS がすばやく応答できるようになります。情報が Active Directory キャッシュに格納されていれば、逐一 Active Directory に戻って参照する必要がなくなります。これにより、要求に対する応答時間が短縮されます。

Active Directory キャッシュに格納される情報が多くなるほど、その引き替えに大量のメモリ リソースが消費されます。レジストリ設定を構成する際に、もう 1 つ検討すべきことは、アイテムに対して指定された有効期間が長くなるほど、Active Directory キャッシュから返される結果が既に無効になっている可能性が高くなるという点です。これは、Active Directory 内の情報に変更が加えられているにもかかわらず、それが Active Directory キャッシュに反映されていない場合に起こり得る問題です。Active Directory が頻繁に変更される場合は、変更の頻度に応じて、キャッシュに格納される情報の有効期間を短くすることをお勧めします。

ディレクトリ サービスのパフォーマンス カウンタについては、この項目の「[RMS: DirectoryServices パフォーマンス カウンタ](https://technet.microsoft.com/37afea1d-f320-4040-96d8-57c0b45e6d46)」に説明が記載されています。実際の使用手順については、この項目の「[パフォーマンス カウンタの使用](https://technet.microsoft.com/096c3b17-c082-46c4-939c-4373af0c9dec)」を参照してください。パフォーマンス カウンタでは、"キャッシュにヒットした数" 対 "キャッシュでのミス数" を監視することになります。RMS は、キャッシュ ミスのたびに、Active Directory を参照します。

レジストリ設定の詳細とその変更手順については、この項目の「[Active Directory キャッシュ設定の変更](https://technet.microsoft.com/8789a7a5-2065-4fae-9104-e0a70f1f2fb6)」を参照してください。

Active Directory 接続プール設定の最適化
---------------------------------------

Active Directory ライトウェイト ディレクトリ アクセス プロトコル (以下 LDAP) の接続プール設定を制御するレジストリ キーを追加または変更することにより、システム パフォーマンスを向上することができます。レジストリ キーの構成については、この項目の「[接続プール レジストリ設定の変更](https://technet.microsoft.com/c61d91db-a1ad-4ca5-a492-015da629afbc)」を参照してください。

RMS は、LDAP 接続が最適化されるように設計されています。Active Directory の各グローバル カタログにつき 1 つの接続が確立され、それぞれの接続が複数のスレッドを提供します。Active Directory は堅牢さを保つため、要求を処理するための接続プールを維持します。1 つのグローバル カタログに大きな負荷がかかることを避けるため、RMS には、要求を分散させるためのアルゴリズムが使用されています。このアルゴリズムにより、クエリの対象となるグローバル カタログ リスト上の複数のグローバル カタログ間で負荷が分散されます。LDAP エラーも自動的に処理され、要求は、必要に応じて別のグローバル カタログに再ルーティングされます。

RMS では、トポロジ検出アルゴリズムを使ってグローバル カタログ リストが生成されます。RMS サービスが起動する前にトポロジ検出アルゴリズムで検出する必要のあるグローバル カタログの最小数と最大数を指定できます。トポロジ検出アルゴリズムでは、最初に、現在のサイトに存在するグローバル カタログが検出されます。グローバル カタログを追加する必要がある場合は、別のサイトが検索されます。最大接続数を指定して、それを超えた場合、RMS に要求の受け付けを中止させることもできます。クエリの一覧に記載されたグローバル カタログが 1 つでも利用できなくなると、トポロジ検出アルゴリズムによって、代わりのグローバル カタログが検索され、クエリの一覧に追加されます。

また、RMS が使用するグローバル カタログの一覧を直接指定することもできます。この場合、トポロジ検出アルゴリズムは、クエリの一覧に追加するグローバル カタログの検索を実行しません。

RMS が複数のグローバル カタログを使用して負荷分散を行う方法について、設定を構成することもできます。グローバル カタログに特定の要求を送信するかどうかを決定する際には、次の検討事項を比較して、それぞれがどの程度重要であるかを指定します。

-   **ラウンド ロビン (WtRoundRobin)**。このパラメータは、ラウンド ロビンのロジックに基づく、負荷分散の相対的な重要度を指定します。既定の重み設定は 1 で、グローバル カタログの選択時に考慮される重要度が最も低いことを意味します。
-   **接続時のスレッド数 (WtThreadCount)**。このパラメータは、接続に割り当てられるスレッド数に基づく相対的な重要度を指定します。既定の重み設定は 100 です。接続を選択する際には、グローバル カタログのスレッド数が少ないことが重視され、ラウンドロビン ロジックを使用して負荷分散した場合よりも、100 倍の重要度であることを意味します。
-   **低速接続 (WtSlow)**。このパラメータは、低速接続に対する相対的な重要度を指定します。既定の重み設定は 1,000 です。接続を選択する際には、十分な速度が出ていることが重視され、スレッド数が少ないことよりも 10 倍の重要度であることを意味します。
