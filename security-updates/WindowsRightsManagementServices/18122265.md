---
TOCTitle: システム回復の準備
Title: システム回復の準備
ms:assetid: '885c047f-1e3b-4bf5-8248-3a4505759cbb'
ms:contentKeyID: 18122265
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Cc747659(v=WS.10)'
---

システム回復の準備
==================

RMS サーバー、RMS 証明サーバー、サブ登録された RMS ライセンス サーバー、または RMS 構成データベースをホストするデータベース サーバーよって使用されているインターネット接続およびイントラネット接続など、RMS システムのいずれかのコンポーネントに障害が発生すると、予期せずサービスが利用できなくなる場合があります。RMS システムをセットアップする場合は、RMS サービスが利用できなくなったときの IT システムと重要なデータへの影響を考慮し、できる限り効率的にコンポーネントを回復できるように準備することが重要です。

RMS 構成データベースをホストするデータベース サーバーの障害は、RMS で保護された情報へのアクセスが続行できなくなる 1 つの要因です。ここでは、次のような RMS システムの回復準備に関する、重要な注意事項と要素について説明します。

-   [インターネット接続](#bkmk_1)
-   [イントラネット接続](#bkmk_2)
-   [証明サービスとライセンス サービス](#bkmk_3)
-   [データベース サーバー](#bkmk_4)
-   [Active Directory](#bkmk_5)

<span id="BKMK_1"></span>
インターネット接続
------------------

オンラインのサーバー登録を使用している場合、RSM サーバーはサーバー ライセンサ証明書 (以下 SLC) を取得および更新 (1 年に 1 回) するときに、インターネットに接続する必要があります。使用から 1 年に近づくと、システム イベント ログにイベントを記録して証明書を更新するように、証明サーバーから通知されます。イベントは、SLC の有効期限の 1 か月前 (イベント ID 16)、SLC の有効期限の 1 週間前 (イベント ID 17)、および SLC の失効時 (イベント ID 18) にログに記録されます。 RMS 管理 Web サイトの \[RMS グローバル管理\] Web ページでも、SLC の有効期限が近づいていることを知らせる警告メッセージが表示されます。Microsoft Operations Manager (以下 MOM) 用の RMS Management Pack を使用している場合は、有効期限のイベントが発生すると警告メッセージが表示されます。RMS サーバーでインターネット接続を利用できない場合は、RMS 管理 Web サイトの **\[更新\]** をクリックしてサーバー ライセンサ証明書を更新できません。オフライン登録処理を使用して、更新された証明書を要求する必要があります。

最善の手法として、期限の前に余裕を持って SLC を更新しておくと、インターネットに接続できなくて証明書を更新できないといった事態を回避することができます。有効な SLC がないと、RMS サーバーは RMS サービスを提供できません。つまり、ユーザーは RMS で保護された情報を発行したり、RMS で保護された情報の読み取りに必要な使用ライセンスおよび RM アカウント証明書 (以下 RAC) を取得できなくなります。RMS で保護されたコンテンツの使用ライセンスと RAC を事前に取得していたユーザーは、使用ライセンスまたは RAC の有効期限が切れるまで、引き続きそれらの情報にアクセスできます。

<span id="BKMK_2"></span>
イントラネット接続
------------------

RMS は、接続インフラストラクチャに依存するクライアント/サーバー テクノロジです。正常に稼働しているイントラネット ネットワークがないと、RMS サーバーは企業内の必要なサービスに接続することも、サービスを提供するユーザーに接続することもできません。イントラネットがない場合、ユーザーは RMS サーバーから RM アカウント証明書 (以下 RAC)、クライアント ライセンサ証明書 (以下 CLC)、および使用ライセンスを取得できません。

最善の手法として、冗長性のあるルーティング アーキテクチャ、およびリモート サイトから RMS サーバー サイトへのフェールオーバー リンクを展開することを検討してください。

使用しているコンピュータの CLC をユーザーが取得しておけば、RMS サーバーにアクセスできなくても、ユーザーは RMS で保護された情報をオフラインで発行できます。一部の RMS 対応電子メール アプリケーションは、メールボックスを同期するときに、関連する RMS で保護された電子メール メッセージの使用ライセンスを自動的にダウンロードするように設定されています。この場合、ユーザーはイントラネット接続が切断されても、RMS で保護された電子メール メッセージを読むことができます。

<span id="BKMK_3"></span>
証明サービスとライセンス サービス
---------------------------------

RMS システムは、インターネット インフォメーション サービス (以下 IIS) 6.0 の 2 つの仮想ディレクトリ、証明書サービス、およびライセンス サービスに大きく依存しています。これらのサービスにより、ユーザーおよびそのコンピュータを RMS 環境と RMS 対応アプリケーションに登録して、RMS で保護された情報を発行したり、情報にアクセスできるようになります。これらのサービスが使用できなくなった場合、サービスが再び使用可能になるまで、ユーザーはサービスを利用できなくなります。

サービスが利用できなくなるといった事態を避けるため、証明書サーバーとサブ登録されたライセンス サーバーのクラスタを作成して、クラスタ内のあるノードが停止しても、サービスの可用性に影響しないようにします。

最善の手法として、クラスタの処理能力に余裕を持たせて、1 つのノードに障害が発生しても全体のパフォーマンスに影響を与えないようにすることをお勧めします。証明サーバーとサブ登録された各ライセンス サーバーを最初にインストールする場合や、サブ登録されたライセンス サーバを最初にクラスタにインストールする場合は、慎重に構成オプションを記録してデータを入力してください。

<span id="BKMK_4"></span>
データベース サーバー
---------------------

RMS システムで最も重要なコンポーネントは、構成データベースを保有するデータベース サーバーです。各 RMS サーバーまたはサーバー クラスタは、構成情報とログ情報をデータベースに格納します。構成情報は RMS の動作に不可欠です。これらのデータベースには、サーバー ライセンサ証明書、作成済みの RMS ポリシー テンプレート、および RMS システムに登録されているユーザーの一覧が格納されています。RMS サーバーでハードウェア セキュリティ モジュールを使用していない場合、データベースには RMS サーバーの秘密キーおよび公開キーも格納されています。RMS データベースをバックアップすることで、以前の RMS インストールを新しいサーバー上で復元したり、RMS システムを再構築することができます。データベース損失の影響は、データベースごとに異なります。データベース障害が与える影響の一覧を次に示します。

-   **構成データベース**RMS サーバーの稼働中にこのデータベースが使用できなくなっても、RMS では必要な情報がローカルにキャッシュされているため、RMS サービスは動作し続けます。ただし、新しいユーザーの登録など、RMS サービスと構成データベースの連携を必要とするイベントが発生した場合は、RMS サービスでエラーが発生し、新しいユーザーは RMS で保護されたコンテンツを使用できません。IIS サービスの再起動やローカル キャッシュの定期更新など、RMS サーバーがキャッシュされた情報を破棄する操作が行われると、RMS サービスは停止します。構成データベースが使用可能になるまで、RMS サーバーを通常の状態に戻すことはできません。
    構成データベースが破損したり、永続的に使用できなくなったりした場合、RMS サーバーは停止します。
-   **ディレクトリ サービス データベース**グローバル カタログ サーバーから取得したグループ名とそのメンバシップ詳細についてのキャッシュされた情報が格納されます。このテーブルが短時間使用できなくなっても、RMS サービスに大幅な低下はありません。このデータベースの主な目的は、冗長性を持たせてグローバル カタログ サーバーへのサービスの負荷を減らすことです。
-   **ログ データベース**RMS サーバーでログ記録が有効な場合、このデータベースにログが格納されます。このデータベースが使用できない場合、使用可能なディスク領域をすべて使い切るまで、RMS サーバーのメッセージ キュー (MSMQ) サービスにログ エントリが蓄積されます (このように動作しないように設定されていない場合)。

最善の手法として、複数のデータベース サーバーをクラスタ化して、アクティブ/スタンバイ構成にすることで、フェールオーバー保護機能を提供することをお勧めします。また、RMS 証明サーバーおよびクラスタ用データベースと、ライセンス サーバーおよびクラスタ用のデータベースを、定期的にバックアップします。

その他に、トランザクション ログの配布機能を使用して、準備が整ったバックアップ データベースを維持することができます。この場合、追加のハードウェアが必要となる可能性がありますが、より迅速にデータベースを回復できるようになります。マイクロソフトの IT 部門は、RMS 構成データベースを回復するためにこの方法を実装しました。この方法を実装するには、RMS の提供中に仮想 SQL 名を選択します。ドメイン ネーム システム (以下 DNS) を使用することにより、仮想 SQL 名を実際の SQL 名にマッピングできるようになります。元の SQL Server が停止した場合、DNS 名のマッピングを元のサーバーからバックアップ サーバーに変更して、簡単にバックアップ SQL Server に切り替えることができます。マイクロソフトにおけるこのソリューションの実装の詳細については、[マイクロソフトの Web サイト](http://go.microsoft.com/fwlink/?linkid=42070) (http://go.microsoft.com/fwlink/?LinkId=42070) で Microsoft Corporation の例を参照してください。

<span id="BKMK_5"></span>
Active Directory
----------------

RMS は、ユーザー認証サービスとグローバル カタログ サービスという重要な 2 つのサービスについて、Active Directory に依存しています。Active Directory を使用できなくなると、ユーザー認証を実行できなくなり、ユーザーとそのコンピュータを RMS システムに登録できなくなります。RAC の取得には証明パイプラインが必要であり、このパイプラインには認証が必要です。ライセンス パイプラインは既定で匿名なので、RAC を取得したユーザーは、それ以上認証を必要とせずに使用ライセンスを取得できます。

企業エンティティは、Active Directory のグループ メンバシップを使用して、RMS で保護された情報にアクセスするユーザーを表現できます。このため、Active Directory が使用できなくなると、ユーザーは使用ライセンスを取得できなくなります。既定では、グループ メンバシップ情報は RMS サーバーに 15 分間キャッシュされるので、グローバル カタログ サービスが一時的に利用できなくなっても問題はありません。キャッシュの更新間隔を増減させる場合は、有効期間を制御するレジストリ キーを変更します。詳細については、このドキュメント コレクションの「RMS サーバーの運用」にある「Active Directory キャッシュ設定の変更」を参照してください。
