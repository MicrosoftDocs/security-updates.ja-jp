---
TOCTitle: メッセージ キューの監視
Title: メッセージ キューの監視
ms:assetid: 'a7109399-3a84-4681-874b-f6ea1646b0a0'
ms:contentKeyID: 18122322
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Cc747716(v=WS.10)'
---

メッセージ キューの監視
=======================

RMS では、メッセージ キュー (MSMQ) を使用して、ログ データベースにイベントを送信することによりログが記録されます。これは、RMS の各フロント エンド サーバーがメッセージ キュー サービスにメッセージを送信し、各フロント エンド サーバー上のログ リスナ サービスがメッセージ キューのキューからログ メッセージを取得して、それらをログ データベースに書き出すことによって行われます。ログ データベースやデータベース サーバーが使用できなくなった場合、またはログ リスナ サービスが停止した場合は、メッセージ キューがメッセージをキューに格納します。ログ データベースまたはデータベース サーバーをシャットダウンする場合は、まず、各フロント エンド サーバーのログ リスナ サービスをシャットダウンし、データベースまたはデータベース サーバーの再起動後に、各フロント エンド サーバーのログ リスナ サービスを再起動することをお勧めします。

データベースが停止すると、ログ リスナ サービスが実行されていても、ログ リスナ サービスは、データベースにログ メッセージを出力することができません。ログ リスナ サービスは、データベースが利用できるようになるまで、メッセージをメッセージ キューの "配信不能" キューに移動します。データベースが利用できるようになった時点で、"新しい" ログ メッセージがデータベースに出力されます。配信不能キューのメッセージが自動的にログ データベースに出力されることはありません。配信不能キューのメッセージを表示したり、削除したりするには、次の手順に従います。

1.  \[スタート\]ボタンをクリックし、\[すべてのプログラム\]をポイントします。次に、\[管理ツール\]をポイントし、\[コンピュータの管理\]をクリックして、Microsoft 管理コンソール (MMC) でコンピュータの管理スナップインを開きます。
2.  コンソール ツリーの \[サービスとアプリケーション\] の \[メッセージ キュー\] をクリックし、\[専用キュー\] をクリックします。
3.  2 つのキューが表示されます。この 2 つのキューはどちらも、"**drms\_logging**" の後にクラスタ名が付加された名前になります。一方のキューの名前が "**drms\_logging\_***&lt;クラスタ名&gt;***\_deadletter**" という名前に変更されます。これが配信不能キューになります。キュー名をクリックし、\[キュー メッセージ\] キューをクリックします。
4.  各メッセージをダブルクリックすると、対応するプロパティが表示されます。
5.  キューを削除するには、**\[キュー メッセージ\]** キューを右クリックし、**\[すべてのタスク\]**、**\[削除\]** を順にクリックします。

既定の構成では、メッセージ キューは、サーバー上に空きディスク領域がなくなるまで、キュー メッセージを格納し続けます。メッセージ キューが空きディスク領域を使い切ると、RMS サーバーはクライアント要求を処理できなくなります。これを防ぐには、次の手順に従って、メッセージ キューがキューの処理に使用可能なディスク領域を制限します。

1.  \[スタート\] ボタンをクリックし、\[すべてのプログラム\] をポイントします。次に、\[管理ツール\] をポイントし、\[コンピュータの管理\] をクリックして、Microsoft 管理コンソール (MMC) でコンピュータの管理スナップインを開きます。
2.  コンソール ツリーの \[サービスとアプリケーション\] の \[メッセージ キュー\] をクリックし、\[専用キュー\] をクリックします。
3.  2 つのキューが表示されます。キューの名前には、どちらも先頭に "drms\_logging" が付きます。各キューについて、次の手順を実施します。
    -   \[プロパティ\] をクリックします。
    -   \[メッセージの記憶域の最大サイズ (KB)\] チェックボックスをオンにし、キューに格納可能なすべてのキュー メッセージの合計サイズを KB 単位で入力します。

キューがいっぱいになった場合、RMS から送信されたメッセージが破棄され、イベント ID 48 に関連付けられた、次のイベント メッセージが システム イベント ログに送信されます。

"メッセージ キューへのプロパティ バッグの送信に失敗しました。"

これはログ データベースに問題が発生していることを示しています。このイベントが発生したら警告が表示されるように、システム監視ツールを構成することをお勧めします。
