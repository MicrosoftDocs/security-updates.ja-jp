---
TOCTitle: 最初のサーバーの証明サービスとライセンス サービスのセットアップ
Title: 最初のサーバーの証明サービスとライセンス サービスのセットアップ
ms:assetid: 'cce29a2f-984f-48ed-9187-0eb68286ec5b'
ms:contentKeyID: 18122362
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Cc747756(v=WS.10)'
---

最初のサーバーの証明サービスとライセンス サービスのセットアップ
===============================================================

フォレスト内に RMS をセットアップするには、最初に 1 つのサーバーをインストールして提供します。展開する最初のサーバーは、ルート証明サーバーです。このサーバーは、証明とライセンスの両方をサポートし、単一サーバー構成による単独のサーバーとして使用するか、またはルート証明クラスタの最初のサーバーとして使用できます。

追加の RMS サーバーをインストールおよび提供するために必要なロール、アクセス許可、権利
-------------------------------------------------------------------------------------

RMS をインストールするには、ローカル管理者特権を持つアカウントを使用してログオンします。さらに、Active Directory に RMS を認証させるには、有効なドメイン アカウントを使用してドメインにログオンする必要があります。RMS を展開する環境の Active Directory インフラストラクチャで Windows 2000 のネイティブ モードが使用されている場合は、Active Directory がグループ メンバシップを拡張するときに、RMS が Active Directory オブジェクトの memberOf 属性を読み取れない可能性があります。RMS で memberOf 属性を読み取れるようにするには、RMS サービス アカウントが、フォレスト内の Pre-Windows 2000 Compatible Access グループのメンバである必要があります。非表示のメンバシップを含むグループを展開した場合、非表示のメンバシップを読み取ることができるアクセス許可を持つ RMS サービス アカウントを構成する必要があります。

| ![](images/Cc747756.note(WS.10).gif)注                                                       |
|---------------------------------------------------------------------------------------------------------------------------|
| RMS をインストールするのに使用したものと同じドメイン アカウントを RMS サービス アカウントとして使用することはできません。 |

最初のサーバーのインストールおよび提供処理
------------------------------------------

RMS サーバーの展開は 2 つの手順に従って行います。まず、RMS サーバー ソフトウェアを、IIS、メッセージ キュー、ASP.NET などのサポート ソフトウェアと一緒にインストールします。インストールの詳細については、このドキュメント コレクションの「RMS サーバーの運用」にある「RMS Service Pack 1 をインストールするには」を参照してください。

| ![](images/Cc747756.note(WS.10).gif)注                                                                                                                                            |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| RMS は、コマンド プロンプトからインストールすることもできます。詳細については、このドキュメント コレクションの「RMS サーバーの運用」にある「コマンド プロンプトによる RMS のインストール」を参照してください。 |

サーバーに RMS をインストールした後、サーバー上の 1 つの Web サイトで使用するように RMS を提供する必要があります。この Web サイトを提供すると、Web サイトの設定の多くが変更され、仮想ディレクトリが追加されます。これらの変更については、このドキュメント コレクションの「RMS テクニカル リファレンス」にある「RMS のためのインターネット インフォメーション サービス のサポート」を参照してください。

IIS 内の既定の Web サイトを使用するか、または新しい Web サイトを作成できます。既定の Web サイト以外のサイトに RMS を提供するには、この提供処理を開始する前に Web サイトを作成する必要があります。既定の Web サイトを他の目的に使用する場合は、RMS 用に新しいサイトを作成して、既定の Web サイトの既定の構成が保持されるようにしてください。

**\[スタート\]** メニューで **\[Windows RMS 管理\]** をクリックすると、**\[グローバル管理\]** ページが表示されます。このページで、Web サイト上の提供処理を開始できます。最初の RMS サーバーを提供するには、次の情報を指定します。

-   RMS の構成データベース、ログ データベース、およびディレクトリ サービス データベースに使用するデータベースの名前を指定します。
    SQL Server インスタンスの名前がローカル サーバー名と同じでない場合は、すべてのコンポーネントが単一のサーバーにインストールされている場合でも、リモート SQL Server インスタンスをセットアップする必要があります。
    提供時、現在ログオンしているユーザー アカウントには、データベース サーバーにデータベースを作成するためのアクセス許可が必要です。
-   RMS サービス アカウントに使用するアカウントを指定します。ローカル構成の場合は、ローカル システム アカウントを使用できます。ただし、ローカル システム特権を持つサービスの実行は、本質的にセキュリティ上の問題が伴うため、お勧めしません。
    リモート SQL サーバー インスタンスまたは複数の RMS サーバーを含むインストールの場合は、ドメイン アカウントを指定する必要があります。使用するドメイン アカウントは、Active Directory の参照特権を持っている必要があります。また、このアカウントは、管理コンソールが動作する IIS アプリケーション プールの作成にも使用されます。既存のデータベースをアップグレードまたは使用していない場合、RMS サービス アカウントにはデータベース作成特権が必要です。既存のデータベースを使用する場合、アカウントには各 RMS データベースに対する読み取りおよび書き込みアクセス許可が必要です。
-   この Web サイトにアクセスするための URL を指定します。既定の値は、提供するサイトの名前です。たとえば、IIS の既定のインストールでサーバーを提供する場合は、"既定の Web サイト" という名前になります。負荷分散 URL をサポートする場合や、イントラネットとインターネットの両方のアクセスをサポートする場合などは、異なる Web サイトにアクセスするためのカスタム URL を指定できます。カスタム URL は、正しく動作することを確認してください。また、**\[グローバル管理\]** ページと **\[提供\]** ページの両方で仮想ルートを見つけられるように、サイト名を DNS に追加する必要があります。この URL がインターネット対応の展開用である場合は、インターネットと企業ネットワークの両方から新しい URL が利用できることを確認してください。
-   登録に使用するルート インストール秘密キーを保護するためのメカニズムを選択します。既定では、ソフトウェア ベースの暗号化を使用し、暗号化された秘密キーを RMS 構成データベースに保存します。既定の構成を使用する場合は、データベース内の値を暗号化するために強力なパスワードを指定してください。
    ただし、コンピュータにハードウェア セキュリティ モジュール (以下 HSM) をインストールして構成している場合は、ハードウェア セキュリティ モジュールで使用する暗号化サービス プロバイダ (以下 CSP) を選択し、秘密キーをスマート カードなどのハードウェアに保存することもできます。RMS には、完全な RSA プロバイダが必要で、CSP の一覧にはそれらのプロバイダだけが表示されます。RMS 秘密キーの保護に HSM を使用することを強くお勧めします。
    ソフトウェア ベースの CSP オプションを使用して RMS 秘密キーをパスワード保護する場合は、そのパスワードを後で参照できるように安全な場所に保存する必要があります。また、パスワードと共に構成データベースのバックアップ コピーも保存する必要があります。こうすることで、SQL データベースが壊れた場合に RMS を復元できます。何らかの理由でパスワードを変更した場合は、そのパスワードで保護された秘密キーを格納している構成データベースのバックアップ コピーを新しく作成し、その両方を安全な場所に保管します。構成データベースのバックアップおよび復元を行う方法の詳細については、このドキュメント コレクションの「RMS 展開の計画」にある「RMS システムのバックアップと復元」を参照してください。
-   サーバー ライセンサ証明書の内部で使用する名前を指定します。既定では、サーバーの名前が使用されます。
-   必要に応じて、インターネットに接続するためのプロキシ サーバー (アドレスとポートを含む) を指定します。
-   管理者の電子メール アドレスを指定します。管理者がライセンス サーバーをサブ登録する際に問題が発生した場合、他の RMS 管理者はこのアドレスを使用してその管理者に連絡できます。ルート インストールの提供が完了した後は、アドレスを変更できます。
-   サーバー ライセンサ証明書の失効方法を選択します。これは、Microsoft 登録サービス以外に、ルート インストールのサーバー ライセンサ証明書を失効できるユーザーを決定するものです。第三者による失効を使用する場合は、その第三者エンティティの公開キーを含むファイルのパスと名前を指定する必要があります。

オンライン登録を選択した場合は、適切なオプションをすべて設定した後、**\[提供\]** ページで **\[送信\]** をクリックすると、RMS によりキー ペアが生成され、公開キーが Microsoft 登録サービスに送信されます。エラー メッセージが表示された場合は、エラーが表示されているページを閉じないでください。エラーを解決した後で、コマンド プロンプト ウィンドウを開いて「`IISReset`」と入力し、IIS を停止して再起動します。次に、前の画面に戻り、提供画面の情報を入力し直して **\[送信\]** を再度クリックします。その後、Microsoft 登録サービスにより、数分でサーバー ライセンサ証明書が作成されて構成データベースに返されます。このサーバーはドメイン内で RMS をインストールする最初のサーバーであるため、この手順はルート インストール サーバーを登録する処理にあたります。

オフライン登録を選択した場合は、提供プロセスの完了後に、サーバーを Microsoft 登録サービスに手動で登録します。サーバーを使用するには、登録処理を完了しておく必要があります。詳細については、このドキュメント コレクションの「RMS サーバーの運用」にある「ルート証明サーバーを手動で登録するには」を参照してください。

サーバーの提供と登録が完了すると、**\[グローバル管理\]** ページのリンクが変更されます。**\[この Web サイトに RMS を提供する\]** リンクは **\[この Web サイトの RMS を管理する\]** リンクに変わり、**\[このサーバーをクラスタに追加する\]** リンクが **\[RMS サービス アカウントを変更する\]** に置き換わります。また、**\[この Web サイトから RMS を削除する\]** リンクも追加されます。

この最初のサーバーにより、RMS のルート インストールが確立されます。ルート インストールは、1 つのサーバーで構成する場合と、クラスタで構成する場合があります。最初のサーバーのインストールと提供が完了したら、証明サービスおよびライセンス サービスの冗長性と負荷分散をサポートするために追加のサーバーをセットアップできます。

構成が完了したら、ルート証明クラスタのサービス接続ポイントを Active Directory に登録して、RMS 対応クライアントがサービスを検出できるようにする必要があります。詳細については、このドキュメント コレクションの「RMS サーバーの運用」にある「サービス接続ポイントの登録」を参照してください。サービス接続ポイントが登録されていないと、RMS で RMS クライアントを使用することはできません。

| ![](images/Cc747756.Important(WS.10).gif)重要                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 他のサーバーへの RMS のインストールを開始する前に、最初のサーバー上で RMS を完全にインストールして提供する必要があります。 RMS は、メンバシップが複数のフォレストにわたる Active Directory グループに対してもコンテンツを保護します。複数のフォレストが存在しない、または複数のフォレストにわたるグループが存在しない組織の場合は、RMS 構成データベースの **MaxCrossForestCalls** クラスタ ポリシーを変更して、RMS サーバーにおける使用ライセンスの発行処理のパフォーマンスを最適化できます。 このポリシーでは、グループのメンバシップがフォレストの境界をまたがることができる最大回数を指定します。既定の値は 10 です。この値を 0 に変更するには、次の SQL コマンドを使用します。`update DRMS_ClusterPolicies set PolicyData=0 where PolicyName='MaxCrossForestCalls'` |

以下のトピックで、RMS の \[グローバル管理\] ページのタスクを実行するための詳細な手順を説明しています。

-   インストール ウィザードを使用して最初のサーバーをインストールする方法については、このドキュメント コレクションの「RMS サーバーの運用」にある「RMS Service Pack  1 をインストールするには」を参照してください。
-   最初のサーバーを提供する方法については、このドキュメント コレクションの「RMS サーバーの運用」にある「最初のルート証明サーバーを提供するには」を参照してください。
-   ルート インストールにサーバーを追加してクラスタを作成する方法については、この項目の「[証明およびライセンスをサポートするサーバーの追加](https://technet.microsoft.com/089ceb62-2a96-444f-ab42-1d5deaabd0c3)」を参照してください。
