---
TOCTitle: 自動更新を更新する必要がある
Title: 自動更新を更新する必要がある
ms:assetid: 'b23562a8-1a97-45c0-833e-084cd463d037'
ms:contentKeyID: 18128249
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Cc708554(v=WS.10)'
---

自動更新を更新する必要がある
============================

WSUS は IIS を使用して、ほとんどのクライアント コンピュータを WSUS 互換の自動更新 (WSUS クライアント) に自動的に更新します。このプロセスは "クライアントの自己更新" と呼ばれます。クライアントの自己更新を実行するために、WSUS セットアップでは WSUS Web サイトに Selfupdate という仮想ディレクトリを作成します。この仮想ディレクトリに WSUS 互換の自動更新が格納されます。これは "自己更新ツリー" と呼ばれます。

グループ ポリシーを使用してクライアント コンピュータを WSUS サーバーに関連付けることにより、結果的に自動更新の検出とクライアントの自己更新が行われることになります。このプロセスの詳細については、[Microsoft Windows Server Update Services 展開ガイド](http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/library/wsus/wsusdeploymentguidetc/ace052df-74e7-4d6a-b5d4-f7911bb06b40.mspx) (http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/library/wsus/wsusdeploymentguidetc/ace052df-74e7-4d6a-b5d4-f7911bb06b40.mspx) を参照してください。

### クライアントの自己更新問題のトラブルシューティング

クライアントの自己更新が自動的に行われない場合は、以下の提案を使用して問題のトラブルシューティングを行ってください。

#### SUS クライアントと WSUS クライアントを区別する方法

SUS クライアントと WSUS クライアントを区別するには、自動更新ユーザー インターフェイス (UI) を使用してください。次の図は、SUS クライアントと WSUS クライアントのユーザー インターフェイスです。

![](images/Cc708554.19d55cf9-544b-4fcf-8628-82c9e4bee345(ja-jp,WS.10).gif)
**SUS クライアント**

![](images/Cc708554.eb4d8b30-b0f5-46ee-afec-e333e2e28f74(ja-jp,WS.10).gif)
**WSUS クライアント**

#### 組織のクライアント ソフトウェアが自己更新可能であることを確認する

一部のコンピュータには、既に WSUS クライアントがインストールされていることがあります。その他のコンピュータには、自己更新を実行できないバージョンの自動更新がインストールされていることがあります。詳細については、[Microsoft Windows Server Update Services 展開ガイド](http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/library/wsus/wsusdeploymentguidetc/ace052df-74e7-4d6a-b5d4-f7911bb06b40.mspx) (http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/library/wsus/wsusdeploymentguidetc/ace052df-74e7-4d6a-b5d4-f7911bb06b40.mspx) を参照してください。自己更新可能な組織内のクライアントが自己更新を要求していても、まだ自己更新を行っていない場合は、次のセクションを参照してください。

#### SUS クライアントが WSUS サーバーに関連付けられていることを確認する

WSUS クライアントがインストールされていても、そのクライアント コンピュータが SUS サーバーに関連付けられていない場合、自動更新はレガシ モードになり、クライアント コンピュータでは SUS クライアント ユーザー インターフェイスが使用されます。この場合、そのコンピュータを SUS サーバーからリダイレクトして、WSUS クライアントが機能するようにする必要があります。SUS サーバーから自動更新を関連付けると、自動的にレガシ モードから戻り、新しいクライアント ユーザー インターフェイスが表示されます。

クライアント コンピュータが WSUS サーバーに関連付けられていて、上記の WSUS クライアント ユーザー インターフェイスが表示されない場合は、次のセクションを参照してください。

#### WSUS サーバーの自己更新ツリーを確認する

WSUS は IIS を使用して、ほとんどのクライアント コンピュータを WSUS 互換の自動更新に自動的に更新します。これを行うために、WSUS セットアップにより、WSUS をインストールするコンピュータのポート 80 を使用する Web サイトに、Selfupdate という名前の仮想ディレクトリが作成されます。"自己更新ツリー" と呼ばれるこの仮想ディレクトリには、最新の WSUS クライアントが格納されます。このような理由により、WSUS Web サイトをカスタム ポートに配置する場合でも、ポート 80 で実行する Web サイトを用意する必要があります。ポート 80 上の Web サイトは、WSUS 専用である必要はありません。WSUS がポート 80 上のサイトを使用するのは、自己更新ツリーをホストするためだけです。

自己更新ツリーが正しく実行されていることを確認するには、まず WSUS サーバーのポート 80 にセットアップされている Web サイトがあることを確認します。次に、WSUS サーバーのコマンド プロンプトで、次のように入力します。

**cscript** *WSUSInstallationDrive***:\\program files\\microsoft windows server update services\\setup\\InstallSelfupdateOnPort80.vbs**

WSUS クライアント自己更新が WSUS サーバーのポート 80 で実行されている場合は、次のセクションを参照してください。

#### WSUS サーバーの IIS ログを確認する

WSUS サーバーの IIS ログを確認します。既定の Web サイトでは、通常、IIS ログは %*windir*%\\system32\\LogFiles\\W3SVC1 にあります。クライアントの自己更新のセットアップ時に、Wutrack.bin ファイルを WSUS サーバーの \\InetPub\\wwwroot フォルダにコピーした場合は、IIS ログを開いて Wutrack.bin を検索し、自己更新が失敗した理由を示すエラー メッセージを見つけ出すことができます。一般的なエラーは、404 (ファイルが見つかりません)、401/403 (認証/アクセス)、および500 (内部サーバー エラー) です。IIS ヘルプを使用して、IIS ログで見つかった問題のトラブルシューティングを行ってください。

#### IIS の既定の Web サイトに SharePoint をインストールしている場合に、自己更新を妨害しないよう SharePoint を構成する

WSUS を実行しているサーバー上に Microsoft SharePoint をインストールすると、次の問題が発生することがあります。

-   自動更新が自己の更新を行おうとすると、\[アクセス拒否\] メッセージが表示されて、最新の自動更新が実行されません。

-   \[ホーム\] ページに、SelfUpdate サービスが使用できないというメッセージが表示されます。

クライアント コンピュータは、WSUS 互換の自動更新を実行していないと、WSUS で更新プログラムを受け取ることはできません。

##### この問題を解決するには

1.  IIS の既定の Web サイト、ClientWebService 仮想ルート、および Selfupdate 仮想ルートに匿名アクセス (匿名認証) を許可します。

2.  次の操作を実行して、SharePoint ISAPI DLL によって妨害されている特定の要求を除外します。

    1.  \[スタート\] ボタンをクリックし、\[管理ツール\] をポイントし、\[SharePoint のサーバー管理\] をクリックして、SharePoint のサーバー管理サイトを開きます。

    2.  \[仮想サーバーの構成\]、\[仮想サーバー設定の構成\] の順にクリックします。

    3.  \[既定の Web サイト\] をクリックします。

    4.  \[仮想サーバーの管理\]、\[管理パスの定義\] の順にクリックします。

    5.  \[新しいパスの追加\] で、除外するパスの種類を設定します。\[パス\] に、次のように入力します。

    -   **"/iuident.cab"**

    -   **"/wutrack.bin"**

    -   **"/clientwebservice"**

    -   **"/Selfupdate"**

#### WSUS クライアント コンピュータのネットワーク接続を確認する

WSUS クライアント コンピュータのネットワーク接続を確認します。Internet Explorer を使用して、WSUS サーバーの自己更新ファイルがクライアント コンピュータにアクセスできるかどうか判断します。以下の手順を実行して、このファイルをダウンロードまたは開くようメッセージが表示された場合は、ネットワーク接続の確認は済んでいます。ファイルを保存したり開いたりする必要はありません。この方法では、自動更新を自己更新できません。これらのファイルにアクセスできない場合は、WSUS クライアント コンピュータと WSUS サーバーとのネットワーク接続についてトラブルシューティングを行ってください。

##### WSUS クライアント コンピュータのネットワーク接続を確認するには

1.  \[スタート\] ボタン、\[ファイル名を指定して実行\] の順にクリックします。

2.  \[名前\] ボックスに「iexplore」と入力し、**Enter** キーを押します。

3.  Internet Explorer のアドレス バーに、次のように入力します。

    **http://**&lt;WSUS サーバー名&gt;**/iuident.cab**

    &lt;WSUS サーバー名&gt; は、WSUS サーバーの名前です。Iuident.cab をダウンロードまたは開くようメッセージが表示されることを確認します。これにより、WSUS クライアントがネットワーク接続されていることと、WSUS サーバーで Iuident.cab が利用できることが確認できます。

4.  ダウンロードや保存を求めるメッセージのボックスが表示されない場合は、\[キャンセル\] をクリックします。Internet Explorer のアドレス バーに、次のように入力します。

    **http://**&lt;WSUS サーバー名&gt;**/selfupdate/AU/x86/**&lt;OS 変数&gt;**/**&lt;言語変数&gt;**/wuaucomp.cab**

    &lt;WSUS サーバー名&gt; は、WSUS サーバーの名前で、&lt;OS 変数&gt; はクライアント コンピュータのオペレーティング システムを示す変数です。&lt;OS 変数&gt; に入力できる変数は、NetServer、W2K、または XP です。&lt;言語変数&gt; は、クライアント コンピュータのオペレーティング システムの言語を示す変数です。&lt;言語変数&gt; に入力できる変数は、2 ～ 4 文字の言語の標準省略形です。たとえば、英語版の Windows XP を実行しているクライアント コンピュータの URL は次のようになります。

    http://&lt;WSUS サーバー名&gt;/selfupdate/AU/x86/XP/EN/wuaucomp.cab

    Wuaucomp.cab をダウンロードまたは保存するようメッセージが表示されることを確認します。これにより、WSUS クライアントがネットワーク接続されていることと、WSUS サーバーで Iuident.cab が利用できることが確認できます。

これらの両方のファイルを保存またはダウンロードするようメッセージが表示されたら、次のセクションを参照してください。

#### SUS クライアント コンピュータのログを確認する

クライアント コンピュータの %*windir*%\\windows update.log を確認して、サーバーへの接続が行われたり、試みられたことがあるか調べてください。クライアント コンピュータがサーバーと通信できなくなっている場合は、クライアント コンピュータの %*systemdrive*%\\program files\\windowsupdate\\v4\\urllog.dat ファイルを確認して、サーバーの pingback がキャッシュされているか調べてください。

これらのファイルは既定では非表示になっています。次の手順を使用して、Windows Server 2003 で非表示になっているファイルとフォルダを表示してください。

##### Windows Server 2003 で非表示のファイルとフォルダを表示するには

1.  コントロール パネルの \[フォルダ オプション\] を開きます。

2.  \[表示\] タブの \[ファイルとフォルダの表示\] で、\[すべてのファイルとフォルダを表示する\] をクリックします。

WSUS クライアントのログで問題が見つからなかった場合は、次のセクションを参照してください。

#### SUS クライアント コンピュータのレジストリ設定を操作する

これまでのすべての手順でうまくいかなかった場合は、クライアント コンピュータが WSUS クライアントに自己更新するように、手動でレジストリ設定を操作することができます。

##### SUS クライアント コンピュータのレジストリ設定を手動で操作するには

1.  \[スタート\] ボタン、\[ファイル名を指定して実行\] の順にクリックします。

2.  \[名前\] ボックスに、「regedit」と入力し、\[OK\] をクリックします。

3.  レジストリ エディタで、次のキーを展開して、WindowsUpdate キーに移動します。

    **HKEY\_LOCAL\_MACHINE\\Software\\Policies\\Microsoft\\Windows\\**

    WindowsUpdate キーが存在しない場合は、次の操作を行います。

4.  メニューの \[編集\] をクリックし、\[新規\] をポイントし、\[キー\] をクリックします。

5.  新規キーの名前として「WindowsUpdate」と入力します。

6.  \[WSUServer\] 設定をダブルクリックし、WSUS サーバーの URL を入力し、**Enter** キーを押します。

    WSUServer 設定が存在しない場合は、次の操作を行います。

7.  設定名として「WSUServer」と入力します。

8.  \[WSUStatusServer\] 設定をダブルクリックし、WSUS サーバーの URL を入力し、**Enter** キーを押します。

    WSUStatusServer 設定が存在しない場合は、次の操作を行います。

9.  設定名として「WSUStatusServer」と入力します。

10. 次のキーに移動します。

    **HKEY\_LOCAL\_MACHINE\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU**

    AU キーが存在しない場合は、次の操作を行います。

11. 新規キーの名前として「AU」と入力します。

12. UseWSUServer 設定の値が 1 (0x1) になっていることを確認します。なっていない場合は、設定をダブルクリックして値を変更します。

    UseWSUServer 設定が存在しない場合は、次の操作を行います。

13. 設定名として「UseWSUServer」と入力します。

14. 次のキーに移動します。

    **HKEY\_LOCAL\_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate\\Auto Update**

15. コントロール パネルを使って、自動更新を有効にして構成します。

    \[スタート\] ボタン、\[コントロール パネル\] の順にクリックし、\[自動更新\] をダブルクリックします。

16. \[自動更新\] ダイアログ ボックスで、ダウンロード オプションとインストール オプションを指定し、\[OK\] をクリックします。\[自動更新を無効にする\] が選択されていないことを確認します。

17. AUState 設定の値が 2 (0x2) になっていることを確認します。なっていない場合は、この値をダブルクリックして変更します。

18. LastWaitTimeout 設定が存在する場合は、これを削除します。

19. DetectionStartTime 設定が存在する場合は、これを削除します。

20. コマンド プロンプトで次のように入力して、**Enter** キーを押し、自動更新サービスを停止します。

    **net stop wuauserv**

21. コマンド プロンプトで次のように入力して、**Enter** キーを押し、自動更新サービスを再起動します。

    **net start wuauserv**

22. 自己更新が実行されるまで、約 6 ～ 10 分間かかります。

##### SUS クライアント コンピュータに WSUS サーバーとの確認を実行させるには

-   約 1 分間経過したら、レジストリを更新します。次のような設定と値が表示されます。

    -   **DetectionStartTime (REG\_SZ) YYYY.MM.DD HH.MM.SS.DetectionStartTime** 値はローカル時刻で表示されていますが、実際の検出は表示時刻の 5 分後に行われます。

    -   **LastWaitTimeout (REG\_SZ) YYYY.MM.DD HH.MM.SS.LastWaitTimeout** 値は GMT または世界協定時刻で表示され、検出が行われる実際の時刻を表します。

これらの値は検出の開始時刻を表していますが、検出の最初の段階は、自己更新が必要であるかどうかの確認プロセスです。つまり、これらの値は、実際には SUS クライアントから WSUS クライアントへの自己更新の開始時刻になります。

クライアント ソフトウェアが 10 分後に自己更新しなかった場合は、**\\Auto Update** レジストリ キーを更新してください。**LastWaitTimeout** 値が変更され、以前の値から 24 時間以上経っている場合は、自動更新が **WSUServer** 値で指定したサーバー URL に接続できなかったことを示します。

![](images/Cc708554.arrow_px_up(ja-jp,WS.10).gif) [ページのトップへ](#ctl00_rs1_eb1_panel1)
