---
TOCTitle: '付録 C: リモート SQL'
Title: '付録 C: リモート SQL'
ms:assetid: '9e01d057-6b39-4eb7-b151-dff7ad0cd638'
ms:contentKeyID: 18128216
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Cc708510(v=WS.10)'
---

付録 C: リモート SQL
====================

WSUS サーバーがインストールされているコンピュータ以外とは別のコンピュータ上でSQL Serverを動作させる構成の場合は、限定されたサポートとなります。この構成で WSUS をインストールする方法について、詳細な手順を説明します。

リモート SQL 用に WSUS をセットアップするプロセスは、3 つの手順から成ります。最初に、フロントエンド コンピュータで WSUS セットアップを実行します。このコンピュータでは、WSUS は常にリモート SQL ペアにおいて IIS を実行しているサーバーとなります。次に、バックエンド コンピュータに移動し、WSUS データベースをセットアップして、アクセス許可を構成します。このコンピュータでは、WSUS は常にリモート SQL ペアにおいてデータベースを実行しているサーバーとなります。最後に、フロントエンド コンピュータを、バックエンド コンピュータのデータベースを使用するように構成し、手動で更新サービスを開始します。

### リモート SQL の制限事項

-   Windows 2000 Server は、リモート SQL ペアのフロントエンド コンピュータでは使用できません。

-   リモート SQL ペアのフロントエンドおよびバックエンドのいずれにも、ドメイン コントローラとして構成したサーバーを使用できません。

-   バックエンド コンピュータでは、データベース ソフトウェアに WMSDE または MSDE を使用できません。

-   フロントエンド コンピュータとバックエンド コンピュータは、どちらも Active Directory ドメインに属している必要があります。

![](images/Cc708510.arrow_px_up(ja-jp,WS.10).gif) [ページのトップへ](#ctl00_rs1_eb1_panel1)

### データベースの要件

使用できるデータベース ソフトウェアは、Microsoft SQL と完全に互換性があり、「リモート SQL の制限事項」に挙げられていないものです。Microsoft SQL Server 2000 は、リモート SQL との使用に関して排他的にテストされています。

WSUS には SQL Server 2000 Service Pack 3a が必要です。完全版の SQL Server を使用する場合は、まず、SQL Server 管理者が SQL Server で "トリガのネスト" オプションが有効になっていることを確認する必要があります。これは WSUS データベースをセットアップする前に行ってください。

SQL 認証は使用できません。WSUS は Windows 認証のみをサポートしています。WSUS セットアップでは SUSDB というデータベースが作成されます。WSUS データベースに格納される情報および WSUS データベースの機能の詳細については、前述の「[WSUS に使用するデータベースを選択する](http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/library/wsus/wsusdeploymentguidetc/86b1e90d-307d-4b35-88a1-84baccd1ff63.mspx)」を参照してください。

![](images/Cc708510.arrow_px_up(ja-jp,WS.10).gif) [ページのトップへ](#ctl00_rs1_eb1_panel1)

### 手順 1: フロントエンド コンピュータに WSUS をインストールする

フロントエンド コンピュータに WSUS をインストールします。このサーバーは、更新プログラムを取得するのにインターネットまたは別の WSUS サーバーにアクセスする必要があります。このコンピュータの準備に必要な要件は、データベース ソフトウェアを除いて、通常の WSUS のインストールとすべて同じです。

WSUS セットアップは、コマンド ラインから **/f** コマンド ライン オプションを使用して実行します。このオプションを使用すると、WSUS はリモート SQL ペアのフロント エンドとしてインストールされ、WSUS セットアップ プロセスのデータベースのセットアップ部分が省略されます。また、インストールが完了した後、更新サービスは開始されません。データベースのセットアップは、「[手順 2: バックエンド コンピュータに WSUS をインストールする](#wus_installwusbackendcomputer)」で行います。更新サービスは、「[手順 3: フロントエンド コンピュータをバックエンド コンピュータを使用するように構成する](#wus_configurefrontendcomputer)」で実行するタスクの 1 つとして手動で開始します。

このインストールでは、更新プログラムの格納場所に注意してください。更新プログラムの格納場所により、「[手順 2: バックエンド コンピュータに WSUS をインストールする](#wus_installwusbackendcomputer)」のバックエンド コンピュータをセットアップする方法が決まります。

ハードウェア、ハード ディスク、およびソフトウェアの要件については、「[WSUS サーバーをインストールする](http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/library/wsus/wsusdeploymentguidetc/9d55bda5-9eb9-46d2-a204-62034936eb13.mspx)」を参照してください。

#### フロントエンド コンピュータに WSUS をインストールするには

1.  コマンド プロンプトで、WSUS セットアップ プログラムが格納されているフォルダに移動し、次のように入力します。

    **WSUSSetup.exe /f**

2.  ウィザードの開始ページで、\[次へ\] をクリックします。

3.  使用許諾契約書の内容をよく確認し、\[使用許諾契約書に同意します\]、\[次へ\] の順にクリックします。

4.  1. \[更新元の選択\] ページで、クライアント コンピュータが更新プログラムを取得する場所を指定します。\[更新プログラムをローカルに保存する\] をクリックすると、更新プログラムは WSUS に格納されるので、格納先となるファイル システムの場所を選択できます。更新プログラムをローカルに格納しない場合は、クライアント コンピュータが Microsoft Update に接続して、承認された更新プログラムを取得します。 更新プログラムの格納オプションの詳細については、前述の「[更新プログラムの格納場所を決定する](http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/library/wsus/wsusdeploymentguidetc/3102c059-d7a4-49d8-8de8-299e730bb109.mspx)」を参照してください。選択したら、\[次へ\] をクリックします。

    \[更新プログラムをローカルに保存する\] をクリックした場合は、ローカルの更新プログラムの格納場所の指定に使用した文字列をメモします。この文字列はバックエンド コンピュータのセットアップ時に使用する必要があります。

    ![](images/Cc708510.sus2_install_3s(ja-jp,WS.10).gif)
    **\[更新元の選択\] ページ**

5.  \[Web サイトの選択\] ページで、WSUS で使用する Web サイトを指定します。詳細については、前述の「[IIS をインストールして構成する](http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/library/wsus/wsusdeploymentguidetc/6b2e1035-5b82-45f4-9f51-6cc0ca32fd60.mspx)」を参照してください。2 つの重要な URL があることに注意してください。1 つは、クライアント コンピュータを WSUS に関連付ける URL で、もう 1 つは、WSUS を構成する WSUS コンソールの URL です。

    ![](images/Cc708510.sus2_frontend04s(ja-jp,WS.10).gif)
    **\[Web サイトの選択\] ページ**

6.  \[Microsoft Windows Server Update Services をインストールする準備ができました\] ページで、\[次へ\] をクリックします。

    ![](images/Cc708510.72c3d66e-5107-4584-90fe-840f58152030(ja-jp,WS.10).gif)
    **\[Microsoft Windows Server Update Services をインストールする準備ができました\] ページ**

7.  最後のページで WSUS のインストールが正常に完了したことを確認し、\[完了\] をクリックします。

![](images/Cc708510.arrow_px_up(ja-jp,WS.10).gif) [ページのトップへ](#ctl00_rs1_eb1_panel1)

### 手順 2: バックエンド コンピュータに WSUS をインストールする

バックエンド コンピュータに WSUS をインストールします。このサーバーにはデータベース ソフトウェアをインストールする必要があります。IIS はバックエンド コンピュータにインストールしておく必要はありません。IIS を除き、他の通常の WSUS インストールの要件はすべて満たす必要があります。

バックエンド コンピュータでアクセス許可を構成する手順は、Windows 2000 Server と Windows Server 2003 のどちらを使用しているかによって異なります。ここでは、両方の手順について説明します。使用しているオペレーティング システム用の手順を必ず使用してください。

WSUS セットアップは、コマンド ライン オプションを使用できるようにコマンド ラインから実行する必要があります。**/b** コマンド ライン オプションを使用します。コマンド ライン オプションを使用してセットアップを実行するほかに、SQL スクリプトを実行して、フロントエンド コンピュータにおける更新プログラムの格納場所の管理方法を指定する必要があります。

これらのオプションを使用すると、WSUS はリモート SQL ペアのバック エンドとしてインストールされ、データベースのセットアップを除いて、インストールの大部分が省略されます。インストールが完了したら、バックエンド コンピュータでアクセス許可を構成する必要があります。

ハードウェア、ハード ディスク、およびソフトウェアの要件については、「[WSUS サーバーをインストールする](http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/library/wsus/wsusdeploymentguidetc/9d55bda5-9eb9-46d2-a204-62034936eb13.mspx)」を参照してください。

手順 2 では、次のような操作を実行します。

-   バックエンド コンピュータに WSUS をインストールする

-   SQL スクリプトを実行して、フロントエンド コンピュータでの更新プログラムの格納場所の管理方法を指定する

-   バックエンド コンピュータでアクセス許可を構成する

#### バックエンド コンピュータに WSUS をインストールするには

1.  コマンド プロンプトで、WSUS セットアップ プログラムが格納されているフォルダに移動し、次のコマンドを入力します。

    **WSUSSetup.exe /b**

2.  ウィザードの開始ページで、\[次へ\] をクリックします。

3.  使用許諾契約書の内容をよく確認し、\[使用許諾契約書に同意します\]、\[次へ\] の順にクリックします。

4.  \[データベースのオプション\] ページで、WSUS データベースの管理に使用するソフトウェアを選択します。\[次のコンピュータにある既存のデータベース サーバーを使用する\] をクリックする必要があります。\[SQL インスタンス名\] ボックスからインスタンス名を選択し、\[次へ\] をクリックします。

    ![](images/Cc708510.sus2_install_4s(ja-jp,WS.10).gif)
    **\[データベースのオプション\] ページ**

5.  \[SQL Server のインスタンスに接続中\] ページで、SQL サーバーに正常に接続されたことを示すメッセージが表示されたら、\[次へ\] をクリックします。

    ![](images/Cc708510.b0a0363b-4100-4009-8f4d-25f13db62a84(ja-jp,WS.10).gif)
    **\[SQL Server のインスタンスに接続中\] ページ**

6.  \[更新プログラムのミラー化の設定\] ページで、この WSUS サーバーに対する管理役割を指定します。集中管理トポロジを使用する場合、またはこれがネットワークに初めて構成した WSUS サーバーではない場合、アップストリーム WSUS サーバーの名前をここに入力します。これが初めてネットワークで構成した WSUS サーバーである場合、または分散管理トポロジを使用する場合、この画面をスキップしてください。

    選択したら、\[次へ\] をクリックします。管理役割の詳細については、「[管理形態を選択する](http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/library/wsus/wsusdeploymentguidetc/c18ab8e3-b76d-46a8-84e6-b46adb778098.mspx)」を参照してください。

    ![](images/Cc708510.f26e09d5-983c-418d-8511-8960850403ef(ja-jp,WS.10).gif)
    **\[更新プログラムのミラー化の設定\] ページ**

7.  \[Microsoft Windows Server Update Services をインストールする準備ができました\] ページで、\[次へ\] をクリックします。

8.  最後の画面で WSUS のインストールが正常に完了したことを確認し、\[完了\] をクリックします。

バックエンド コンピュータに WSUS をインストールしたら、SQL スクリプトを実行して、フロントエンド コンピュータでの更新プログラムの格納場所の管理方法を指定する必要があります。実行する SQL スクリプトの構文は、クライアント コンピュータがフロントエンド コンピュータからローカルに更新プログラムを取得するか、Microsoft から直接更新プログラムをダウンロードするかによって異なります。クライアントがどこから更新プログラムを取得するかは、フロントエンド コンピュータに WSUS をインストールしたときに設定しました。

フロントエンド コンピュータをどのように構成したか思い出せない場合は、フロントエンド コンピュータの次の場所にあるログ ファイルで確認できます。

*%programfiles%*\\Update Services\\Logfiles\\WSUSSetup\_&lt;インストール日&gt;.log

&lt;インストール日&gt; は、WSUS をインストールした日付です。

このファイルから、次の 2 つのキーの値を確認します。

-   HostOnMu

-   LocalContentCacheLocation

#### バックエンド コンピュータで、フロントエンド コンピュータにおける更新プログラムの格納場所の管理方法を指定するには

-   コマンド プロンプトで、フロントエンド コンピュータのセットアップ方法に応じて、次のいずれかのコマンドを入力します。

    -   フロントエンド コンピュータでローカルの格納を選択した場合は、次のように入力します。

        **"***%programfiles%\\***update services\\tools\\osql\\osql.exe" -S** *SQLServerName* **-E -b -n -Q "USE SUSDB UPDATE dbo.tbConfigurationA SET HostOnMu = '0' UPDATE dbo.tbConfigurationB SET LocalContentCacheLocation = N'***LocalContentCacheLocation Value***'"**

        *SQLServerName* は、SUSDB データベースを保持する SQL Server インスタンスの名前です。%*programfiles*% は、フロントエンド コンピュータの Program Files フォルダの場所です。*LocalContentCacheLocation Value* は、コンテンツの格納先となるフロントエンド コンピュータのファイル システムの場所を指定するための実際の文字列です。この文字列の末尾には **\\WSUSContent** を追加します。たとえば、フロントエンド コンピュータで C:\\WSUS\\ を使用した場合は、「C:\\WSUS\\WSUSContent」と入力します。ネットワーク上の場所や UNC パスは使用しないでください。最後に円記号 (\\) は付けないでください。

    -   Microsoft Update 上のリモートの格納を選択した場合は、次のように入力します。

        **"***%programfiles%***\\update services\\tools\\osql\\osql.exe" -S** *SQLServerName* **-E -b -n -Q "USE SUSDB UPDATE dbo.tbConfigurationA SET HostOnMu = '1' UPDATE dbo.tbConfigurationB SET LocalContentCacheLocation = N'***%programfiles%***\\Update Services\\WsusContent'"**

        *SQLServerName* は、バックエンド コンピュータの SQL Server インスタンスの名前です。%*programfiles*% は、フロントエンド コンピュータの Program Files フォルダの場所です。

#### Windows Server 2003 でアクセス許可を設定する

バックエンド コンピュータが Windows Server 2003 を実行している場合は、次の手順を使用してアクセス許可を設定します。その後、「[手順 3: フロントエンド コンピュータをバックエンド コンピュータを使用するように構成する](#wus_configurefrontendcomputer)」に進んでください。

##### Windows Server 2003 を実行しているバックエンド コンピュータでアクセス許可を設定するには

1.  バックエンド コンピュータで、\[スタート\] ボタンをクリックし、\[管理ツール\] をポイントして、\[コンピュータの管理\] をクリックします。

2.  ツリーの \[ローカル ユーザーとグループ\] を展開し、\[グループ\] をクリックします。

3.  詳細ペインで、\[WSUS Administrators\] をダブルクリックします。

    ![](images/Cc708510.sus2_permissions01s(ja-jp,WS.10).gif)
    **WSUS Administrators グループ**

4.  WSUS Administrators の \[プロパティ\] ダイアログ ボックスで、\[追加\] をクリックします。

5.  \[ユーザー、コンピュータ、またはグループの選択\] で、\[オブジェクトの種類\] をクリックします。

6.  \[オブジェクトの種類\] で、\[コンピュータ\]、\[OK\] の順にクリックします。

    ![](images/Cc708510.2d82afb8-fe76-4957-a9c3-4c20ab51122b(ja-jp,WS.10).gif)
    **\[オブジェクトの種類\] ダイアログ ボックス**

7.  \[ユーザー、コンピュータ、またはグループの選択\] で、フロントエンド コンピュータの名前を入力し、\[OK\] をクリックします。

    ![](images/Cc708510.1f0cad85-b790-4c14-8640-3530f575ce45(ja-jp,WS.10).gif)
    **\[ユーザー、コンピュータ、またはグループの選択\] ダイアログ ボックス**

8.  WSUS Administrators の \[プロパティ\] ダイアログ ボックスで、\[OK\] をクリックします。

#### Windows 2000 Server でアクセス許可を設定する

バックエンド コンピュータが Windows 2000 Server を実行している場合は、次の手順を使用してアクセス許可を設定します。その後、「[手順 3: フロントエンド コンピュータをバックエンド コンピュータを使用するように構成する](#wus_configurefrontendcomputer)」に進んでください。

##### グローバル セキュリティ グループを作成して、フロントエンド コンピュータをメンバとして追加するには

1.  Active Directory 管理ツールがインストールされているコンピュータで、\[スタート\] ボタンをクリックし、\[管理ツール\] をポイントして、\[Active Directory ユーザーとコンピュータ\] をクリックします。

2.  ツリーで、新しいグループを作成するフォルダを右クリックします。

3.  \[新規作成\] をポイントし、\[グループ\] をクリックします。

4.  新しいグループの名前を入力します。

5.  \[グループの範囲\] で、\[グローバル\] をクリックします。

    ![](images/Cc708510.719fbcb0-addc-4b6a-9da2-9825e44d2490(ja-jp,WS.10).gif)
    **グローバル セキュリティ グループのダイアログ ボックス**

6.  \[グループの種類\] で、\[セキュリティ\]、\[OK\] の順にクリックします。グローバル セキュリティ グループが作成されます。

7.  作成したグローバル セキュリティ グループをダブルクリックします。

8.  グループのプロパティ ダイアログ ボックスで、\[メンバ\] タブをクリックします。

9.  \[追加\] をクリックします。

10. \[ユーザー、コンピュータ または グループ の選択\] で、\[オブジェクトの種類\] をクリックします。

11. \[オブジェクトの種類\] で、\[コンピュータ\]、\[OK\] の順にクリックします。

12. \[選択するオブジェクト名を入力してください (例)\] で、フロントエンド コンピュータの名前を入力し、\[OK\] をクリックします。

13. グローバル セキュリティ グループのプロパティ ダイアログ ボックスで、\[OK\] をクリックします。

##### Windows 2000 Server を実行しているバックエンド コンピュータでアクセス許可を設定するには

1.  バックエンド コンピュータで、\[スタート\] ボタンをクリックし、\[管理ツール\] をポイントして、\[コンピュータの管理\] をクリックします。

2.  ツリーの \[ローカル ユーザーとグループ\] を展開し、\[グループ\] をクリックします。

3.  詳細ペインで、\[WSUS Administrators\] をダブルクリックします。

4.  WSUS Administrators の \[プロパティ\] ダイアログ ボックスで、\[追加\] をクリックします。

5.  \[ユーザーまたはグループの選択\] で、\[場所\] ドロップダウン リストから自分のドメインを選択します。

    ![](images/Cc708510.e22abbc4-4b58-4cb1-b0c7-54133bd83861(ja-jp,WS.10).gif)
    **\[ユーザー または グループ の選択\] ダイアログ ボックス**

6.  前の手順で作成したグローバル セキュリティ グループをダブルクリックし、\[OK\] をクリックします。

7.  WSUS Administrators の \[プロパティ\] ダイアログ ボックスで、\[OK\] をクリックします。

![](images/Cc708510.arrow_px_up(ja-jp,WS.10).gif) [ページのトップへ](#ctl00_rs1_eb1_panel1)

### 手順 3: フロントエンド コンピュータをバックエンド コンピュータを使用するように構成する

レジストリを編集して、フロントエンド コンピュータを、バックエンド コンピュータのデータベースを使用するように構成します。レジストリを変更したら、更新サービスを手動で開始します。そうすることで、フロント エンドの WSUS コンソールを使用して WSUS を構成できるようになります。

手順 3 では、次のような操作を実行します。

-   フロントエンド コンピュータをデータベースを使用するように構成する

-   更新サービスを手動で開始する

#### フロントエンド コンピュータをデータベースを使用するように構成するには

1.  フロントエンド コンピュータで、\[スタート\] ボタン、\[ファイル名を指定して実行\] の順にクリックします。

2.  \[名前\] ボックスに「**regedit**」と入力し、\[OK\] をクリックします。

3.  レジストリ エディタで、次のレジストリ キーに移動します。

    **HKLM\\SOFTWARE\\Microsoft\\Update Services\\Server\\Setup\\**

4.  詳細ペインで、**SQLServerName** キーをダブルクリックします。

5.  \[値のデータ\] にバックエンド コンピュータの名前を入力し、\[OK\] をクリックします。データを入力するときは、&lt;サーバー名&gt;\\&lt;インスタンス&gt; という構文を使用します。サーバーで既定のインスタンスが使用されている場合は、「&lt;サーバー名&gt;」というように、インスタンス名を省略できます。

#### 更新サービスを手動で開始するには

1.  \[スタート\] ボタン、\[ファイル名を指定して実行\] の順にクリックします。

2.  \[名前\] ボックスに「**services.msc**」と入力し、\[OK\] をクリックします。

3.  詳細ペインで、\[Update Services\] サービスをダブルクリックして、\[開始\] をクリックします。

![](images/Cc708510.arrow_px_up(ja-jp,WS.10).gif) [ページのトップへ](#ctl00_rs1_eb1_panel1)
