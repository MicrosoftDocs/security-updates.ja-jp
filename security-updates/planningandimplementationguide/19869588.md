---
TOCTitle: IP パケット フィルタの使用
Title: IP パケット フィルタの使用
ms:assetid: '822bd148-6689-470a-9baf-a0f8cb8010fe'
ms:contentKeyID: 19869588
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Cc751294(v=TechNet.10)'
---

IP パケット フィルタの使用
==========================

最終更新日: 2003年7月7日

**Microsoft ISA Server 2000 Feature Pack 1 バージョン 1**

Microsoft Internet Security and Acceleration (ISA) Server のパケット フィルタ機能を使用すれば、ISA Server へ送られてきた Internet Protocol (IP) パケット、および ISA Server から送り出される IP パケットを制御できます。パケット フィルタを有効にすると、外部インターフェイス上のパケットのうち、IP パケット フィルタによって静的に許可されたパケット、またはアクセスポリシーや公開ルールによって動的に許可されたパケット以外のすべてのパケットが破棄されます。

パケット フィルタが有効でない場合でも、アクセスを許可するルールを明確に構成しない限り、ローカルネットワークとインターネット間の通信は許可されません。

##### トピック

[](#ecaa)[パケット フィルタを使用する場合](#ecaa)

[](#ebaa)[パケット フィルタを必要とするクライアントアクセスシナリオ](#ebaa)

[](#eaaa)[パケット フィルタを必要とする公開シナリオ](#eaaa)

### パケット フィルタを使用する場合

ほとんどの場合は、ポートを動的に開く方法が適しています。したがって、内部クライアントがインターネットへアクセスできるようにするためのアクセスポリシールール、または外部クライアントが内部サーバーへアクセスできるようにするための公開ルールを作成することをお勧めします。これは、IP パケット フィルタがポートを静的に開くのに対し、アクセスポリシールールや公開ルールは、要求の到着時にポートを動的に開くためです。たとえば、すべての内部ユーザーが Hypertext Transfer Protocol (HTTP) サイトへアクセスできるようにする場合は、ポート 80 を開く IP パケット フィルタを作成しないようにします。代わりに、このアクセスで必要なサイトとコンテンツルール、およびプロトコルルールを作成します。

公開ルールのもう 1 つの利点は、アプリケーションフィルタを使用して、サーバー宛ての要求をさらに処理できることです。アプリケーションフィルタは、Firewall サービスに登録され、一部またはすべてのアプリケーションレベルプロトコルストリームまたはデータグラムで機能します。アプリケーションフィルタでは、認証やウイルスチェックなどプロトコル固有またはシステム固有のタスクを実行できます。

アクセスポリシールールや公開ルールではなく、パケット フィルタを使用する必要があるクライアントアクセスシナリオと公開シナリオがあります。

[](#mainsection)[ページのトップへ](#mainsection)

### パケット フィルタを必要とするクライアントアクセスシナリオ

以下のシナリオでは、パケット フィルタを使用して、クライアントによるインターネットへのアクセスを許可する必要があります。

-   クライアントが ISA Server コンピュータ上に配置されている場合

-   クライアントが境界領域のネットワーク (DMZ、非武装地帯、スクリーンサブネットとも呼ばれます) に配置されている場合


-   内部ネットワークのクライアントが、TCP/UDP 以外のプロトコルを使用したアクセスを必要としている場合

**ISA Server コンピュータ上のクライアント**

ISA Server コンピュータ上のクライアントアプリケーションがインターネットへのアクセスを必要とする場合があります。このクライアントにはアクセスポリシールールが適用されないので、パケット フィルタを使用する必要があります。この例として、ISA Server コンピュータで Outlook Express を実行し、インターネット上の SMTP (Simple Mail Transport Protocol) サーバー、POP (Post Office Protocol) サーバー、および NNTP (Network News Transfer Protocol) サーバーにアクセスする場合があります。このようなときは、POP3、SMTP、および NNTP プロトコルを許可する IP パケット フィルタを作成します。このシナリオは、ISA Server ドキュメントの「ISA Server コンピュータでのその他のサービスの実行」で詳しく説明されています。

ISA Server がファイアウォールとして機能している場合は、IP パケット フィルタを作成して同一コンピュータ上の他のサービスやアプリケーションで使用するポートを静的に開かないようにしてください。

**境界領域のネットワークのクライアント**

インターネットへのアクセスを必要とするクライアントコンピュータが境界領域のネットワークに配置されている場合は、アクセスを許可するためのパケット フィルタを定義します。これは、境界領域のネットワーク内のコンピュータにはアクセスポリシールールが適用されないためです。クライアントがアクセスを必要とする各プロトコルについてパケット フィルタを定義する必要があります。

**TCP/UDP 以外のプロトコルを使用するアクセス**

内部クライアントが TCP または UDP 以外のプロトコルを使ってインターネットにアクセスする必要がある場合は、そのアクセスを許可するパケット フィルタを定義します。たとえば、ISA Server に備わっている発信方向の ICMP パケット フィルタなどがあります。

[](#mainsection)[ページのトップへ](#mainsection)

### パケット フィルタを必要とする公開シナリオ

一部の公開シナリオでは IP パケット フィルタを使用する必要があります。

-   マルチホーム境界領域のネットワーク (DMZ、非武装地帯、スクリーンサブネットとも呼ばれます) に配置されたサーバーを公開する場合は、IP パケット フィルタを使用して、そのサーバーが外部クライアントへアクセスできるようにする必要があります。


-   ISA Server コンピュータ上に配置されたサーバーまたはサービスを公開する場合は、IP パケット フィルタを使用する必要があります。


**マルチホーム境界領域のネットワーク上のサーバーを公開する**

外部クライアントがローカルネットワーク上のサーバーへアクセスできるようにするには、サーバー公開ルールを構成します。ただし、マルチホーム境界領域のネットワークの場合は、パケット フィルタを使用する必要があります。

マルチホーム境界領域のネットワークの ISA Server コンピュータでは、3 つのネットワークアダプタを使用します。

-   1 番目のネットワークアダプタを社内ネットワークに接続します。


-   2 番目のネットワークアダプタを、社内の境界領域のネットワークに配置されたサーバーに接続します。境界領域のネットワークのインターネットプロトコル (IP) アドレスがローカルアドレステーブル (LAT) に含まれていてはなりません。


-   3 番目のネットワークアダプタをインターネットに接続します。


図は、この境界領域のネットワークシナリオを示しています。

![](images/Cc751294.uippf01(ja-jp,TechNet.10).gif)

たとえば、SMTP サーバーがローカルネットワークではなく、マルチホーム境界領域のネットワーク上に配置されている場合は、IP パケット フィルタを使用してこのサーバーのポートを開きます。境界領域のネットワーク上の SMTP サーバーを公開するには、以下の構成で IP パケット フィルタを作成します。

-   \[このフィルタを使用するサーバー\] をアレイ内のすべての

    ISA サーバーに設定します。


-   パケット転送を許可できるようにフィルタのモードを設定します。


-   カスタムフィルタを以下のように設定します。

    -   \[IP プロトコル\] を \[TCP\] に設定します。

    -   
    -   \[方向\] を \[両方\] に設定します。

    -   
    -   \[ローカルポート\] を \[25\] に設定します。

    -   
    -   \[リモートポート\] を \[任意\] に設定します。

    -   

-   \[ローカルコンピュータ\] を \[このコンピュータ\] に設定し、SMTP サーバーの IP アドレスを指定します。

-   \[リモートコンピュータ\] を \[すべてのリモートコンピュータ\] に設定します。


マルチホーム境界領域のネットワークの詳細については、ISA Server のドキュメントの「マルチホーム境界領域のネットワーク構成」を参照してください。

**ISA Server と同一コンピュータ上のサーバーを公開する**

ISA Server と同じコンピュータにサービスが配置されている場合、IP パケット フィルタを作成して、そのサービスで使用される特定のポートとの通信を可能にします。この場合は、サーバー公開ルールを使用できません。たとえば、ISA Server には、ISA Server コンピュータ自体で DNS クエリを許可する事前構成された IP パケット フィルタ ("DNS Filter") が用意されています。

この方法の例外は Web サーバーを公開する場合です。Web サーバーを公開するときは、パケット フィルタではなく Web 公開ルールを使用することをお勧めします。このシナリオは、Publish\_Web\_on\_ISA.doc で詳しく説明されています。

[](#mainsection)[ページのトップへ](#mainsection)