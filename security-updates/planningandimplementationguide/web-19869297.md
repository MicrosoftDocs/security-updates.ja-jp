---
TOCTitle: Web サーバーを公開するときのリンク変換の使用
Title: Web サーバーを公開するときのリンク変換の使用
ms:assetid: '778bef2c-3e0f-4fc7-ad66-63d0b73900dd'
ms:contentKeyID: 19869297
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Cc750845(v=TechNet.10)'
---

Web サーバーを公開するときのリンク変換の使用
============================================

最終更新日: 2003年7月4日

**Microsoft ISA Server 2000 Feature Pack 1 バージョン 1**

公開されている Web サイトの中には、コンピュータの内部名を参照するものもあります。外部クライアントはネットワーク全体ではなく ISA Server だけを利用できるため、このような参照は壊れたリンクとして表示されます。ISA Server Feature Pack 1 にはリンク変換機能が導入されているため、一般に知られている名前にマップされる内部コンピュータ名の定義の辞書を作成できます。

##### トピック

[](#egaa)[リンク変換の概要](#egaa)

[](#efaa)[ソフトウェア要件](#efaa)

[](#eeaa)[シナリオ 1: 1 つのサーバーを公開する](#eeaa)

[](#edaa)[シナリオ 2: 複数のサイトを公開する](#edaa)

[](#ecaa)[シナリオ 3: ブリッジおよびリンク変換](#ecaa)

[](#ebaa)[シナリオ 4: 同じサーバー上で HTTP と HTTPS を公開する](#ebaa)

[](#eaaa)[変換されたリンクを含む Web ページのセキュリティ保護レベルの向上](#eaaa)

### リンク変換の概要

ISA Server Feature Pack 1 には "リンク変換機能" が導入されており、この機能を使用して絶対リンクを含む Web サイトを公開できます。

リンク変換は、Web サイト自体への絶対リンクを含む、公開された Web サイトに外部ユーザーがアクセしようとするときに役立ちます。この共通のシナリオでは、リンク変換を有効にするだけで、壊れたリンクを表示することなくユーザーにアクセスを許可することができます。

リンク変換は、より複雑な公開シナリオでも役立ちます。2 つの内部 Web サーバーが公開されているシナリオについて考えてみます。Web サーバーコンピュータの internalA と internalB には、一般に解決可能な名前 www.wingtiptoys.com と www.woodgrovebank.com によってアクセスすることができます。Web サーバーには、公開されたサイトへの相互参照が含まれています。ただし、参照先は内部の Web サイト名であり、一般に解決可能なサイト名ではありません。具体的には、internalA に internalB への参照が含まれているような状況です。

「www.wingtiptoys.com」と入力して internalA にアクセスする外部ユーザーは、internalB へのリンクをたどることができません。このシナリオでリンク変換を有効にし、各 Web サイトのエントリを含む辞書を作成すると、クライアントから要求されたページが返される前に、これらの内部リンクを変換できます。

クライアントが ISA Server によって保護された Web サイトのオブジェクトを要求すると、ISA Server はその要求が許可されているかどうかを確認します。要求が許可されている場合、ISA Server は要求されたオブジェクトを Web サーバーから取得します。ISA Server は Link Translator Web フィルタのインストールの有無に関係なく、クライアントに応答を返す前にヘッダーのリンク変換を実行します。具体的に言うと、さまざまな応答コードで使用される Content-location ヘッダーと、主に 301 と 302 の応答状態コードで使用される Location ヘッダーには、絶対 URL が含まれている可能性があります。しかし、たとえば、内部 Web サーバーによって発行される最初の 302 リダイレクト応答には、内部 Web サイトの Web サーバー名とポートが含まれます。通常、外部クライアントは内部 Web サイトにはアクセスできません。したがって、ISA Server ではこれらをクライアントが認識する独自の外部名とポートに変換しなければなりません。

Link Translator Web フィルタをインストールして有効にすると、ISA Server は応答のコンテンツの種類を確認して、本文に変換を適用するかどうかを決定します。応答の本文のリンク変換は、次の条件で実行されます。

-   コンテンツの種類が text/html または text/webviewhtml である HTML ドキュメントコンテンツグループは、既定によって変換されます。その他のコンテンツグループは、リンク変換辞書の設定に従って変換されます。


-   応答は範囲 206 ではありません。

    Link Translator Web フィルタは、応答のコンテンツの種類を判断するために、次の処理を実行します。


-   フィルタは、Content-type ヘッダーがあるかどうかを検索します。ヘッダーがある場合、フィルタはコンテンツの種類に応じて変換を行います。


-   フィルタは、Content-location ヘッダーがあるかどうかを検索します。ヘッダーがある場合、フィルタはコンテンツの場所の拡張子に応じて変換を行います。


-   Content-type も Content-location もない場合、フィルタは要求されたファイル拡張子に応じて変換を行います。



Link Translator Web フィルタは、リンク変換が有効になっている各 Web 公開ルールで、ルールごとに作成されている既定のリンク変換辞書に従ってリンク変換を実行します。リンク変換辞書にエントリを追加することで既定のリンク変換を拡張できます。これらの追加エントリは、応答の本文だけでなく応答のヘッダーにも適用されます。

Link Translator フィルタでは、次のように文字列を検索します。

1.  フィルタは、最初に最も長い検索文字列を検索し、次に降順に短い文字列を検索していき、最後に既定の文字列を検索します。

3.  検索文字列が見つかると、フィルタは文字列の後に続く文字を確認します。

3.  その文字が "終端文字" である場合、フィルタは検索文字列を置換文字列に置き換えます。終端文字の詳細な一覧については、ISA Server Feature Pack 1 のオンラインヘルプを参照してください。

[](#mainsection)[ページのトップへ](#mainsection)

### ソフトウェア要件

ISA Server コンピュータには、以下がインストールされている必要があります。

-   Service Pack 3 が適用された Microsoft Windows 2000 Server、Windows 2000 Advanced Server、または Windows Server 2003


-   Service Pack 1 が適用された ISA Server


-   ISA Server Feature Pack 1



Web サーバーには、Windows 2000 Server、Windows 2000 Advanced Server、または Windows Server 2003 がインストールされている必要があります。Web サイトの公開に使用する Internet Information Services (IIS) は、Windows 2000 Server、Windows 2000 Advanced Server、および Windows Server 2003 に含まれています。

[](#mainsection)[ページのトップへ](#mainsection)

### シナリオ 1: 1 つのサーバーを公開する

内部 Web サイトのページには、同じサイト上の他の Web ページへの絶対リンクが含まれている場合があります。たとえば、ページが配置されている内部サーバーの名前などが含まれます。Microsoftｮ SharePoint" サーバーなどの一部のサーバーは Web ページを動的に作成し、常に絶対リンクを含みます。

このシナリオでは、IIS\_Fabrikam という NetBIOS 名を持つコンピュータに配置された内部 Web サイトが http://www.fabrikam.com として公開されます。内部サイトには、Web サーバーの実際の NetBIOS (IIS\_fabrikam) への参照が含まれます。

この他、この Web サイトには、一般には使用できない Web サーバーの名前に対する参照が含まれている場合もあります。多くの場合には、内部のエイリアスまたは IP アドレスへの参照などです。このようなリンクを含むサイトを公開するには、ここで詳しく説明する手順を実行してください。

#### 手順

このシナリオを構成するには、これから説明する手順を実行してください。

1.  Link Translator Web フィルタを有効にする

3.  www.fabrikam.com を含む宛先セットを作成する

3.  サーバーを公開するための Web 公開ルールを作成する

4.  公開ルール用のリンク変換辞書を作成する

8.  

**手順 1. Link Translator Web フィルタを有効にする**

**Link Translator Web フィルタを有効にするには**

1.  \[ISA の管理\] コンソールツリーで、\[Internet Security and Acceleration Server\]、\[サーバーとアレイ\]、目的のアレイ、\[拡張\]、\[Web フィルタ\] の順にクリックします。

3.  詳細ペインで、\[Link Translator Filter\] を右クリックし、\[有効化\] をクリックします。

3.  Web Proxy サービスを再起動します。

6.  

**手順 2. www.fabrikam.com の宛先セットを作成する**

**www.fabrikam.com の宛先セットを作成するには**

1.  \[ISA の管理\] コンソールツリーで、\[Internet Security and Acceleration Server\]、\[サーバーとアレイ\]、目的のアレイ、\[ポリシーの要素\] の順にクリックし、\[宛先セット\] を右クリックして、\[新規作成\]、\[セット\] の順にクリックします。

3.  \[名前\] に宛先セットの名前を入力します。たとえば、「Fabrikam\_Set」と入力します。

3.  \[追加\] をクリックします。

4.  \[宛先\] に「www.fabrikam.com」と入力します。

8.  

**手順 3. IIS\_Fabrikam を公開するための Web 公開ルールを作成する**

**サーバーを公開するための Web 公開ルールを作成するには**

1.  \[ISA の管理\] コンソールツリーで、\[Internet Security and Acceleration Server\]、\[サーバーとアレイ\]、目的のアレイ、\[公開\] の順にクリックし、\[Web 公開ルール\] を右クリックして、\[新規作成\]、\[ルール\] の順にクリックします。

3.  \[Web 公開ルールの名前\] にルール名を入力します。たとえば、「Publish IIS\_Fabrikam」と入力します。次に、\[次へ\] をクリックします。

3.  \[ルールの適用先\] で \[指定された宛先セット\] を選択します。次に、\[名前\] で「手順 2. 宛先セットを作成する」で作成した宛先セットを選択します。\[次へ\] をクリックします。

4.  \[クライアントの種類\] ページで \[すべての要求\] を選択します。次に、\[次へ\] をクリックします。

5.  \[ルールの動作\] ページで \[要求をこの内部 Web サーバーへリダイレクトする (名前または IP アドレス)\] を選択します。テキストボックスに「IIS\_Fabrikam.Europe.Fabrikam.com」と入力します。次に、\[次へ\]、\[完了\] の順にクリックします。

6.  詳細ペインで、新しいルール (Publish IIS\_Fabrikam) を右クリックし、\[プロパティ\] をクリックします。

7.  \[リンクの変換\] タブで \[リンクの変換を実行する\] を選択します。

14. 

ここで作成したルールの既定の辞書は、サイト上の IIS\_Fabrikam.Europe.Fabrikam.com に対する参照を www.fabrikam.com に置き換えます。このエントリは、Web 公開ルールで指定した設定に基づいて作成されます。つまり、既定のリンク変換辞書が、\[新しい Web 公開ルールウィザード\] の \[動作\] ページに指定した名前を自動的に宛先セットに指定した名前に置き換えます。

既定の辞書には他のエントリも含まれています。ISA Server Feature Pack 1 のオンラインヘルプに詳細が記載されています。

**手順 4. Publish IIS\_Fabrikam ルールのリンク変換辞書のエントリを作成する**

**リンク変換辞書を作成するには**

1.  \[ISA の管理\] コンソールツリーで、\[Internet Security and Acceleration Server\]、\[サーバーとアレイ\]、目的のアレイ、\[公開\]、\[Web 公開ルール\] の順にクリックします。

3.  詳細ペインで、「手順 3. IIS\_Fabrikam を公開するための Web 公開ルールを作成する」で作成したルールを右クリックします。

3.  \[リンクの変換\] タブの \[追加\] をクリックし、以下の操作を行います。

    1.  上の編集ボックスに「http://IIS\_Fabrikam」と入力します。

    3.  下の編集ボックスに「http://www.fabrikam.com」と入力します。

    3.  \[OK\] をクリックします。

    6.  

4.  \[リンクの変換\] タブの \[追加\] をクリックし、以下の操作を行います。

    1.  上の編集ボックスに「http://IIS\_Fabrikam:80」と入力します。

    3.  下の編集ボックスに「http://www.fabrikam.com」と入力します。

    3.  \[OK\] をクリックします。

    6.  

    **注意** リンク変換辞書のエントリを作成するときは、以下のガイドラインに従ってください。

    -   置き換えられる文字列の最後に終端文字を使用しないでください。特に文字列がスラッシュ (/) で終わらないように十分注意してください。

    -   
    -   外部サイトで既定のポートが使用されている場合、リンク変換辞書のエントリにポート番号を指定する必要はありません。ただし、外部サイトで既定のポート番号が使用されていない場合は、非標準のポートを指定する必要があります。

    -   
    -   内部サイトで既定のポートが使用されている場合、そのポート番号を含むリンクと含まないリンクの両方を変換します。

    -   
    -   サイトにセキュリティで保護されたリンクが含まれている場合、http:// と https:// のエントリを追加します。

    -   

8.  

#### リンク変換が不要な場合 (1 つのサイトを公開する)

ここでは、Link Translator Web フィルタを必要としない 1 つの共通シナリオについて説明します。

このシナリオでは、内部 Web サーバー上に 1 つのサイトがあり、そのサイトには絶対リンクが含まれていません。Web 公開ルールを作成する場合、クライアントが知っているサイト名を内部コンピュータの名前にマップします。ISA Server はクライアントの要求を IIS サーバーにリダイレクトし、要求の中のホストヘッダーを自動的に変換します。応答に Location ヘッダーまたは Content-location ヘッダーが含まれる場合は、それらを自動的に変換します。この変換を実行する方法については、ISA Server Feature Pack 1 のオンラインヘルプを参照してください。

[](#mainsection)[ページのトップへ](#mainsection)

### シナリオ 2: 複数のサイトを公開する

このシナリオでは、IIS\_fabrikam および IIS\_wingtiptoys 上にある 2 つの内部 Web サイトが、それぞれ www.fabrikam.com および www.wingtiptoys.com として公開されます。各サイトには、お互いのサイトへの絶対リンクが含まれています。たとえば、IIS\_fabrikam のサイトには IIS\_wingtiptoys のサイトへのリンクが含まれています。これらのリンクは既定のリンク変換辞書では変換されません。この辞書では、既定により、公開されているサーバーの名前だけが Web 公開ルールの \[動作\] タブの指定に従って変換されます。

#### 手順

外部クライアントがページを表示できるようにするには、両方のサイトにそれぞれ適切なリンク変換辞書を使用して Web 公開ルールを作成する必要があります。ここでは、「シナリオ 1 : 1 つのサーバーを公開する」で作成したルールとポリシーの要素が ISA Server で引き続き有効であることが前提となっています。また、Link Translator Web フィルタが有効になっていることも前提となっています。このシナリオを構成するには、これから説明する追加手順を実行してください。

1.  Publish IIS\_Fabrikam Web 公開ルールのリンク変換辞書を修正する

3.  「手順 2. 宛先セットを作成する」の説明に従って、IIS\_wingtipstoys という宛先セットを作成する

3.  Publish IIS\_wingtiptoys という Web 公開ルールを作成する

4.  Publish IIS\_wingtiptoys Web 公開ルールのリンク変換辞書を作成する

8.  

**手順 1. Publish IIS\_Fabrikam ルールのリンク変換辞書を修正する**

**www.wingtiptoys.com の宛先セットを作成するには**

1.  \[ISA の管理\] コンソールツリーで、\[Internet Security and Acceleration Server\]、\[サーバーとアレイ\]、目的のアレイ、\[公開\]、\[Web 公開ルール\] の順にクリックします。

3.  詳細ペインで、「手順 3. IIS\_Fabrikam を公開するための Web 公開ルールを作成する」で作成したルールを右クリックします。

3.  \[リンクの変換\] タブの \[追加\] をクリックし、以下の操作を行います。

    1.  上の編集ボックスに「http://IIS\_wingtiptopys」と入力します。

    3.  下の編集ボックスに「http://www.wingtiptoys.com」と入力します。

    3.  \[OK\] をクリックします。

        **注意** ポート番号を含む Web サイト上のリンク、または HTTPS を使って、サイトをセキュリティで保護するためのリンクに対するリンク変換辞書も作成する必要があります。

    6.  

6.  

**手順 2. www.wingtiptoys.com の宛先セットを作成する**

**www.wingtiptoys.com の宛先セットを作成するには**

1.  \[ISA の管理\] コンソールツリーで、\[Internet Security and Acceleration Server\]、\[サーバーとアレイ\]、目的のアレイ、\[ポリシーの要素\] の順にクリックし、\[宛先セット\] を右クリックして、\[新規作成\]、\[セット\] の順にクリックします。

3.  \[名前\] に宛先セットの名前を入力します。たとえば、「Wingtiptoys\_Set」と入力します。

3.  \[追加\] をクリックします。

4.  \[宛先\] に「www.wingtiptoys.com」と入力します。

8.  

**手順 3. www.wingtiptoys.com を公開するための Web 公開ルールを作成する**

**サーバーを公開するための Web 公開ルールを作成するには**

1.  \[ISA の管理\] コンソールツリーで、\[Internet Security and Acceleration Server\]、\[サーバーとアレイ\]、目的のアレイ、\[公開\] の順にクリックし、\[Web 公開ルール\] を右クリックして、\[新規作成\]、\[ルール\] の順にクリックします。

3.  \[Web 公開ルールの名前\] にルール名を入力します。たとえば、「Publish IIS\_Wingtiptoys」と入力します。次に、\[次へ\] をクリックします。

3.  \[ルールの適用先\] で \[指定された宛先セット\] を選択します。次に、\[名前\] で「手順 2. www.wingtiptoys.com の宛先セットを作成する」で作成した Wingtiptoys 宛先セットを選択します。\[次へ\] をクリックします。

4.  \[クライアントの種類\] ページで \[すべての要求\] を選択します。次に、\[次へ\] をクリックします。

5.  \[ルールの動作\] ページで \[要求をこの内部 Web サーバーへリダイレクトする (名前または IP アドレス)\] を選択します。テキストボックスに「IIS\_wingtiptoys」と入力します。\[次へ\]、\[完了\] の順にクリックします。

6.  詳細ペインで、新しいルール (Publish IIS\_Wingtiptoys) を右クリックし、\[プロパティ\] をクリックします。

7.  \[リンクの変換\] タブで \[リンクの変換を実行する\] を選択します。

14. 

**手順 4. Publish IIS\_wingtiptoys ルールのリンク変換辞書を作成する**

**リンク変換辞書を作成するには**

1.  \[ISA の管理\] コンソールツリーで、\[Internet Security and Acceleration Server\]、\[サーバーとアレイ\]、目的のアレイ、\[公開\]、\[Web 公開ルール\] の順にクリックします。

3.  詳細ペインで、「手順 3. www.wingtiptoys.com を公開するための Web 公開ルールを作成する」で作成したルールを右クリックします。

3.  \[リンクの変換\] タブの \[追加\] をクリックし、以下の操作を行います。

    1.  上の編集ボックスに「http://fabrikam」と入力します。

    3.  下の編集ボックスに「http://www.fabrikam.com」と入力します。

    3.  \[OK\] をクリックします。

        **注意** この場合も、ポート番号を含む Web サイト上のリンク、または HTTPS を使ってサイトをセキュリティで保護するためのリンクに対するリンク変換辞書を作成してください。

    6.  

6.  

#### リンク変換が不要な場合 (複数のサイトを公開する)

ここでは、リンク変換機能を必要としない共通の Web 公開シナリオについて説明します。これらのシナリオでは、Web 公開ルールとルーティングルールを正しく構成することにより、複数のサイトを公開できます。

**1 つのサーバー上にある複数のサイトを公開する**

IIS サーバーでは、1 つのサーバー上に複数の仮想サイトを定義できます。これらのサイトは、サイト間にクロスリンクががない場合は "独立サイト" と呼ばれます。たとえば、My\_internal という内部 Web サーバーに www.fabrikam.com および www.wingtiptoys.com という 2 つの仮想サイトがあるとします。クライアントはこれらのサイトに名前でアクセスできます。これらの Web サイトを保護するには、ISA Server をインストールします。ISA Server の外部 IP アドレスには、Web サーバーの外部 IP アドレス上で既に公開されているサイト名が関連付けられます。

このシナリオを実装するには、www.fabrikam.com と www.wingtiptoys.com の両方を含む宛先セットに適用できる Web 公開ルールを作成します。これにより、要求が My\_internal にリダイレクトされます。\[公開サーバーに送信されたオリジナルのホストヘッダーを、上で指定したサーバーに送信する\] が選択されていることを確認します。こうすることで、たとえばクライアントが www.fabrikam.com を要求した場合、ISA Server はその要求を受信し、My\_internal という内部コンピュータにリダイレクトします。ISA Server は要求 www.fabrikam.com に含まれるホストヘッダーを My\_internal 上の IIS サーバーに渡します。IIS サーバーはその要求を www.fabrikam.com 仮想 Web サイトにマップします。

**1 つのサーバー上にある複数のサイトを複数のパスを持つ 1 つのサイトとして公開する**

このシナリオでは、IIS\_fabrikam という 1 つの Web サーバーが、fabrikam\_Sales および fabrikam\_Marketing という 2 つの内部 Web サイトをホストします。クライアントはこれらのサイトに www.fabrikam.com\\Marketing および www.fabrikam.com\\Sales としてアクセスできます。名前 www.fabrikam.com は、ISA Server 上の外部 IP アドレスにマップされます。

このシナリオを有効にするには、Web 公開ルールとルーティングルールを組み合わせて使用します。以下の手順を実行します。

1.  \[パス\] が Sales に設定された宛先 www.fabrikam.com を含む宛先セットに適用する、Web 公開ルールを作成します。\[動作\] を \[要求をこの内部 Web サーバーへリダイレクトする (名前または IP アドレス)\] に設定し、編集ボックスに「fabrikam\_Sales」と入力します。

3.  \[パス\] が Marketing に設定された宛先 www.fabrikam.com を含む宛先セットに適用する Web 公開ルールを作成します。\[動作\] を \[要求をこの内部Web サーバーへリダイレクトする (名前または IP アドレス)\] に設定し、編集ボックスに「fabrikam\_Marketing」と入力します。

3.  以下の設定でルーティングルールを作成します。

    1.  2 つの宛先セット、fabrikam\_Sales および fabrikam\_Marketing に適用します。ルーティングルールの宛先セットには内部 Web サイトの名前が含まれていることに注意してください。

    3.  \[動作\] は \[ホストされたサイトにリダイレクトする\] に設定します。

    3.  ホストされたサイトは Web サーバーの (内部) IP アドレスに設定します。

    6.  

6.  

または、%windir%\\system32\\drivers\\etc フォルダにあるホストファイルを編集して、内部サイト、fabrikam\_Sales および fabrikam\_Marketing の仮想名を内部 Web サーバーの IP アドレスにマップすることもできます。

たとえば、ISA Server は www.fabrikam.com\\Sales を求める着信クライアント要求を、以下のように処理します。

1.  ISA Server は Web 公開ルールを確認して、要求を許可するルールを検索します。

3.  要求を許可する Web 公開ルールでは、オリジナルのホストヘッダーは、\[動作\] タブに指定されている要求のリダイレクト先のサーバーの名前に置き換えられます。この場合は fabrikam\_Sales が使用されます。

3.  ルーティングルールでは、fabrikam\_Sales をルーティングルールの宛先セットと一致させるホストヘッダーと見なして、要求が処理されます。前に作成したルーティングルールが適用されると、要求は指定した IP アドレス、つまりWeb サーバーにリダイレクトされます。

    hosts ファイルを使用して fabrikam\_Sales と fabrikam\_Marketing を Web サーバーの IP にマップした場合、DNS サーバーは要求を IIS\_fabrikam にリダイレクトします。

6.  

**複数のサーバー上にある複数のサイトを公開する**

このシナリオでは、IIS\_fabrikamSales および IIS\_fabrikamMarketing という 2 つの Web サーバーが、fabrikam\_Sales および fabrikam\_Marketing という 2 つの内部 Web サイトをホストします。クライアントはこれらのサイトに www.fabrikam.com\\Marketing および www.fabrikam.com\\Sales としてアクセスできます。名前 www.fabrikam.com は、ISA Server の外部 IP アドレスにマップされます。

このシナリオを有効にするには、Web 公開ルールを作成します。また、IIS サーバー上に仮想ディレクトリを追加します。以下の手順を実行します。

1.  \[パス\] が Sales に設定された宛先 www.fabrikam.com を含む宛先セットに適用する、Web 公開ルールを作成します。\[動作\] を \[要求をこの内部 Web サーバーへリダイレクトする (名前または IP アドレス)\] に設定し、編集ボックスに「fabrikam\_Sales」と入力します。

3.  \[パス\] が Marketing に設定された宛先 www.fabrikam.com を含む宛先セットに適用する、Web 公開ルールを作成します。\[動作\] を \[要求をこの内部 Web サーバーへリダイレクトする (名前または IP アドレス)\] に設定し、編集ボックスに「fabrikam\_Marketing」と入力します。

3.  要求が ISA Server によって適切な Web サーバーにリダイレクトされるときは、Get /Marketing または Get /Sales としてリダイレクトされます。これら Sales および Marketing というディレクトリは、実際に IIS サーバー上に存在するわけではありません。これを解決するには、IIS で仮想ディレクトリを使用します。次の手順を実行します。

    1.  fabrikam\_Sales という Web サーバーで、以下のプロパティを指定した仮想ディレクトリを新規作成します。\[エイリアス\] は Sales に、\[パス\] は既定の Web サイトのホームディレクトリ (通常は、&lt;ドライブ&gt;:\\inetpub\\wwwroot) に設定します。

    3.  fabrikam\_Marketing という Web サーバーで、以下のプロパティを指定した仮想ディレクトリを新規作成します。\[エイリアス\] は Marketing に、\[パス\] は既定の Web サイトのホームディレクトリ (通常は、&lt;ドライブ&gt;:\\inetpub\\wwwroot) に設定します。

    4.  

6.  

このように、適用される Web 公開ルールによって、着信したクライアント要求が適切な Web サーバーに送信されます。Web サーバー自体は要求を仮想ディレクトリにマップします。

[](#mainsection)[ページのトップへ](#mainsection)

### シナリオ 3: ブリッジおよびリンク変換

ISA Server のブリッジのシナリオでは、クライアントが HTTPS 要求を行うと、ISA Server はその要求を受信してから要求が公開されている IIS サーバーに転送します。それから、ISA Server は FTP、HTTP または HTTPS (SSL) を使って、公開されている IIS サーバーと通信できます。一部の状況では、内部ネットワークである ISA Server コンピュータと IIS サーバー間にセキュリティで保護された接続は必要ありません。クライアントがセキュリティで保護された通信を使用するだけで十分です。

ISA Server は、Web 公開ルールの構成に従って、着信したクライアント要求を変更します。つまり、ブリッジと “オリジナルのホストヘッダーの使用" オプションの構成方法に応じて、ISA はスキーマ (プロトコル) とホストヘッダーの一方または両方を置き換えます。

ヘッダーに絶対リンクが含まれる場合、ISA Server は応答を返すときに、そのヘッダーに行った変更を取り消します。つまり、要求でスキーマかホストヘッダーまたはこの両方が変更された場合、応答ヘッダーのリンクに含まれるスキーマ名かサーバー名またはこの両方が元の値に戻されます。ただし、応答の本文に絶対リンクが含まれる場合は、Link Translator Web フィルタが必要です。

ここで説明するシナリオでは、クライアントは HTTPS を使用して www.fabrikam.com にデータを要求します。ブリッジは、ISA Server コンピュータから内部 IIS サーバー (IIS\_Fabrikam) に渡される要求によって HTTP として構成されます。

-   通常、ブリッジのシナリオでは、内部 Web サイト上に絶対リンクは含まれず、Link Translator Web フィルタは不要です。ただし、クライアントが HTTPS を要求した場合でも、Web サーバーの応答にセキュリティで保護されていないリンクが含まれる場合があります。この場合、リンクで HTTP を HTTPS にマップするためにリンク変換が必要です。これにより、クライアントと ISA Server 間でセキュリティで保護された通信が可能になります。


-   通常、HTTP を介して FTP サーバーを公開する場合は Link Translator Web フィルタは不要です。ただし、クライアントに返される FTP ページに絶対リンクが含まれている場合は例外です。この場合、対応するコンテンツグループが Link Translator Web フィルタに対応していることを確認してください。



#### 手順

ISA Server と IIS サーバー間の通信が HTTP でも、外部クライアントが SSL 接続を介してページを表示できるようにする必要がある場合もあります。この場合、Web 公開ルールを修正してリンク変換を有効にします。既定のリンク変換辞書はこのシナリオに適用されるため、修正の必要はないということに注意してください。ここでは、「シナリオ 1 : 1 つのサーバーを公開する」で作成したルールとポリシーの要素が ISA Server で引き続き有効であることが前提となっています。このシナリオを構成するには、これから説明する追加手順を実行してください。

-   Web 公開ルールを修正して、ブリッジを構成し、リンク変換を有効にする



**手順 1. Publish IIS\_Fabrikam Web 公開ルールを修正する**

**Publish IIS\_Fabrikam Web 公開ルールを修正するには**

1.  \[ISA の管理\] コンソールツリーで、\[Internet Security and Acceleration Server\]、\[サーバーとアレイ\]、目的のアレイ、\[公開\]、\[Web 公開ルール\] の順にクリックします。

3.  詳細ペインで、Publish IIS\_Fabrikam Web 公開ルールを右クリックして、\[プロパティ\] をクリックします。

3.  \[ブリッジ\] タブで \[HTTP 要求として処理 (保護されたチャネルをプロキシで停止)\] が選択されていることを確認します。

4.  \[リンクの変換\] タブの \[追加\] をクリックし、以下の操作を行います。

    1.  上の編集ボックスに「http://IIS\_Fabrikam」と入力します。

    3.  下の編集ボックスに「https://www.fabrikam.com」と入力します。

    3.  \[OK\] をクリックします。

    6.  

[](#mainsection)[ページのトップへ](#mainsection)

### シナリオ 4: 同じサーバー上で HTTP と HTTPS を公開する

1 つの Web サイトにセキュリティで保護された (HTTPS) コンテンツと保護されていない (HTTP) コンテンツが両方とも含まれる場合があります。たとえば、IIS\_Fabrikam という Web サイトについて考えてみます。サイト自体はセキュリティで保護され、HTTPS を使用しないとアクセスできません。しかし、/images フォルダ内にあるサイトのイメージには HTTP を使用してアクセスできます。このサイトは www.fabrikam.com として公開されています。

クライアントが SSL を使用してこのサイトに接続すると、Web 公開ルールでリンク変換が有効になっていれば、イメージへの絶対リンクは HTTPS:// として変換されます。HTTP を使用する絶対リンクが HTTPS に変換されないようにするには、リンク変換辞書にエントリを追加する必要があります。この方法を使用すると、パフォーマンスが低下しません。

#### 手順

外部クライアントが HTTP を使用してイメージを表示できるようにするには、リンク変換辞書を修正する必要があります。ここでは、「シナリオ 1 : 1 つのサーバーを公開する」で作成したルールとポリシーの要素が ISA Server で引き続き有効であることが前提となっています。このシナリオを構成するには、これから説明する追加手順を実行してください。

-   Publish IIS\_Fabrikam Web 公開ルールのリンク変換辞書を修正する



**手順 1. Publish IIS\_Fabrikam ルールのリンク変換辞書を修正する**

**Publish IIS\_Fabrikam のリンク変換辞書を修正するには**

1.  \[ISA の管理\] コンソールツリーで、\[Internet Security and Acceleration Server\]、\[サーバーとアレイ\]、目的のアレイ、\[公開\]、\[Web 公開ルール\] の順にクリックします。

3.  詳細ペインで、Publish IIS\_Fabrikam Web 公開ルールを右クリックして、\[プロパティ\] をクリックします。

3.  \[リンクの変換\] タブの \[追加\] をクリックし、以下の操作を行います。

    1.  上の編集ボックスに「http://IIS\_Fabrikam/images」と入力します。

    3.  下の編集ボックスに「http://www.fabrikam.com/images」と入力します。

    3.  \[OK\] をクリックします。

    6.  

4.  \[リンクの変換\] タブの \[追加\] をクリックし、以下の操作を行います。

    1.  上の編集ボックスに「http://IIS\_Fabrikam:80/images」と入力します。

    3.  下の編集ボックスに「http://www.fabrikam.com/images」と入力します。

    3.  \[OK\] をクリックします。

    6.  

[](#mainsection)[ページのトップへ](#mainsection)

### 変換されたリンクを含む Web ページのセキュリティ保護レベルの向上

変換されたリンクを含む Web ページには、セキュリティ上の危険が伴う場合があります。このようなセキュリティ上の危険を回避するため、ISA Server での宛先セットの定義は慎重に行い、Web 公開ルールを特定の宛先セットに制限するようにします。

たとえば、宛先セットを作成するときは、サーバー名に \*.microsoft.com などのワイルド記号を使用しないでください。代わりに、www.microsoft.com および mail.microsoft.com などのように、ISA Server の外部 IP アドレスにマップされるすべてのサーバー名を指定します。

[](#mainsection)[ページのトップへ](#mainsection)
