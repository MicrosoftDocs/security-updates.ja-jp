---
TOCTitle: 'MS00-052'
Title: 'マイクロソフト セキュリティ情報 MS00-052 - 緊急'
ms:assetid: 'ms00-052'
ms:contentKeyID: 61228218
ms:mtpsurl: 'https://technet.microsoft.com/ja-JP/library/ms00-052(v=Security.10)'
---

Security Bulletin

マイクロソフト セキュリティ情報 MS00-052 - 緊急
===============================================

「Shell の相対パス」 の脆弱性に対する対策
-----------------------------------------

公開日: 2000年8月9日 | 最終更新日: 2001年4月9日

#### 概要 :

Microsoft は、Microsoft® Windows NT® 4.0 および Windows® 2000 のセキュリティ問題を修正するモジュールをリリースしました。特定の状況で、悪意のあるユーザーがこのセキュリティ問題を利用して、後でほかのユーザーが同じコンピュータにログオンしたときに、自分が指定したコードを実行させることができます。 

**影響を受けるソフトウェアのバージョン :**

-   Microsoft Windows NT 4.0 Workstation
-   Microsoft Windows NT 4.0 Server
-   Microsoft Windows NT 4.0 Server, Enterprise Edition
-   Microsoft Windows NT 4.0 Server, Terminal Server Edition
-   Microsoft Windows 2000 Professional
-   Microsoft Windows 2000 Server
-   Microsoft Windows 2000 Advanced Server

### 詳細

問題
----

 
Windows Shell の実行可能ファイル (Explorer.exe) を指定するレジストリ エントリは、絶対パスではなく、相対パスで設定されています (FAQ で説明されているように、この設定は、レガシー アプリケーションとの互換性を保つのに必要です)。システムの起動時の環境に従い、通常の順序でパス検索を行うと、Systemdrive%\\ ディレクトリに置かれた Explorer.exe という名前で保存されたファイルが最初にロードされます。このため、悪意のあるユーザーが作成したファイルが Explorer.exe になりすまし、正しいバージョンの Explorer.exe がロードされない可能性があります。この結果、悪意のあるユーザーは、後でほかのユーザーが同じコンピュータにログオンしたときに、自分が指定したコードを実行させることが可能となります。

通常は、悪意のあるユーザーは対話型ログオンが可能なコンピュータ以外から、このセキュリティ問題を利用することができません。このため、こうした危険にさらされる可能性は、ワークステーションやターミナル サーバーで高くなります。標準で推奨されているセキュリティ方法に従っている場合、一般のユーザーには、ドメイン コントローラやプリント/ファイル サーバー、E RP サーバー、Web サーバーなどのセキュリティを重視するコンピュータに対話型ログオン権限は付与されていません。

よく寄せられる質問
------------------

 
**マイクロソフトセキュリティ情報 MS00-052 はどのような内容の通知ですか?**

このマイクロソフト セキュリティ情報 MS00-052 は、Microsoft® Windows NT® 4.0 と Windows® 2000 のセキュリティ上の脆弱性を排除する更新プログラムがリリースされたことを、お客様にお知らせするものです。マイクロソフトでは、お客様の情報の保護に全力を挙げて努めております。この通知で、お客様に脆弱性の詳細とその対策をお知らせします。

**この脆弱性はどれくらいの範囲に影響を与えますか?**

この脆弱性を利用して、悪意のあるユーザーは[対話的にログオン](http://www.microsoft.com/japan/security/glossary.mspx)できるマシンで通常の Windows デスクトップを自身の選択によるコードに置き換えることができます。後でほかのユーザーが同じマシンにログオンした時、このようなコードが自動的に動作します。そして、そのマシンでユーザーが持つ権限の範囲内で任意の操作ができます。

主に Workstation と Terminal Server がこの脆弱性による影響を受けます。通常のセキュリティ対策が講じられていれば、プリント/ファイル サーバー、ドメイン コントローラ、ERP サーバーなどのセキュリティを重視するサーバーに通常のユーザーが対話的にログオンすることはできません。

**この脆弱性の原因は何ですか?**

この脆弱性の原因はWindows Shell の機能を提供する実行可能なファイルの名前が Windows が起動時に参照するレジストリ キーにある相対パスにより （絶対パスではなく） 指定されるためです。偽のバージョンの Windows Shell が検索順序で正当なバージョンの前に存在している場合、偽のバージョンがシステム起動でロードされます。

**Windows Shell とは何ですか?**

Windows Shell は Windows との対話に使用される一般的なデスクトップです。システム起動時に、Windows NT 4.0 と Windows 2000 は 「Shell」 レジストリ エントリHKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell を参照し、Shell としてロードされる実行可能なファイルの名前を決定します。デフォルトでこの値は Explorer.exe を指定します。

**これは Explorer.exe の問題なのですか?**

いいえ、違います。この脆弱性は Explorer.exe 自体とは何の関係もありません。しかし、Shell レジストリ エントリのデフォルト値は絶対パスではなく相対パスで Explorer.exe を指定することになります。つまり、「%systemroot%\\Explorer.exe」 ではなく 「Explorer.exe」 として指定されます。

**なぜ、絶対パス名ではなく相対パス名により Explorer.exe を指定することが問題なのですか?**

この問題はシステム起動が処理中に起きる検索順序と関連しています。レジストリ エントリが、相対パスを使用してコード モジュール名を指定する場合、Windows はコードを探すために検索処理を開始します。検索順序は次の通りです。

1. カレント ディレクトリを検索します。
2. コードが見つからない場合、HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\\Path で指定されたディレクトリを検索します。この検索順序はディレクトリが指定されている順序です。
3. コードが見つからない場合、HKEY\_CURRENT\_USER\\Environment\\Path で指定されたディレクトリを検索します。この検索順序はディレクトリが指定されている順序です。

HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\\Path と HKEY\_CURRENT\_USER\\Environment\\Path のデフォルト設定はそれぞれ 「%SystemRoot%\\System32;%SystemRoot %」 と Null です。システム起動時のカレント ディレクトリは %SystemDrive%\\ で、検索パスの結果は次の通りです。

1. %SystemDrive%\\ （例 C:\\）
2. %SystemRoot%\\System32 （例 C:\\WINNT\\System32）
3. %SystemRoot% （例 C:\\WINNT）

この脆弱性は %SystemDrive%\\ のデフォルト許可で全ての対話的なユーザーが %SystemDrive%\\ に書き込みが可能であることにより発生します。C ドライブから起動するマシンに悪意のあるユーザーが C ドライブに偽の Explorer.exe を置いたとします。この場合、検索順序により、ユーザーがマシンにログオンするごとに正当な Explorer.exe ではなく、偽の Explorer.exe がロードされ実行されます。

**なぜ Explorer.exe は Shell レジストリ値の絶対パス名により指定されないのですか?**

通常、Explorer.exe は Shell レジストリ値の絶対パス名により指定されます。マイクロソフトはレジストリ エントリが実行可能ファイルの位置を供給する場合、絶対パスによりファイルが指定されることを推奨します。

これが特定の場合の Shell レジストリ値でに行われない理由はレガシー アプリケーションの互換性が原因となっています。多くのアプリケーション、特に古いものは、基本的に Shell 名を決定するために、インストール中に Shell 値を参照します。アプリケーションの中には、ファイル名と拡張子が供給されている場合のみ処理を行うようにコードされ、値に絶対パスが含まれている場合、動作を停止するものがあります。この理由により、マイクロソフトの提供するレジストリ値の中で、Shell 値は相対パスを使用するのです。

**偽の Explorer.exe は何をしますか?**

コードはユーザーがそのマシンで権限を取得している操作なら何でも実行できます。あまり権限を持っていないユーザーがログオンした場合、コードは多くのことを実行できません。一方、マシンやドメインで多くの権限を持っているユーザーがログオンした場合、コードは大きな損害を引き起こす可能性があります。標準のセキュリティ勧告として、ドメイン管理者などの権限の高いユーザーが信頼されていないマシンを使用することは避けるべきです。

**ユーザーは偽のコードが動作することを回避できますか?**

いいえ、できません。Shell コードはシステム起動の一部として動作しますので、ユーザーはそれを起動させることを回避できません。

**この脆弱性は偶発的に発生しますか?**

いいえ。発生させるには特定の手順が必要となります。

**この脆弱性はリモートで利用できますか?**

いいえ。デフォルト状態では、悪意のあるユーザーが対話的にマシンにログオンすることができる場合にだけこの脆弱性が利用されます。つまり、キーボードでログオンできる場合です。この脆弱性がリモートで利用されるのは、マシンの管理者が悪意のあるユーザーのマシンのルート ディレクトリを共有し、悪意のあるユーザーにその共有ディレクトリに書き込み許可を与えている場合だけです。

**この脆弱性の影響を最も受けるのはどのマシンですか?**

最も重要なことは、上記で説明したように悪意のあるユーザーが対話的にログオンできるマシンでのみこの脆弱性が利用されます。その結果、Workstation　や Terminal Server などの通常のユーザーが対話的にログオンできるマシンが最も影響を受けます。

標準のセキュリティ勧告として、ドメイン コントローラ、プリント/ファイル サーバー、ERP サーバー、データベース サーバーなどのセキュリティを重視するコンピュータに通常のユーザーに対話的にログオンすることを許可してはいけません。この勧告に従えば、これらのマシンは危険にさらされることはありません。

**誰が更新プログラムを適用する必要がありますか?**

マイクロソフトは通常のユーザーが対話的にログオンできるマシンとルート ディレクトリがグローバルに共有されているマシンにこの更新プログラムをインストールすることを推奨します。

**更新プログラムは何を変更するのですか?**

上記で説明したようにアプリケーションの互換性問題のため、「Shell」 レジストリ エントリでの絶対パス名の使用により状況を修正することは非常に困難です。  

「Shell」 エントリで指定された値の前に %systemroot% がありますが、この更新プログラムはその前につける特別な格をスタートアップ コードに導入することによりこの脆弱性を排除します。

**どこで更新プログラムを入手できますか?**

マイクロソフト セキュリティ情報 MS00-052 からダウンロードしていただけます。

**更新プログラムはどのように使用するのですか?**

サポート技術情報 [269049](http://support.microsoft.com/kb/269049) には、お客様のサイトに更新プログラムを提供するための詳細な情報が記載されています。

**この問題に対してマイクロソフトはどのような対応をしていますか?**

-   マイクロソフトは、この脆弱性を排除する更新プログラムを開発しました。
-   マイクロソフトは、セキュリティ上の脆弱性の詳細とその対策をお客様にご理解いただくために、セキュリティ情報 MS00-052 と、この faq を提供しています。
-   マイクロソフトは、マイクロソフト社の最新のセキュリティ情報を無料でご購読いただける[マイクロソフト プロダクト セキュリティ 警告サービス](http://technet.microsoft.com/ja-jp/security/dd252948.aspx) にて、購読の登録をされているお客様に、セキュリティ情報の通知を行っています。
-   マイクロソフトはサポート技術情報 [269049](http://support.microsoft.com/kb/269049) を公開し、このセキュリティ上の脆弱性と更新プログラムの詳細と説明しています。

**推奨するセキュリティ設定の詳細情報はどこで入手できますか?**

マイクロソフトが提供するセキュリティ情報の詳細は、弊社の[セキュリティ](http://technet.microsoft.com/ja-jp/security/default.aspx)の Web サイトから入手してください。

**テクニカルサポートを受けるにはどこに問い合わせればよいですか?**

マイクロソフトの製品に関するテクニカルサポートは、[電話番号とサポートオプションのサイト](http://support.microsoft.com/gp/cntactms)を参照してください。

更新プログラム
--------------

 
この問題を解決するための日本語版更新プログラムは、以下のサイトからダウンロードできます。

-   Windows NT 4.0 :  
    この問題に対する更新プログラムは Windows NT 4.0 のセキュリティ ロールアップ パッケージ (SRP) に含まれています。  
    個別の更新プログラムよりもセキュリティ ロールアップ パッケージを適用することをお勧めします。  
    NT4.0 のセキュリティ ロールアップ パッケージは次のリンクから入手してください。

    [299444](http://support.microsoft.com/kb/299444) Post Windows NT 4.0 SP6a セキュリティ ロールアップ パッケージ (SRP)

    なお、個別の更新プログラムは次のリンクから入手することができます。  
    [http://www.microsoft.com/ntserver/nts/downloads/Critical/q269049/default.asp](http://www.microsoft.com/ntserver/nts/downloads/critical/q269049/default.asp)

    -   PC/AT 互換機用  
        ダウンロード先のリストから Japanese Language Version を選択してください。
    -   NEC PC-9800 シリーズ用  
        ダウンロード先のリストから Japanese NEC Language Version を選択してください。

    注: 本更新プログラムは Windows NT 4.0 Service Pack 4, 5, 6a が動作しているシステムに適用できます。

-   Windows NT 4.0 Server, Terminal Server Edition:  
    [http://www.microsoft.com/ntserver/terminalserver/downloads/critical/
    q269049/default.asp](http://www.microsoft.com/ntserver/terminalserver/downloads/critical/q269049/default.asp)

    -   PC/AT 互換機用  
        ダウンロード先のリストから Japanese Language Version を選択してください。

    **注 :**  
    本更新プログラムは Windows NT 4.0 Server, Terminal Server Edition Service Pack 4, 5, 6 が動作しているシステムに適用できます。

-   Windows 2000 :  
    この問題に対する修正は Windows 2000 サービスパック 2 に含まれております。最新の Windows 2000 サービスパックについては次のリンクから入手してください。  
    [http://www.microsoft.com/downloads/details.aspx?FamilyID=dc27b8c6-2a5a-4399-ad3d-4a97a25f41d9&DisplayLang=ja](http://www.microsoft.com/downloads/details.aspx?familyid=dc27b8c6-2a5a-4399-ad3d-4a97a25f41d9&displaylang=ja)  

    個別モジュールは次のリンクより入手することができます。  
    <http://www.microsoft.com/windows2000/downloads/critical/q269049/default.asp>  
    -   PC/AT 互換機用  
        ダウンロード先のリストから Japanese Language Version を選択してください。  
    -   NEC PC-9800 シリーズ用  
        ダウンロード先のリストから Japanese NEC Language Version を選択してください。  

更新プログラムについてのご質問は、マイクロソフト プロダクト サポート までご連絡ください。マイクロソフトでは、ご質問の内容が弊社製品の不具合が原因の場合、サポート料金はいただきません。それ以外の場合には、サポート料金を請求させていただきますのでご注意ください。
[マイクロソフト プロダクト サポートへの連絡方法はこちらをご覧ください。](http://www.microsoft.com/japan/security/support/patchqa.mspx)

### その他の情報

**詳細情報 :**

-   US マイクロソフトセキュリティ情報（MS00-052）  
    [http://www.microsoft.com/technet/security/bulletin/ms00-052.mspx](http://technet.microsoft.com/security/bulletin/ms00-052)
-   サポート技術情報 （KB） 文書番号 ： 269049  
    [レジストリ呼び出しのプログラムが通常の検索パスを使用する](http://support.microsoft.com/kb/269049)

本セキュリティ情報に含まれている情報は、いかなる保証もない現状ベースで提供されるものです。Microsoft Corporation 及びその関連会社は、市場性および特定の目的への適合性を含めて、明示的にも黙示的にも、一切の保証をいたしません。さらに、Microsoft Corporation 及びその関連会社は、本文書に含まれている情報の使用及び使用結果につき、正確性、真実性等、いかなる表明・保証も行ないません。Microsoft Corporation、その関連会社及びこれらの権限ある代理人による口頭または書面による一切の情報提供またはアドバイスは、保証を意味するものではなく、かつ上記免責条項の範囲を狭めるものではありません。Microsoft Corporation、その関連会社 及びこれらの者の供給者は、直接的、間接的、偶発的、結果的損害、逸失利益、懲罰的損害、または特別損害を含む全ての損害に対して、状況のいかんを問わず一切責任を負いません。（Microsoft Corporation、その関連会社 またはこれらの者の供給者がかかる損害の発生可能性を了知している場合を含みます。) 結果的損害または偶発的損害に対する責任の免除または制限を認めていない地域においては、上記制限が適用されない場合があります。  

*Built at 2014-04-18T01:50:00Z-07:00*
