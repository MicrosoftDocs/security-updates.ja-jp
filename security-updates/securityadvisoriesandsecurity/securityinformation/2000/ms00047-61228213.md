---
TOCTitle: 'MS00-047'
Title: 'マイクロソフト セキュリティ情報 MS00-047 - 重要'
ms:assetid: 'ms00-047'
ms:contentKeyID: 61228213
ms:mtpsurl: 'https://technet.microsoft.com/ja-JP/library/ms00-047(v=Security.10)'
---

Security Bulletin

マイクロソフト セキュリティ情報 MS00-047 - 重要
===============================================

「NetBIOS Name Server Protocol Spoofing」 の脆弱性に対する対策
--------------------------------------------------------------

公開日: 2000年8月7日 | 最終更新日: 2001年5月11日

#### 概要 :

マイクロソフトは、 Microsoft® Windows® システムに実装されているプロトコルのセキュリティ上の脆弱性を排除する更新プログラムをリリースしました。この脆弱性により、マシンが、サービス要求に対する応答を拒否するようにすることができる場合があります。 

**影響を受けるソフトウェアのバージョン** **:**

-   Microsoft Windows NT 4.0 Workstation
-   Microsoft Windows NT 4.0 Server
-   Microsoft Windows NT 4.0 Server, Enterprise Edition
-   Microsoft Windows NT 4.0 Server, Terminal Server Edition
-   Microsoft Windows 2000

### 詳細

問題
----

<span></span>
Windows Internet Name Service (WINS) では、NetBIOS over TCP/IP (NBT) プロトコル ファミリーの一部である NetBIOS Name Server (NBNS) プロトコルが使用されます。NBNS の仕様では、WINS サーバーだけでなく NetBIOS クライアントも、名前重複の確認を行います。またこのプロトコルは、仕様により認証を必要としません。そのため、悪意のあるユーザーがこのプロトコルを使用し、あるコンピュータが WINS サーバーを装い、名前の重複および名前解放のメカニズムを悪用することにより、他のコンピュータにコンピュータ名と重複しているという検出結果を出させてしまうことがあります。場合によっては､その結果、ネットワーク上にコンピュータを登録できなくなったり、すでに登録されている名前を放棄させてしまうことができることがあります。その結果、いずれのケースにおいても、重複しているという検出結果の出たコンピュータに送られた要求に、コンピュータが応答しなくなってしまいます。
お客様の環境が、推奨されるセキュリティ設定が行われている環境であり、また UDP ポート 137 がファイヤーウォールで遮断している場合、外部からこの脆弱性を攻撃されることはありません。この英語 版更新プログラムを適用すると、管理者の設定により、WINS サーバーに名前登録を試みた際、その応答として受け取った名前重複データグラムのみを受け付けるようコンピュータを構成することができます。また名前解放のデータグラムを全て拒否するよう設定することもできます。なりすましの問題を完全に排除することはできませんが､攻撃の可能性を減らすことはできます。セキュリティを強化したいと考えているお客様は､ポート 137-139 でセッションの認証が行われる Windows 2000 の IPSec をお使いになることを推奨します。

よく寄せられる質問
------------------

<span></span>
**マイクロソフトセキュリティ情報** **MS00-047** **はどのような内容の通知ですか?**

このマイクロソフト セキュリティ情報 MS00-047 は、Microsoft® Windows NT® 4.0 と Windows® 2000 システムに対するサービス拒否攻撃から保護する管理者の機能を向上させる更新プログラムがリリースされたことを、お客様にお知らせするものです。マイクロソフトでは、お客様の情報の保護に全力を挙げて努めております。この通知で、お客様に脆弱性の詳細とその対策をお知らせします。

**どのようなことが起こる可能性がありますか?**

これは[サービス拒否攻撃](http://www.microsoft.com/japan/security/glossary.mspx)の脆弱性です。該当するシステムに使用されている産業標準プロトコルの欠点が原因です。悪意のあるユーザーが Windows NT か Windows 2000 システムに特定のメッセージを送信した場合、マシンがそのネットワーク上での名前を放棄してしまいます。このためネットワークの他のマシンがネットワークからのサービスを要求できなくなります。
この脆弱性は該当するシステムの製品に関する問題が原因ではありません。使用されている産業標準プロトコルの性質によるものです。この更新プログラムは新しい機能を追加し、悪意のあるユーザーが攻撃を行うことをさらに困難にします。

**何が原因で起こりますか?**

この脆弱性は [RFC 1001](http://www.ietf.org/rfc/rfc1001.txt?number=1001) と [1002](http://www.ietf.org/rfc/rfc1002.txt?number=1002) で指定される NetBIOS over TCP/IP (NBT) プロトコルは認証されてなく、ネットワークのマシンにそれらのピアの管理ができるようにしてしまうことが原因です。プロトコルは Windows NT 4.0 と Windows 2000 に正しく実装されていますが、仕様により、悪用や偽装の攻撃を受けやすくなっています。このため、ネットワークのマシンが WINS サーバーを装い、名前重複や名前解放データグラムを他のマシンに送ることができます。そして、マシンがそのマシン名を放棄してサービスのリクエストに応答しないようになります。

**NetBIOS** **とは何ですか?** **また** **NBT** **とは何ですか?**

NetBIOS とは PC ネットワーキングのための一式のネットワーク サービスです。NetBIOS は多数の様々なネットワーキング プロトコル上に実装されます。このため、各例について、サービスがどのように実装されているのか説明する標準が必要です。NBT は NetBIOS サービスがどのように TCP/IP ネットワークで提供されているかを説明するプロトコルです。
この脆弱性は NBT サービスの中の 1 つである NetBIOS Name Service (NBNS) に関係します。NBNS は TCP/IP における DNS と似ています。NetBIOS 名を付けられたマシンの IP アドレスを見つける方法などを提供します。Windows システムで、NBNS は [Windows Internet Name Service](http://technet.microsoft.com/en-us/library/bb742607.aspx) (WINS) として実装されています。

**NBT** **と** **WINS** **の** **Windows** **での実装方法の何が問題になっていますか?**

なにも問題になっていません。NBT も WINS もそれぞれプロトコルに正しく実装されています。ここでの脆弱性はプロトコル自体の欠陥が原因です。これらの欠陥は、今後の Windows バージョンがNetBIOS をサポートしなくなる理由のひとつです。

**プロトコルの何が問題になっていますか?**

どのネーム サービスでも、名前重複が発生している、つまり 2 台のマシンが同じ名前を持っている場合のための準備がなされている必要があります。この脆弱性は名前重複を識別するメカニズムが悪用されるために発生します。特に、名前重複と名前解放メカニズムが悪用されます。

**名前重複メカニズムとは何ですか?**

NBNS では、ネーム サーバーと NetBIOS クライアントの両方とも名前重複をチェックします。マシンが名前を登録または更新するごとに、ネーム サーバーは名前重複をチェックします。また、サーバーが別のネーム サーバーから複製されたデータを受信するごとに、ネーム サーバーは名前重複をチェックします。NetBIOS クライアントはマシンにリクエストを送信し、1 つ以上の応答を受信する場合、名前重複をチェックします。いずれの場合でも、名前重複を発見したマシンは問題となっているマシンに名前重複データグラムを送信し、その名前には今後、応答を拒否します。

**名前重複メカニズムはどのように悪用されますか?**

悪意のあるユーザーはその名前が放棄されるように、重複していない名前のマシンに名前重複データグラムを送信し、サービス要求に対しそのマシンを利用不可能とします。例えば、悪意のあるユーザーが \\\\FILESRV1 という名前のマシンにそのようなデータグラムを送信した場合、その名前には今後応答せず、他のマシンもそのマシンからサービスを要求できなくなります。
しかし、マシンは複数の名前で登録でき、これらのアリアスは偽の名前重複データグラムによる影響を受けません。例えば、\\\\FILESRV1 が \\\\PRTSRV1 としても登録されている場合、\\\\FILESRV1 に関する間違った名前重複レポートを受信したとしても、\\\\PRTSRV1 という名前に対しては引き続き応答できます。

**名前解放メカニズムとは何ですか?**

NBNS では、マシンは名前をもう使用していない場合、明確に解放するか、単に放棄するかのどちらかの方法でその名前を解放します。しかし、NBNS サーバーもまた、名前重複を排除する方法としてマシンがその名前を解放することを要求します。

**名前解放メカニズムはどのように悪用されますか?**

悪意のあるユーザーはマシンに名前解放データグラムを送信して、そのマシンが名前を放棄するようにします。上記に述べた要求なしで送信されてくる名前重複データグラムの例のように、これはマシンがサービス リクエストに応答できなくなる原因となります。

**だれがこの脆弱性を利用しますか?**

ポート 137 UDB （NBNS 名前登録トラフィックが起きるポート） がファイアウォールでブロックされている場合、外部ユーザーによりこの脆弱性が利用されることはありません。標準のセキュリティ対策として、外部のルータとファイアウォールで 137、138 そして 139 TCP/UDP などの全ての NetBIOS ポートをブロックすることを推奨します。

**この脆弱性は偶発的に発生しますか?**

いいえ。悪意のあるユーザーは特定のデータグラムを特定のホストに送信する必要があります。これは偶発的に発生しません。

**単にプロトコルの動作の仕方が問題であるとしたら、なぜ更新プログラムを提供するのですか?**

マイクロソフトは一方的にプロトコルを変更できません。しかし、管理者にどのマシンが他のマシンを名前重複状態にできるかを制限するフレキシビリティを提供することができます。これが更新プログラムの目的の背景です。

**更新プログラムは何を修正しますか?**

更新プログラムは次の 2 つを修正します。

-   Windows NT 4.0 または Windows 2000 マシンが明らかに偽の名前重複データグラムを無視するようにします。マシンが登録した WINS サーバーから名前重複データグラムが送信されない場合や明らかに名前登録リクエストへの応答ではない場合、マシンはデータグラムを無視します。
-   既に Windows 2000 に存在している機能を Windows NT 4.0 マシンに提供します。この機能で管理者はマシンが名前解放データグラムを無視するように構成できます。

しかし、この更新プログラムは名前重複プロセスを装うことを困難にするだけで、不可能にするわけではありません。メッセージに認証を含まないプロトコルは偽装される可能性があり、NetBIOS も例外ではありません。偽装攻撃に対し 100% の保護が必要なお客様は、認証されたセッションを確立するために Windows 2000 の IPSec の使用を考慮するでしょう。例えば、ポート 137 から 139 での全てのセッションを認証する IPSec ポリシーは、NetBIOS により偽装攻撃を防ぎます。

**更新プログラムを適用した後、どのように偽の名前重複データグラムを無視するようにマシンを構成するのですか?**

名前重複データグラムに関する新しい機能は切り替え可能ではありません。いったん更新プログラムがインストールされると、名前重複データグラムでの制限は強制です。

**更新プログラムを適用した後、どのように名前解放データグラムを無視するようにマシンを構成するのですか?**

次のレジストリ値を設定して下さい。

|              |                                                |
|--------------|------------------------------------------------|
| ハイブ       | HKEY\_LOCAL\_MACHINE\\SYSTEM                   |
| キー         | CurrentControlSet\\Services\\NetBT\\Parameters |
| 名前         | NoNameReleaseOnDemand                          |
| 値の種類     | Reg\_DWORD - Boolean                           |
| デフォルト値 | 0 （名前解放は無視されません）                 |

この機能は既に Windows 2000 に存在しています。この更新プログラムはその機能を Windows NT 4.0 システムに追加します。この機能に関する情報は [ネットワーク上の攻撃に対するセキュリティの考察](http://www.microsoft.com/japan/technet/archive/security/prodtech/windows/iis/dosrv.mspx) と [Microsoft Windows 2000 TCP/IP 実装詳細](http://www.microsoft.com/japan/technet/itsolutions/network/deploy/depovg/tcpip2k.mspx) をご覧下さい。

**だれが更新プログラムを適用する必要がありますか?**

マイクロソフトはネットワークで中心的な役割を持つマシンで、管理者がこのような攻撃の対象となりうると判断するマシンだけにこの更新プログラムを適用することを推奨します。

**この更新プログラムを適用すべきではない場合はありますか?**

はい、あります。マイクロソフトはお客様に脆弱性による特定の危険性を考慮し、更新プログラムの適用の利益を重んじるよう常に推奨しています。しかし、この場合、特に重要です。この更新プログラムは設計上の動作を排除し、名前重複が行われることを防ぎます。正当に発生した名前重複が悪意のあるネットワーク ユーザーによるサービス拒否攻撃よりも大きな破壊をネットワークに対し起こす場合もあります。
例えば、WINS サーバーは通常、複製を行う時に名前重複をチェックします。プロトコルで、名前重複が検出された場合、WINS サーバーはその名前を主張しているマシンの 1 つに名前解放要求を送信します。しかし、名前解放要求を受信したマシンで NoNameReleaseOnDemand 設定が有効となっている場合、そのマシンは名前を放棄することを拒否し、名前重複は解決されません。

**更新プログラムはどのように使用するのですか?**

サポート技術情報 [269239](http://support.microsoft.com/kb/269239) には、お客様のサイトに更新プログラムを提供するための詳細な情報が記載されています。

**どこから更新プログラムを入手できますか?**

マイクロソフト セキュリティ情報 MS00-047 をご覧ください。

**NetBIOS** **は全ての** **Windows** **システムの一部として提供されています。なぜ** **Windows 95** **と** **98** **には更新プログラムが提供されていないのですか?**

これらのシステムは NetBIOS を実装しています。しかし、これらのシステム用の更新プログラムは開発されていません。理由はこの更新プログラムの効果と Windows 95 と 98 が最も適切に使用されている状態での役割に互換性がないためです。
上記で説明したように、この脆弱性は NetBIOS に提供されている通常の設計上の管理機能が悪用されることが原因となっています。この更新プログラムはこれらの機能のいくつかを削除します。広範囲に渡って、例えば、大規模なネットワークの全てのワークステーションに、この更新プログラムを適用することは適切ではありません。これはネットワークが正常に発生する名前重複に対応する機能を妨げるからです。大規模なネットワークで広くこの更新プログラムを使用すると、通常の管理機能の損失は、悪意のある攻撃以上ではないにしても、それと同等の被害を起こす原因となります。この結果、セキュリティ上重要なマシンにだけ、この更新プログラムを適用することを推奨します。このような役割において適切である製品にだけ、更新プログラムが開発されました。

**この問題に対してマイクロソフトはどのような対応をしていますか?**

-   マイクロソフトは、この脆弱性を排除する更新プログラムを開発しました。
-   マイクロソフトは、セキュリティ上の脆弱性の詳細とその対策をお客様にご理解いただくために、セキュリティ情報 MS00-047 と、この faq を提供しています。
-   マイクロソフトは、マイクロソフト社の最新のセキュリティ情報を無料でご購読いただける[マイクロソフト プロダクト セキュリティ 警告サービス](http://technet.microsoft.com/ja-jp/security/dd252948.aspx) にて、購読の登録をされているお客様に、セキュリティ情報の通知を行っています。
-   マイクロソフトはサポート技術情報 [269239](http://support.microsoft.com/kb/269239) を公開し、このセキュリティ上の脆弱性と更新プログラムの詳細と説明しています。

**推奨するセキュリティ設定の詳細情報はどこで入手できますか?**

マイクロソフトが提供するセキュリティ情報の詳細は、弊社の[セキュリティ](http://technet.microsoft.com/ja-jp/security/default.aspx)の Web サイトから入手してください。

**テクニカルサポートを受けるにはどこに問い合わせればよいですか?**

マイクロソフトの製品に関するテクニカルサポートは、[電話番号とサポートオプションのサイト](http://support.microsoft.com/gp/cntactms)を参照してください。

更新プログラム
--------------

<span></span>
この問題を解決するための修正モジュールは、以下のサイトからダウンロードできます。

-   Windows 2000:
    この問題の修正は Windows 2000 サービスパック 2 に含まれています。最新のサービスパックは次のリンクより入手してください。
    [http://www.microsoft.com/japan/windows2000/downloads/
    default.asp](http://www.microsoft.com/japan/windows2000/downloads/)
    個別のモジュールは次のリンクから入手することができます。
    -   PC/AT 互換機用
        [http://www.microsoft.com/downloads/details.aspx?FamilyId=7998A1B2-B8F4-4331-9A1A-ABE49286466B&displaylang=ja](http://www.microsoft.com/downloads/details.aspx?familyid=7998a1b2-b8f4-4331-9a1a-abe49286466b&displaylang=ja)
    -   NEC PC-9800 シリーズ用
        [http://download.microsoft.com/download/win2000platform/patchNEC/q269239/NT5/JA/Q269239\_W2K\_SP2\_NEC98\_JA.EXE](http://download.microsoft.com/download/win2000platform/patchnec/q269239/nt5/ja/q269239_w2k_sp2_nec98_ja.exe)
-   Windows NT 4.0 Workstation、Windows NT 4.0 Server、
    Windows NT 4.0 Server、Enterprise Edition:
    この問題に対する更新プログラムは Windows NT 4.0 のセキュリティ ロールアップ パッケージ (SRP) に含まれています。
    個別の更新プログラムよりもセキュリティ ロールアップ パッケージを適用することをお勧めします。
    NT 4.0 のセキュリティ ロールアップ パッケージは次のリンクから入手してください。

    [299444](http://support.microsoft.com/kb/299444) Post Windows NT 4.0 SP6a セキュリティ ロールアップ パッケージ (SRP)

    -   PC/AT 互換機用
        [http://www.microsoft.com/downloads/details.aspx?FamilyId=2B07CCD4-B629-4D78-8B18-0D7A8D83FB36&displaylang=ja](http://www.microsoft.com/downloads/details.aspx?familyid=2b07ccd4-b629-4d78-8b18-0d7a8d83fb36&displaylang=ja)
    -   NEC PC-9800 シリーズ用
        [http://download.microsoft.com/download/winntsp/patchNEC/Q269239/NT4/JA/JPNQ269239n.exe](http://download.microsoft.com/download/winntsp/patchnec/q269239/nt4/ja/jpnq269239n.exe)

        **注** **:**
        本更新プログラムは Windows NT 4.0 Service Packs 5 と 6a を動作しているシステムに適用できます。

-   Windows NT 4.0 Server, Terminal Server Edition:
    [http://www.microsoft.com/downloads/details.aspx?FamilyId=DA8AE101-9B05-4D3A-9A37-6ADF4863613E&displaylang=ja](http://www.microsoft.com/downloads/details.aspx?familyid=da8ae101-9b05-4d3a-9a37-6adf4863613e&displaylang=ja)
    ダウンロード先のリストから Japanese Language Version を選択してください。

更新プログラムについてのご質問は、マイクロソフト プロダクト サポート までご連絡ください。マイクロソフトでは、ご質問の内容が弊社製品の不具合が原因の場合、サポート料金はいただきません。それ以外の場合には、サポート料金を請求させていただきますのでご注意ください。
[マイクロソフト プロダクト サポートへの連絡方法はこちらをご覧ください。](http://www.microsoft.com/japan/security/support/patchqa.mspx)

### その他の情報

**詳細情報** **:**

-   US マイクロソフトセキュリティ情報（MS00-047）
    [http://www.microsoft.com/technet/security/bulletin/ms00-047.mspx](http://technet.microsoft.com/security/bulletin/ms00-047)
-   サポート技術情報 （KB） 文書番号 ： 269239
    [NetBIOS の脆弱性により、ネットワークの競合で名前が重複する](http://support.microsoft.com/kb/269239)

本セキュリティ情報に含まれている情報は、いかなる保証もない現状ベースで提供されるものです。Microsoft Corporation 及びその関連会社は、市場性および特定の目的への適合性を含めて、明示的にも黙示的にも、一切の保証をいたしません。さらに、Microsoft Corporation 及びその関連会社は、本文書に含まれている情報の使用及び使用結果につき、正確性、真実性等、いかなる表明・保証も行ないません。Microsoft Corporation、その関連会社及びこれらの権限ある代理人による口頭または書面による一切の情報提供またはアドバイスは、保証を意味するものではなく、かつ上記免責条項の範囲を狭めるものではありません。Microsoft Corporation、その関連会社 及びこれらの者の供給者は、直接的、間接的、偶発的、結果的損害、逸失利益、懲罰的損害、または特別損害を含む全ての損害に対して、状況のいかんを問わず一切責任を負いません。（Microsoft Corporation、その関連会社 またはこれらの者の供給者がかかる損害の発生可能性を了知している場合を含みます。) 結果的損害または偶発的損害に対する責任の免除または制限を認めていない地域においては、上記制限が適用されない場合があります。  

*Built at 2014-04-18T01:50:00Z-07:00*
