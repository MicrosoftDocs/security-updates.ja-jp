---
TOCTitle: 'MS00-092'
Title: 'マイクロソフト セキュリティ情報 MS00-092 - 緊急'
ms:assetid: 'ms00-092'
ms:contentKeyID: 61228258
ms:mtpsurl: 'https://technet.microsoft.com/ja-JP/library/ms00-092(v=Security.10)'
---

Security Bulletin

マイクロソフト セキュリティ情報 MS00-092 - 緊急
===============================================

「拡張ストアド プロシージャ パラメータ解析」 の脆弱性に対する対策
-----------------------------------------------------------------

公開日: 2000年12月4日 | 最終更新日: 2001年1月29日

#### 概要 :

マイクロソフトは Microsoft® SQL Server と Microsoft SQL Server Desktop Engine (MSDE) の脆弱性を排除する更新プログラムをリリースしました。悪意のあるユーザーがこの脆弱性を利用することで、サーバーでコードを実行することができます。ただし、このためには多数の制限があります。

**影響を受けるソフトウェアのバージョン** **:**

-   Microsoft SQL Server 7.0
-   Microsoft SQL Server 2000
-   Microsoft Data Engine 1.0 (MSDE 1.0)
-   Microsoft SQL Server Desktop Engine 2000 (MSDE 2000)

**注** **:**
MSDE 1.0 は SQL Server 7.0 とともにリリースされました。MSDE 2000 は SQL Server 2000 とともにリリースされました。

### 詳細

問題
----

<span></span>
拡張ストアド プロシージャ (XP) は拡張機能を提供するために SQL Server 管理者によりインストールされる DLL です。SQL Server では XP の入力パラメータを解析するのに srv\_paraminfo() API が提供されています 。この API には問題があり、バッファ オーバーランが発生することがあります。この API は文字列中に n 番目のパラメータを見つけ、それを XP が供給したバッファに入れるように設計されていてます。設計上、API は XP がバッファの長さを示す方法を提供しません。その代わり、XP に対して、パラメータを保持するのに十分なサイズのバッファが用意されることになっています。しかし、SQL Server にデフォルトで供給されている全ての XP は、この確認を行うわけではありません。悪意のあるユーザーは該当する XP に十分な長さのパラメータを渡すことにより、srv\_paraminfo 内でバッファ オーバーランを発生させます。この結果、SQL Server の異常終了や悪意のあるユーザーによるコードを実行できるようになります。
悪意のあるユーザーがこの脆弱性を利用する際、次の 2 つのシナリオが考えられます。

-   まず、SQL Server にログオンし、XP を呼び出して直接攻撃を試みます。し かし、これはSQL Server への認証が成功した場合のみ可能です。
-   または、Web アプリケーションより綿密な入力を行うことにより、Web サーバーのバックエンドとしての役割を果たすデータベース サーバーを攻撃しようとします。しかし、XP は、ほとんど Web アプリケーションでは使用されていません。Web アプリケーションが XP を使用していたとしても、チェックされていない バッファを利用するような方法で、XP や srv\_paraminfo() に渡されるパラメータを、Web アプリケーションより入力するには、悪意のあるユーザーがその Web アプリケーションの設計について詳しい知識を持っている必要があります。

これらの制限のため、既に Web サーバーを侵害し、バックエンド サーバーの有効な SQL Server ユーザーになっている悪意のあるユーザーしかこの脆弱性を利用できません。悪意のあるユーザーがサーバーでコードを実行すると、それは SQL Server サービス アカウントのセキュリティ コンテキストで動作していることになります。回避策が講じられると、このアカウントはマシンで通常のユーザー権限しか持ちません。この場合、悪意のあるユーザーのコードでデータベースに対して任意の操作 が可能となりますが、マシンの管理者権限を取得することはできません。
この更新プログラムでは、デフォルトで供給されているすべての XP が srv\_paraminfo() を呼び出す前に正しいサイズのバッファを割り当てるように変更されることで脆弱性を排除しています。このアプローチは、後者の操作で後方互換性の問題をもたらすため、srv\_paraminfo() を変更する上で選択されたものとなります。マイクロソフトは srv\_paraminfo() を呼び出すサードパーティの XP が正しく動作するかを確認することを推奨します。

よく寄せられる質問
------------------

<span></span>
**マイクロソフトセキュリティ情報** **MS00-092** **はどのような内容の通知ですか?**

このマイクロソフト セキュリティ情報 MS00-092 は、Microsoft® SQL Server 製品のセキュリティ上の脆弱性を排除する更新プログラムがリリースされたことを、お客様にお知らせするものです。マイクロソフトでは、お客様の情報の保護に全力を挙げて努めております。この通知で、お客様に脆弱性の詳細とその対策をお知らせします。

**この脆弱性はどれくらいの範囲に影響を与えますか?**

これは[バッファ オーバーラン](http://www.microsoft.com/japan/security/glossary.mspx) の脆弱性です。悪意のあるユーザーはこの脆弱性を次の 2 通りに利用できます。最も単純な例は、この脆弱性を利用して SQL Server サービスを異常終了させることができます。複雑な例としては、潜在的にこの脆弱性を利用して、データベース サーバーで悪意のあるユーザーによるコードが実行できるようになります。
この脆弱性の可能性を制限する問題がいくつかあります。

-   該当する機能は通常のユーザーが利用できる　Web アプリケーションや他のインターフェイスでは利用できません。このため、悪意のあるユーザーはこの脆弱性を利用するために、既にマシンへのアクセスを得ている必要があります。
-   悪意のあるユーザーが自身の選択によるコードを実行できたとしても、回避策が講じられていれば、サーバーでの管理者コントロールを取得することはできません。

**この脆弱性の原因は何ですか?**

SQL Server と MSDE で拡張ストアド プロシージャにより使用されている API である Srv\_paraminfo() はバッファ オーバーランの脆弱性による影響を受けます。特殊な形式の間違った引数で呼び出された場合、バッファ オーバーランの脆弱性により、コードがサーバーを動作したり、サービス自体が異常終了したりします。

**MSDE** **とは何ですか?**

MSDE (Microsoft SQL Server Desktop Engine and Microsoft Data Engine) は特定のバージョンのMicrosoft Office 2000 と Microsoft Visual Studio 6.0 に含まれている SQL Server 7.0 に基づいたデータベース エンジンで、サードパーティ ソフトウェア製造業者 により再配布されています。MSDE 1.0 はSQL Server 7.0 と同時にリリースされました。MSDE 2000 は MSDE 1.0 の後継プロダクトで、SQL Server 2000 と同時にリリースされました。

**拡張ストアドプロシージャとは何ですか?**

まず、ストアド プロシージャから説明します。次にアドレス拡張ストアド プロシージャについて説明します。ストアド プロシージャは SQL ステートメントのコレクションで、単一の機能のように呼ばれています。SQL ストアド プロシージャとバッチ ファイルにはおおよその推論があります。これらはコマンドで構成されたテキスト ファイルで、プロシージャまたはバッチ ファイル名を呼び出すことで動作します。
[拡張ストアド プロシージャ](http://msdn2.microsoft.com/en-us/library/aa224743(sql.80).aspx)（XP） はストアド プロシージャの概念を 1 歩先に進めました。ストアド プロシージャがテキスト ファイルで構成されていると、PX は C 言語のような高水準言語で書かれ、DLL. にコンパイルされます。ストアド プロシージャが主に SQL コマンドで構成されていると、XP はそれらのコードを介して完全に新しい機能を提供します。

**Srv\_paraminfo()** **とは何ですか?**

[Srv\_paraminfo()](http://msdn2.microsoft.com/en-us/library/aa216006(sql.80).aspx) は XP が入力パラメータを解析することを助けるように設計されたヘルプ機能です。特に、ユーザーが XP を呼び出す時、XP にいくつかのパラメータを供給します。srv\_paraminfo() は XP writer に n 番目のパラメータを検索するための便利な方法を提供することを目的としています。

**問題は** **srv\_paraminfo()** **にありますか?　それとも** **srv\_paraminfo()** **を呼び出す** **XP** **にありますか?**

srv\_paraminfo() には設計上の問題がありますが、後方互換性の問題のため、更新プログラムは srv\_paraminfo() を呼び出す XP で必要となります。この決定の根本的理由は下記および KB article で説明します。どのような場合でも、この問題の影響は、XP が十分なチェックを行わずに、十分な長さのパラメータに供給された場合、srv\_paraminfo() でバッファ オーバーランが発生します。

**悪意のあるユーザーはこの脆弱性を利用して何ができますか?**

悪意のあるユーザーはこの脆弱性を利用して次の 2 つのことができます。

-   無作為のデータで、バッファをオーバーランさせて SQL Server サービスを異常終了させることができます。運用者は通常の操作を再開させるために、サービスを再起動させる必要があります。マシンを再起動する必要はありません。
-   綿密に作成したデータで、バッファをオーバーランさせて 悪意のあるユーザーによるコードをSQL Server サービスに動作させることができます。

**悪意のあるユーザーがこの脆弱性を利用してコードを動作すると、どのようなことが起きますか?**

SQL Server がどのように構成されているかによります。特に、SQL Server サービスがどのアカウントで動作するように構成されているかによります。SQL Server をインストールすると、管理者はどのアカウントで SQL Server が動作するかを決めなければなりません。そして、そのアカウントにパスワードを供給します。悪意のあるユーザーがこの脆弱性を利用してコードを動作すると、このコードはアカウントが持つ権限を実行できます。
少なくとも、これで悪意のあるユーザーはデータベースに完全なコントロールを持ち、データの追加、変更、削除そしてデータベースでプロシージャを操作することができます。しかし、対応策が講じられると、悪意のあるユーザーはマシンでの管理者コントロールを取得できません。SQL Server サービスを管理者ではなく通常のユーザーとして動作するように構成することを推奨します。このようにすれば、悪意のあるユーザーはマシンで通常のユーザー権限しか取得できません。

**どのように悪意のあるユーザーは該当の機能を呼び出すのですか?**

Srv\_paraminfo() は直接 SQL Server ユーザーに呼び出されることはありません。その代わり、ユーザーは srv\_paraminfo() を呼び出す前に適切なチェックを行わない XP を見つける必要があります。そして srv\_paraminfo() に入力する時に XP を動作し、それにパラメータを供給します。これがバッファ オーバーフローを発生させます。これらを行うためには、明らかに XP 内部の知識が必要となります。

**この脆弱性は全ての** **XP** **に影響を及ぼすわけではないのですか?**

その通りです。全ての XP に影響を及ぼすわけではありません。srv\_paraminfo() を使用するほとんどの XP はバッファ オーバーランを発生させないように srv\_paraminfo() を使用しています。一部の XP だけにバッファ オーバーランを発生させる問題があります。

**悪意のあるユーザーがこの脆弱性の影響を受けている** **XP** **を見つけた場合、それを動作できますか?**

悪意のあるユーザーのマシンへのアクセスのレベルによります。SQL Server ユーザーはほとんどの XP を呼び出せますが、全てではありません。どの XP が影響を受けたか、悪意のあるユーザーのサーバーでの権限によります。

**この脆弱性を利用して、悪意のあるユーザーは** **Web** **サイトを攻撃できますか?**

可能性はありますが、難しいでしょう。悪意のあるユーザーがSQL Server バックエンドがある Web サイトを訪問した場合、srv\_paraminfo() にバッファをオーバーフローさせるパラメータとともに XP を実行する Web アプリケーションに情報を供給することができます。しかし、XP は通常 Web アプリケーションによる呼び出しを受けません。XP はメンテナンスと複製などのオペレーション機能をサポートします。Web アプリケーションが XP を呼び出したとしても、悪意のあるユーザーは、Web アプリケーションに供給した情報が 3 層のコードにどのように浸透していくかが正確に分かるほどのサイト内部の知識を持っている必要があります。
しかし、悪意のあるユーザーが既に Web サーバーを侵害し、SQL Server へのユーザー レベルのアクセス権を取得している場合には、直接 XP を呼び出し、この脆弱性を利用することができます。

**悪意のあるユーザーはこの脆弱性を利用する目的だけのために自分自身の** **XP** **を追加することができますか?**

いいえ、できません。SQL Server システム管理者だけが XP をインストールできます。

**上記で** **srv\_paraminfo()** **に問題があるとのことですが、srv\_paraminfo()** **を呼び出す** **XP** **に更新プログラムが必要なのはなぜですか?**

Knowledge Base article で、詳しい技術的な説明をしていますが、ここでは nutshell　に問題があります。srv\_paraminfo() を呼び出す時、XP は srv\_paraminfo()　に解析させたいパラメータ文字列、選択されたパラメータに入力されなければいけないメモリのブロック （バッファと呼ばれます） そして、その他の補助情報を srv\_paraminfo() に渡します。しかし、srv\_paraminfo() がバッファの長さを認識する方法はありません。これは （ポインタによる） バッファの渡され方と、呼び出しているプログラム （srv\_paraminfo() ではなく） が作成されるためです。結果として、srv\_paraminfo() は呼び出しているプログラムが十分な大きさのバッファを割り当てたと信頼し、n　番目のパラメータをチェックしないでそのバッファに入れます。これが潜在的にバッファ を オーバーランさせるのです。
完全な状況であれば、呼び出している XP にバッファの長さを指定することを要求するために、srv\_paraminfo() の変更を選択したと思います。そして srv\_paraminfo() はバッファに入れすぎないようにします。しかし、API が呼び出される方法を変更すると、新しい呼び出し形式を使用するために、既存の全ての XP は記録されなければなりません。その代わり、srv\_paraminfo() に対して小さすぎるバッファを供給する少数の XP を修正することにしました。srv\_paraminfo() を使用するサード パーテイの XP 開発者は同様に自分たちのコードをチェックする必要があります。

**XP** **はどのように供給するバッファが小さすぎることを認識するのですか?**

srv\_paraminfo() は実際に何のデータもコピーしないモードで呼び出されますが、その代わり、呼び出しているXP に n 番目のパラメータの大きさを伝えます。XP は通常このモードで 1 度 srv\_paraminfo() を呼び出し、パラメータの長さを決める必要があります。次に、少なくともそのサイズのバッファを割り当て、2 度目に srv\_paraminfo() を呼び出す時、実際にデータを検索します。Knowledge Base article でこの方法に関する取り扱い説明を掲載しています。

**どのように** **MSDE** **がマシンにインストールされているかどうかが分かるのですか?**

マシンに MSDE がインストールされているかどうか確認するためには、\[コントロール パネル\] で \[アプリケーションの追加と削除\] をクリックして下さい。MSDE がインストールされている場合、インストールされたアプリケーションとして SQL Server が表示されています。

**だれが更新プログラムを適用する必要がありますか?**

マイクロソフトはSQL Server または MSDE の該当するバージョンを使用しているお客様にこの更新プログラムのインストールを考慮することを推奨します。

**更新プログラムは何を変更するのですか?**

この更新プログラムは SQL Server または MSDE とともに出荷されていて、srv\_paraminfo() API を使用する全ての XP が、srv\_paraminfo() を呼び出す前に、該当するバッファの長さが十分であることを確認させることによりこの脆弱性を排除します。

**どこから更新プログラムを入手できますか?**

マイクロソフト セキュリティ情報 MS00-092 をご覧ください。

**更新プログラムはどのように使用するのですか?**

マイクロソフト サポート技術情報 [280380](http://support.microsoft.com/kb/280380) には、お客様のサイトに更新プログラムを提供するための詳細な情報が記載されています。

**この問題に対してマイクロソフトはどのような対応をしていますか?**

-   マイクロソフトは、この脆弱性を排除する更新プログラムを開発しました。
-   マイクロソフトは、セキュリティ上の脆弱性の詳細とその対策をお客様にご理解いただくために、セキュリティ情報 MS00-092 と、この faq を提供しています。
-   マイクロソフトは、マイクロソフト社の最新のセキュリティ情報を無料でご購読いただける[マイクロソフト プロダクト セキュリティ 警告サービス](http://technet.microsoft.com/ja-jp/security/dd252948.aspx) にて、購読の登録をされているお客様に、セキュリティ情報の通知を行っています。
-   マイクロソフトはサポート技術情報 [280380](http://support.microsoft.com/kb/280380) を公開し、このセキュリティ上の脆弱性と更新プログラムの詳細と説明しています。

**推奨するセキュリティ設定の詳細情報はどこで入手できますか?**

マイクロソフトが提供するセキュリティ情報の詳細は、弊社の[セキュリティ](http://technet.microsoft.com/ja-jp/security/default.aspx)の Web サイトから入手してください。

**テクニカルサポートを受けるにはどこに問い合わせればよいですか?**

マイクロソフトの製品に関するテクニカルサポートは、[電話番号とサポートオプションのサイト](http://support.microsoft.com/gp/cntactms)を参照してください。

更新プログラム
--------------

<span></span>
この問題を解決するための日本語版更新プログラムは、以下のサイトへいき、下記の名前をクリックするとダウンロードできます。

-   <http://www.microsoft.com/japan/sql/prodinfo/previousversions/uptodate.mspx>

    SQL Server 7.0

    -   Alpha 用
        S70918a\_jpn.exe (Alpha)
    -   PC/AT 互換機用
        S70918i\_jpn.exe (Intel)
        SQL Server 2000
    -   PC/AT 互換機用
        S80223i\_jpn.exe (Intel)

**注** **:**
SQL Server 2000 の更新プログラムは SQL Server 2000 のシステムにインストールすることができます。この更新プログラムは SQL Server 2000 Service Pack 1 に含まれました。

更新プログラムについてのご質問は、マイクロソフト プロダクト サポート までご連絡ください。マイクロソフトでは、ご質問の内容が弊社製品の不具合が原因の場合、サポート料金はいただきません。それ以外の場合には、サポート料金を請求させていただきますのでご注意ください。
[マイクロソフト プロダクト サポートへの連絡方法はこちらをご覧ください。](http://www.microsoft.com/japan/security/support/patchqa.mspx)

### その他の情報

**詳細情報** **:**

-   US マイクロソフトセキュリティ情報（MS00-092）
    [http://www.microsoft.com/technet/security/bulletin/ms00-092.mspx](http://technet.microsoft.com/security/bulletin/ms00-092)
-   サポート技術情報 （KB） 文書番号 ： 280380
    [\[FIX\] 拡張ストアド プロシージャを使用したバッファ オーバーフローの発生](http://support.microsoft.com/kb/280380)

本セキュリティ情報に含まれている情報は、いかなる保証もない現状ベースで提供されるものです。Microsoft Corporation 及びその関連会社は、市場性および特定の目的への適合性を含めて、明示的にも黙示的にも、一切の保証をいたしません。さらに、Microsoft Corporation 及びその関連会社は、本文書に含まれている情報の使用及び使用結果につき、正確性、真実性等、いかなる表明・保証も行ないません。Microsoft Corporation、その関連会社及びこれらの権限ある代理人による口頭または書面による一切の情報提供またはアドバイスは、保証を意味するものではなく、かつ上記免責条項の範囲を狭めるものではありません。Microsoft Corporation、その関連会社 及びこれらの者の供給者は、直接的、間接的、偶発的、結果的損害、逸失利益、懲罰的損害、または特別損害を含む全ての損害に対して、状況のいかんを問わず一切責任を負いません。（Microsoft Corporation、その関連会社 またはこれらの者の供給者がかかる損害の発生可能性を了知している場合を含みます。) 結果的損害または偶発的損害に対する責任の免除または制限を認めていない地域においては、上記制限が適用されない場合があります。

*Built at 2014-04-18T01:50:00Z-07:00*
