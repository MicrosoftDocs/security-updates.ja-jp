---
TOCTitle: 'MS01-032'
Title: 'マイクロソフト セキュリティ情報 MS01-032 - 緊急'
ms:assetid: 'ms01-032'
ms:contentKeyID: 61228389
ms:mtpsurl: 'https://technet.microsoft.com/ja-JP/library/ms01-032(v=Security.10)'
---


マイクロソフト セキュリティ情報 MS01-032 - 緊急
===============================================

SQL クエリ方法により、キャッシュされた管理者接続が再使用される
--------------------------------------------------------------

公開日: 2001年6月13日 | 最終更新日: 2003年6月24日

#### 概要 :

**このセキュリティ情報の対象となるユーザー:**  
Microsoft® SQL Server™ を使用しているシステム管理者

**脆弱性の影響 :**  
特権の昇格

**推奨する対応策:**  
混合モードで SQL Server を実行している管理者はこの更新プログラムを適用して下さい。

**影響を受けるソフトウェア:**

-   Microsoft SQL Server 7.0
-   Microsoft SQL Server 2000

### 詳細

問題
----


**技術的な説明:**
SQL Server へのクライアント接続が終了する際、パフォーマンス上の理由により、その接続はしばらくの間キャッシュされた状態で残ります。ある SQL クエリ方法には問題があり、これにより、あるユーザーのクエリが sa （システム管理者） アカウントに属するキャッシュされた接続を再使用できるようになります。

この脆弱性を利用して、攻撃者は管理者のセキュリティ コンテキストを使用するクエリを実行することができます。これにより、攻撃者はデータベースで任意の操作を行うことができます。さらに、拡張ストアド プロシージャを実行し、攻撃者が選択したコードを実行したり、サーバー自体を事実上管理することができる場合があります。

**問題を緩和する要素:**

-   この脆弱性は混合モードを使用するように設定されているサーバーだけに影響を及ぼします。マイクロソフトは混合モードを使用せずに、Windows 認証モードを使用することを強く推奨します。Windows 認証モードを使用するようにサーバーを設定しているお客様は、この脆弱性による影響を受けません。
-   終了された接続は短い間しかキャッシュされません。管理者の接続がキャッシュされている間に攻撃を行うためには、攻撃者は時間を合わせる必要があります。
-   ここで問題となっているクエリ方法は認証されたユーザーのみが実行できます。このため、この脆弱性を利用できるユーザー数は限られ、操作を監査することもできます。

**脆弱性識別番号:**
[CAN-2001-0344](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=can-2001-0344)

**テストしたバージョン:**
マイクロソフトは SQL Server 7.0 および SQL Server 2000 のテストを行い、この脆弱性による影響を評価しました。それより前のバージョンに関してはサポートしておらず、この脆弱性による影響は不明です。

よく寄せられる質問
------------------


**この脆弱性はどれくらいの範囲に影響を与えますか?**

これは[特権の昇格](http://www.microsoft.com/japan/security/glossary.mspx)の脆弱性です。攻撃者がこの脆弱性を利用できた場合、該当のデータベース サーバーを完全に制御することができます。これにより、攻撃者はサーバー上ですべての任意の操作をすることができます。

この脆弱性を利用するのは極めて困難です。

-   この脆弱性は、マイクロソフトが使用しないように推奨しているモードに設定されている SQL Server にのみ影響を及ぼします。
-   この脆弱性は、データベースへのアクセス権限を所有しているユーザーのみが利用することができます。
-   攻撃者は、管理者がデータベースの操作を行った直後に攻撃を加えるように時間を調整する必要があります。

**この脆弱性の原因は何ですか?**

この脆弱性は、ある特定の SQL クエリ方法のエラーが原因で発生します。SQL Server が混合モードに設定されている場合、攻撃者はこのクエリ方法を利用して、管理者に属するキャッシュされた接続にアクセスすることができる可能性があります。攻撃者がアクセスに成功した場合、データベース サーバーを制御することができます。

**クエリ方法とはどういう意味ですか?**

クエリ方法とは、データベースに問い合わせを行う際に SQL Server で提供されているコマンドのことです。ここで問題になっている脆弱性は SQL Server の数百あるクエリ方法のうちのある方法によって問題になりますが、それはサーバーが混合モードに設定されている場合のみです。

**混合モードとは何ですか?**

SQL Server はユーザーの認証を行うために ２ つの[モード](http://msdn.microsoft.com/en-us/library/aa140277.aspx)をサポートしています。それらのモードとは、混合モードと Windows 認証モードです。混合モードでは、可能な場合 Windows 資格情報を使用してクライアントの認証を行います。またはクライアントが SQL Server データベースにローカルに保存されているユーザー名とパスワード情報を使用し、SQL Server 認証で認証します。混合モードは、SQL Server が Windows® 95 または 98 マシンにホストされる場合に、最も一般的に使用されます。

一方、Windows 認証モードでは、Windows NT® (または Windows 2000) の資格情報を使用して認証を行うことが必要です。Windows 認証モードの方がはるかに安全であるため、マイクロソフトは、可能な限り Windows 認証モードを使用することを強く推奨します。Windows 認証モードをご使用のお客様は、この脆弱性による影響はありません。

**この脆弱性を利用して、攻撃者はキャッシュされた接続を再使用できるとのことですが、キャッシュされた接続とは何ですか?**

ユーザーが SQL Server のデータベースにリクエストを行う前に、ユーザーとサーバーの間で接続が確立されなければなりません。SQL セッションが完了すると、この接続は切断されます。しかし、パフォーマンス上の理由により、SQL Server はしばらくの間、接続をキャッシュ内に維持します。同じユーザーが新しい接続を行う場合、新しい接続が作成されるのではなく、そのキャッシュされた接続を再使用することができます。この脆弱性により、攻撃者は他のユーザーのキャッシュされた接続、特に、管理者により行われた接続のキャッシュを再使用することができます。

**では、サーバーが混合モードで動作している場合に限り、この脆弱性を利用して、攻撃者は管理者のキャッシュされた資格情報を復元することができるのですか?**

はい、そうです。攻撃者がエラーを含む特定のクエリ方法を使用し、サーバーが混合モードで動作していて、攻撃時に管理者に属する接続がキャッシュ内にある場合、攻撃者は管理者のキャッシュされた接続を使用して、実行するクエリを指定することができます。

**これにより、攻撃者は何ができますか?**

管理者の接続を使用するクエリ方法を実行できるということは、クエリに管理者権限を与えることになります。これにより、攻撃者はデータベースで任意の操作を行うことができ、データベースのデータの追加、作成、変更ができます。さらに、クエリは拡張ストアド プロシージャと呼ばれるプログラムの実行を使用できるため、この脆弱性を利用することにより、攻撃者自身が選択したコードをマシンで実行することもできます。これにより、攻撃者は事実上、サーバーの管理を行うことができます。

**この脆弱性を利用することはどの程度困難ですか?**

この脆弱性を利用することは非常に困難です。上記で説明したように、サーバーが特定の方法で構成されており、攻撃者は攻撃が可能となる時間を正確に合わせなければなりません。いずれの要素も攻撃者は制御できないため、攻撃の条件がそろっている場合のみ、この脆弱性を利用することができます。

**誰がこの脆弱性を利用できますか?**

ここで問題となっている特定のクエリ方法は認証されたユーザーだけが使用できます。したがって、この脆弱性を利用するためには、攻撃者はデータベースに対しクエリを行うための認証が必要となります。これは次の理由により、大変重要な点です。その理由とは標的となるマシンを攻撃することができるユーザー数が限定されることと、攻撃者の操作を監査することができるということです。

**更新プログラムは何を修正しますか?**

この更新プログラムは、該当するクエリ方法に対して適切な操作を行うことにより、この脆弱性を排除します。そして、他のユーザーのキャッシュされた接続が再使用されることを防ぎます。

**更新プログラムを適用したくない場合はどうすればいいのですか?何か回避策はありますか?**

はい、あります。しかし、この回避策は次の場合のみ使用して下さい。SQL Server 7.0 SP3 にアップグレードすることができず、そして提供されている更新プログラムが適用できない場合、また現在、レプリケーションを使用していないか、またはアドホック名クエリを使用する意図がない場合です。

SQL Server Enterprise Manager を使用します。

1.  SQL Server インスタンスの下にあるセキュリティのタブをクリックして下さい。
2.  リンクされているサーバーを右クリックして、全般プロパティタブを表示して下さい。
3.  \[その他のデータ ソース\] の隣にあるオプション ボタンを選択し、プロバイダ名のドロップ ダウン リストから \[Microsoft OLE DB Provider for SQL Server\] を見つけてください。
4.  \[プロバイダ オプション\] ボタンをクリックして下さい。
5.  \[Ad Hoc アクセス禁止\] のチェック ボックスにチェックを追加して下さい。

更新プログラム
--------------


この問題に対する更新プログラムは、以下のサイトからダウンロードできます。

日本語環境でもご利用いただくことができます。

-   Microsoft SQL Server 2000 および SQL Server 7.0:
    <http://support.microsoft.com/kb/299717>

#### 更新プログラムに関する追加情報

**対象プラットフォーム:**
この更新プログラムは SP3 を適用した SQL Server 7.0 および SQL Server 2000 を動作しているシステムにインストールすることができます。

**今後リリースされるサービス パックに含まれる更新プログラム:**
SQL Server 2000 用の更新プログラムは Service Pack 1 に含まれています。

**移行される更新プログラム:**
なし

**更新プログラムのインストール確認方法:**

-   OSQL、SQL Server クエリ アナライザまたは ISQL. から "SELECT @@version" （引用符はありません。） を実行することにより、この更新プログラムがインストールされることを確認して下さい。SQL Server 7.0 に関しては、そのバージョンは 7.00.996 またはそれ以降となります。また、SQL Server 2000 では、そのバージョンは 8.00.296 またはそれ以降です。

**警告:**
なし

**ローカライズ:**
なし。どちらの更新プログラムも全ての言語の Microsoft SQL Server にインストールすることができます。

**他のセキュリティ更新プログラムの入手先:**
他のセキュリティ問題を解決する更新プログラムは以下のサイトから入手できます。

-   セキュリティ更新プログラムはマイクロソフト [ダウンロード センター](http://www.microsoft.com/downloads/results.aspx?displaylang=ja&freetext=security_patch)からダウンロードすることができます。「security\_patch」のキーワード検索によって容易に見つけることができます。
-   コンシューマ プラットフォーム用の更新プログラムは、[Microsoft Update](http://update.microsoft.com/microsoftupdate/)Web サイトからダウンロードできます。

更新プログラムについてのご質問は、マイクロソフト プロダクト サポート までご連絡ください。マイクロソフトでは、ご質問の内容が弊社製品の不具合が原因の場合、サポート料金はいただきません。それ以外の場合には、サポート料金を請求させていただきますのでご注意ください。

[マイクロソフト プロダクト サポートへの連絡方法はこちらをご覧ください。](http://www.microsoft.com/japan/security/support/patchqa.mspx)

### その他の情報

**詳細情報:**

-   US マイクロソフトセキュリティ情報（MS01-032）
    [http://www.microsoft.com/technet/security/bulletin/ms01-032.mspx](http://technet.microsoft.com/security/bulletin/ms01-032)
-   サポート技術情報 （KB） 文書番号 ： 299717
    [\[FIX\] データ アクセスのクエリ方法が権限を与える](http://support.microsoft.com/kb/299717)

**更新履歴:**

-   2001/6/13: このセキュリティ情報ページを公開しました。
-   2001/6/25: この問題に対する日本語版 KB を公開しました。
-   2003/6/24: 「よく寄せられる質問」 の SQL のセキュリティへのリンクを更新しました。

本セキュリティ情報に含まれている情報は、いかなる保証もない現状ベースで提供されるものです。Microsoft Corporation 及びその関連会社は、市場性および特定の目的への適合性を含めて、明示的にも黙示的にも、一切の保証をいたしません。さらに、Microsoft Corporation 及びその関連会社は、本文書に含まれている情報の使用及び使用結果につき、正確性、真実性等、いかなる表明・保証も行ないません。Microsoft Corporation、その関連会社及びこれらの権限ある代理人による口頭または書面による一切の情報提供またはアドバイスは、保証を意味するものではなく、かつ上記免責条項の範囲を狭めるものではありません。Microsoft Corporation、その関連会社 及びこれらの者の供給者は、直接的、間接的、偶発的、結果的損害、逸失利益、懲罰的損害、または特別損害を含む全ての損害に対して、状況のいかんを問わず一切責任を負いません。（Microsoft Corporation、その関連会社 またはこれらの者の供給者がかかる損害の発生可能性を了知している場合を含みます。) 結果的損害または偶発的損害に対する責任の免除または制限を認めていない地域においては、上記制限が適用されない場合があります。

*Built at 2014-04-18T01:50:00Z-07:00*
