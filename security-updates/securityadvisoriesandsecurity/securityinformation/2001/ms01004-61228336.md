---
TOCTitle: 'MS01-004'
Title: 'マイクロソフト セキュリティ情報 MS01-004 - 重要'
ms:assetid: 'ms01-004'
ms:contentKeyID: 61228336
ms:mtpsurl: 'https://technet.microsoft.com/ja-JP/library/ms01-004(v=Security.10)'
---

Security Bulletin

マイクロソフト セキュリティ情報 MS01-004 - 重要
===============================================

不正な .HTR リクエストがファイル フラグメントを読み取ってしまう
---------------------------------------------------------------

公開日: 2001年1月30日 | 最終更新日: 2001年3月6日

#### 概要 :

**このセキュリティ情報の対象となるユーザー** **:**
IIS Web サーバーをホストしていて、.HTR マッピングを無効にしていないシステム管理者

**脆弱性の影響** **:**
情報漏えい

**推奨する対応策** **:**
第一の対策として .HTR マッピングを無効にしてください。ビジネス上どうしても .HTR 機能を継続する必要がある場合のみこの更新プログラムを適用してください。

**影響を受けるソフトウェア** **:**

-   Microsoft Internet Information Server 4.0
-   Microsoft Internet Information Services 5.0

### 詳細

問題
----

<span></span>
**技術的な説明** **:**
この脆弱性は、マイクロソフトセキュリティ情報[MS00-031](http://technet.microsoft.com/security/bulletin/ms00-031) と [MS00-044](http://technet.microsoft.com/security/bulletin/ms00-044) に説明されている前回の脆弱性、「.HTR 経由のファイル フラグメントの読み取り」の脆弱性の新種に伴って発生するものです。今回発生した脆弱性を利用すると、元の脆弱性と同様に、攻撃者は .HTR ISAPI エクステンションに処理させる方法でファイルをリクエストする可能性があります。それにより .ASP ファイルのようなサーバー側ファイルのフラグメントが攻撃者に送信されてしまう恐れがあります。.HTR 機能を既に無効にしてあるお客様はこの脆弱性による影響はありません。マイクロソフトは、まだ .HTR を無効にしていないお客様に、ビジネスでどうしても必要な場合以外はその機能を無効にしておくことを推奨します。.HTR 機能がどうしても必要なお客様は、この脆弱性を排除する更新プログラム、またマイクロソフト セキュリティ情報[MS00-031](http://technet.microsoft.com/security/bulletin/ms00-031) と [MS00-044"](http://technet.microsoft.com/security/bulletin/ms00-044) で説明している更新プログラムをご利用ください。

**問題を緩和する要素** **:**

-   通常の .HTR 処理は、機密情報を含む可能性が高いデータを取り除く効果があります。
-   ファイル フラグメントを送信するためにはサーバー メモリのある部分に 0 が存在している必要があります。
-   .ASP と他のサーバー側ファイルに機密情報を保存しないようにする最善策を講じてある場合は、ファイルに機密情報が含まれることはないでしょう。
-   この脆弱性を利用して、サーバー上のファイルに追加、変更を加えたり、削除したり、アクセス権なしでファイルにアクセスしたりすることはできません。

**脆弱性識別番号** **:**
[CAN-2001-0004](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=can-2001-0004)

よく寄せられる質問
------------------

<span></span>
**マイクロソフトセキュリティ情報** **MS01-004** **はどのような内容の通知ですか?**

このマイクロソフト セキュリティ情報 MS01-004 は、Microsoft® Internet Information Service のセキュリティ上の脆弱性を排除する更新プログラムがリリースされたことをお客様にお知らせするものです。

**どのようなことが起こる可能性がありますか?**

この脆弱性はマイクロソフト セキュリティ情報 [MS00-031](http://technet.microsoft.com/security/bulletin/ms00-031) と [MS00-044](http://technet.microsoft.com/security/bulletin/ms00-044) で説明されている 「.HTR 経由のファイル フラグメント読み取り」 の脆弱性の新種です。この新種の影響の範囲は、元の脆弱性と全く同じで、攻撃者はWeb サーバーのあるファイルのある部分を読み取ることができます。しかし、この元の脆弱性と同様に新種の脆弱性を利用しても攻撃者はファイルを追加、変更、削除することはできません。
マイクロソフトは HTR ファイルにマップしているファイルを削除することを以前から推奨しており、既にそのファイルを削除しているお客様はこの脆弱性による危険性はありません。マイクロソフトは、お客様にまず最初に HTR 機能を全て無効にしておくことを推奨します。 HTR 機能を今後もどうしても使用する必要性があるお客様は、この更新プログラムを適用の上、HTR 機能をお使いになることをお勧めします。

**この脆弱性の原因は何ですか?**

この脆弱性は、.HTR ファイルのISAPI エクステンションに処理させる方法でサーバーからファイルをリクエストすることが可能なために発生します。これによりファイル コンテンツが部分的にリクエストした人に送信される可能性があります。

**ISAPI** **エクステンションとは何ですか?**

ISAPI (Internet Services Application Programming Interface) は Web 開発者が Web サーバーに新しいサービスを追加するカスタム コードを書くことによって Web サーバーの機能を拡張することができる技術です。これらのコードは以下の 2 つのフォームで実行できます。

-   新しい機能が低レベルのサービスを提供する場合、ISAPI フィルタとして実行
-   新しい機能が高レベルのサービスを提供する場合、ISAPI エクステンションとして実行

この脆弱性の場合、該当するコードは ISAPI エクステンションです。具体的に言うと .HTR ファイルを処理する ISAPI エクステンションになります。

**HTR** **とは何ですか?**

HTR は、IIS 2.0 の 一部として出荷されている第 1 世代の高性能スクリプト技術です。HTR は 主に高性能技術、Active Server Pages (.ASP) が IIS 4.0 に導入され、ユーザーがHTR の開発リソースを十分に使いこなす前に Active Server Pages (.ASP) の方が知れ渡ってしまったという理由で広くは採用されませんでした。
HTR 技術が最も広く日常的に使用されているのは、IIS にデフォルトでインストールされる HTR スクリプトの収集においてです。HTR スクリプトは、IIS が Windows NT に IIS Web サーバーを介してパスワード サービスを供給します。Windows NT ユーザーは .HTR スクリプトを使用して自分のパスワードを変更でき、また管理者は、パスワード管理機能の広い配列を行うことができます。これらのスクリプトに関する詳細は サポート技術情報 [184619](http://support.microsoft.com/kb/184619) でご覧いただけます。

**この脆弱性を利用して攻撃者は何をする可能性がありますか?**

攻撃者がある特定の種類の不正な URL を使用してファイルをリクエストした場合、IIS が .HTR ISAPI エクステンションを使用して .HTR 以外のファイルを処理するようにすることが可能です。この結果はファイルの種類によって異なります。しかし、ここで最大の問題になっているファイル、.ASP ファイルでは、ファイルの内容のフラグメントが攻撃者に送信されてしまう恐れがあります。

**セキュリティ上の危険性が発生するのはなぜですか?**

.ASP ファイルは、本来 Web クライアント上ではなく、サーバー上で処理されるためにサーバー サイドファイルと呼ばれるファイルの最も良い例です。Web クライアントが .ASP ファイルをリクエストすると、（ISAPI エクステンションによって）サーバー上で処理されます。ソース コードではなくその結果がリクエスト者に送信されることになっています。この脆弱性を利用することによって、攻撃者は .ASP ソース コードのフラグメントを取得し、そこから機密情報を含むデータを手に入れることができる危険性が発生します。
しかし、この脆弱性以前の問題として、機密情報を含むデータは .ASP ファイルに含まないように注意しておくことが重要です。これに従った場合、攻撃者がこの脆弱性を利用したとしても機密情報を含むデータが漏れることはありません。セキュリティ上の最善策が講じられておらず、.ASP ファイルに機密情報が含まれているデータが存在する場合でも、.HTR 処理によって攻撃者が興味をもつ可能性のある内容が削除されるため、この脆弱性によってそのデータが実際に漏れる可能性は低いと考えられます。

**.HTR** **処理はなぜ機密事項を含む内容を削除するようになっているのですか?**

.HTR 処理ではテキスト形式以外のファイルを全て削除する効果が得られます。通常、機密事項を含む情報はテキスト形式ではなくプログラムコードとしてコード化されています。.HTR 処理は、コードを攻撃者に渡さず、解釈します。例えばこの脆弱性は、以下の内容のファイルを読み取ろうとします。
&lt;b&gt;Some HTML text&lt;/b&gt;
&lt;%
/\*Some ASP/HTR code\*/
var objConn = new ActiveXObject("Foo.bar");
%&gt;
&lt;I&gt;other html code&lt;/I&gt;
other code.
悪意のあるユーザーに返される可能性のある情報は以下の通りです。
&lt;b&gt;Some HTML text&lt;/b&gt;
&lt;I&gt;other html code&lt;/I&gt;
other code.

**この脆弱性を利用する制限は他にありますか?**

この脆弱性を利用するためには、サーバー上の偶発的なメモリ ロケーションに 0 が存在している必要があります。具体的に言うと、IIS は .HTR リクエストの初期の処理を実行し、次にこのリクエストを追加の処理のための一時場所に移動させます。この脆弱性を利用するためには、正しい場所に 0 が存在し、そこにある文字列を null で終了させる必要があります。
悪意のあるユーザーがこの制限を打破しようと試みる可能性がある 2 つの方法があります。1 つ目はまぐれ当たりを期待してリクエストを繰り返し行うことが考えられます。もう 1 つはサーバーが再起動する瞬間まで待つ方法が考えられます。サーバー メモリが 初期化プロセスの過程で 0 にされ、そして 0 が正しい場所にあると保証されます。しかしサーバー メモリが使用されすぐに “汚れて”しまうためこの脆弱性を利用できる時間は非常に短いといえます。

**この脆弱性によって攻撃者はアクセス権に関わらずファイルの読み取りができますか?**

いいえ、できません。この脆弱性はファイルへのアクセス権を使用しない方法で利用することはできません。攻撃者はこの脆弱性を利用して読み取ろうとしているファイルの実行アクセス権を所有している必要があります。

**この脆弱性に対してユーザーは何をする必要がありますか?**

.HTR 機能がビジネス上特に必要でないお客様は .HTR 機能を無効にしておいてください。この機能を無効にしたお客様は、以前にリリースされた HTR 機能に関する更新プログラム、ここで説明されている更新プログラムも適用する必要はありません。また今後も適用する必要はありません。.HTR 機能を使用する必要があるお客様は下で説明されている更新プログラムを適用する必要があります。

**HTR** **機能を無効にするにはどのようにしますか?**

以下の手順で行ってください。

-   internet services manager を開きます。
-   web サーバーを右クリックし、\[プロパティ\] を選択し、次に \[マスタ プロパティ\]、\[www サービス\] の順に選択します。
-   \[編集\]、次に\[ホーム ディレクトリ\]、\[構成\] の順に選択します。
-   .htr の入力を削除します。

マイクロソフトは、.htrに加えていわゆるスクリプト マッピングと呼ばれるものも削除することを推奨します。これらは [iis 4.0 セキュリティ チェックリスト](http://www.microsoft.com/japan/technet/archive/security/chklist/iis4cl.mspx)で説明されています。

**だれが更新プログラムを適用する必要がありますか?**

マイクロソフトは .HTR をビジネスでどうしても必要なお客様のみがこの更新プログラムをインストールすることを推奨します。他の全ての IIS ユーザーは、.HTR 機能を削除することが必要です。

**更新プログラムは何を変更しますか?**

この更新プログラムはここで問題になっているリクエストを 適切な ISAPI エクステンションが処理できるようにしてこの脆弱性を排除します。さらにこの更新プログラムはマイクロソフト セキュリティ情報 [MS00-031](http://technet.microsoft.com/security/bulletin/ms00-031)と [MS00-044](http://technet.microsoft.com/security/bulletin/ms00-044)で説明されている脆弱性も排除します。

**ではこの更新プログラムを適用した場合、マイクロソフトセキュリティ情報** **MS00-031** **と** **MS00-044** **で供給されている更新プログラムは必要ないのですか?**

その通りです。しかし、これら全ての脆弱性を排除する最も良い方法は .HTR を無効にすることです。そうした場合、.HTR に関する更新プログラムを将来適用する必要もありません。

**どこから更新プログラムを入手できますか?**

マイクロソフト セキュリティ情報MS01-004 をご覧ください。

**この更新プログラムはどのように使用するのですか?**

サポート技術情報 [285985](http://support.microsoft.com/kb/285985) には、お客様のサイトに更新プログラムを提供するための詳細な情報が記載されています。

**この問題に対してマイクロソフトはどのような対応をしていますか?**

-   マイクロソフトは、この脆弱性を排除する更新プログラムを開発しました。
-   マイクロソフトは、セキュリティ上の脆弱性の詳細とその対策をお客様にご理解いただくために、セキュリティ情報 MS01-004 と、この faq を提供しています。
-   マイクロソフトは、マイクロソフト社の最新のセキュリティ情報を無料でご購読いただける[マイクロソフト プロダクト セキュリティ 警告サービス](http://technet.microsoft.com/ja-jp/security/dd252948.aspx) にて、購読の登録をされているお客様に、セキュリティ情報の通知を行っています。
-   マイクロソフトは、[285985](http://support.microsoft.com/kb/285985) を公開し、このセキュリティ上の脆弱性と更新プログラムの詳細と説明しています。

**推奨するセキュリティ設定の詳細情報はどこで入手できますか?**

マイクロソフトが提供するセキュリティ情報の詳細は、弊社の[セキュリティ](http://technet.microsoft.com/ja-jp/security/default.aspx)の Web サイトから入手してください。

**テクニカルサポートを受けるにはどこに問い合わせればよいですか?**

マイクロソフトの製品に関するテクニカルサポートは、[電話番号とサポートオプションのサイト](http://support.microsoft.com/gp/cntactms)を参照してください。

更新プログラム
--------------

<span></span>
上に記載されているように、この脆弱性を排除するのに推奨される方法は .HTR を無効にしておくことです。(.HTR を無効にする方法に関しては FAQ をご覧ください。) この .HTR 機能を今後もご使用になるお客様は、下の更新プログラムを適用する必要があります。

-   Internet Information Server 4.0:
    この問題に対する更新プログラムは Windows NT 4.0 のセキュリティ ロールアップ パッケージ (SRP) に含まれています。
    個別の更新プログラムよりもセキュリティ ロールアップ パッケージを適用することをお勧めします。
    NT 4.0 のセキュリティ ロールアップ パッケージは次のリンクから入手してください。

    [299444](http://support.microsoft.com/kb/299444) Post Windows NT 4.0 SP6a セキュリティ ロールアップ パッケージ (SRP)

    なお、個別の更新プログラムは次のリンクから入手することができます。
    [http://www.microsoft.com/downloads/details.aspx?FamilyId=A8270ADC-A836-4B32-A7AF-9E7BE14845A5&displaylang=ja](http://www.microsoft.com/downloads/details.aspx?familyid=a8270adc-a836-4b32-a7af-9e7be14845a5&displaylang=ja)

-   Internet Information Services 5.0:
    この問題に対する修正は Windows 2000 Service Pack 3 以降に含まれています。Windows 2000 日本語版の最新の Service Pack は、以下の Web サイトから入手できます。
    [http://www.microsoft.com/downloads/details.aspx?FamilyID=dc27b8c6-2a5a-4399-ad3d-4a97a25f41d9&DisplayLang=ja](http://www.microsoft.com/downloads/details.aspx?familyid=dc27b8c6-2a5a-4399-ad3d-4a97a25f41d9&displaylang=ja)
    なお、個別の更新プログラムは以下の Web サイトから入手できます。
    [http://www.microsoft.com/downloads/details.aspx?FamilyId=04FAB0BC-D950-4E64-8672-2731756B72FE&displaylang=ja](http://www.microsoft.com/downloads/details.aspx?familyid=04fab0bc-d950-4e64-8672-2731756b72fe&displaylang=ja)

**注** **:**
この更新プログラムは、マイクロソフト セキュリティ情報 [MS00-031](http://technet.microsoft.com/security/bulletin/ms00-031) と [MS00-044](http://technet.microsoft.com/security/bulletin/ms00-044)で説明されている脆弱性も排除します。

#### 更新プログラムに関する追加情報

**対象プラットフォーム** **:**

-   IIS 4.0 用更新プログラムは Windows NT 4.0 Service Packs 4、5 および 6a を動作しているシステムにインストールすることができます。
-   IIS 5.0 用更新プログラムは Windows 2000、Service Packs 1 および 2 を動作しているシステムにインストールすることができます。

**今後リリースされるサービスパックに含まれる更新プログラム** **:**

-   IIS 4.0 に関する問題用の更新プログラムは NT4.0 セキュリティ ロールアップ パッケージ (Post SP6a) に含まれています。
-   IIS 5.0に関する問題用の更新プログラムは Windows 2000 Service Pack 3 に含まれています。

**更新プログラムのインストール確認** **:**

-   IIS 4.0:
    -   この更新プログラムがマシンにインストールされたことを確認するためには、マシンに次のレジストリ キーが作成されたことを確認して下さい。
        HKEY\_LOCAL\_MACHINE\\software\\Microsoft\\Windows NT\\CurrentVersion\\Hotfix\\Q285985
    -   各ファイルを確認するためには、サポート技術情報 JP285985 のファイル欄を参照して下さい。
-   IIS 5.0 :
    -   この更新プログラムがマシンにインストールされたことを確認するためには、マシンに次のレジストリ キーが作成されたことを確認して下さい。
        HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Updates\\Windows 2000\\SP3\\Q285985
    -   各ファイルを確認するためには、次のレジストリ キーで、日付、時間そしてバージョン情報を参照して下さい。
        HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Updates\\Windows 2000\\SP3\\Q285985\\Filelist

**警告** **:**
マイクロソフトは IIS で .HTR マッピングを無効にすることを強く推奨します。理由はこの更新プログラムのインストールに望ましいためです。ビジネス上 .HTR が必須である場合のみ、この機能を使用して下さい。

**他のセキュリティ更新プログラムの入手先** **:**
他のセキュリティ問題を解決する更新プログラムは以下のサイトから入手できます。

-   セキュリティ更新プログラムはマイクロソフト [ダウンロード センター](http://support.microsoft.com/search/)からダウンロードすることができます。「security\_patch」のキーワード検索によって容易に見つけることができます。
-   コンシューマ プラットフォーム用の更新プログラムは、[Microsoft Update](http://update.microsoft.com/microsoftupdate/)Web サイトからダウンロードできます。

更新プログラムについてのご質問は、マイクロソフト プロダクト サポート までご連絡ください。マイクロソフトでは、ご質問の内容が弊社製品の不具合が原因の場合、サポート料金はいただきません。それ以外の場合には、サポート料金を請求させていただきますのでご注意ください。
[マイクロソフト プロダクト サポートへの連絡方法はこちらをご覧ください。](http://www.microsoft.com/japan/security/support/patchqa.mspx)

### その他の情報

**詳細情報** **:**

-   US マイクロソフトセキュリティ情報（MS01-004）
    [http://www.microsoft.com/technet/security/bulletin/ms01-004.mspx](http://technet.microsoft.com/security/bulletin/ms01-004)
-   サポート技術情報 （KB） 文書番号 ： 285985
    [\[IIS\] .HTR 経由のファイル フラグメントの読み取りの脆弱性の対策](http://support.microsoft.com/kb/285985)

**更新履歴** **:**

-   2001/1/30: このセキュリティ情報ページを公開しました。
-   2001/3/6: この問題に対する日本語版 KB を公開しました。

本セキュリティ情報に含まれている情報は、いかなる保証もない現状ベースで提供されるものです。Microsoft Corporation 及びその関連会社は、市場性および特定の目的への適合性を含めて、明示的にも黙示的にも、一切の保証をいたしません。さらに、Microsoft Corporation 及びその関連会社は、本文書に含まれている情報の使用及び使用結果につき、正確性、真実性等、いかなる表明・保証も行ないません。Microsoft Corporation、その関連会社及びこれらの権限ある代理人による口頭または書面による一切の情報提供またはアドバイスは、保証を意味するものではなく、かつ上記免責条項の範囲を狭めるものではありません。Microsoft Corporation、その関連会社 及びこれらの者の供給者は、直接的、間接的、偶発的、結果的損害、逸失利益、懲罰的損害、または特別損害を含む全ての損害に対して、状況のいかんを問わず一切責任を負いません。（Microsoft Corporation、その関連会社 またはこれらの者の供給者がかかる損害の発生可能性を了知している場合を含みます。) 結果的損害または偶発的損害に対する責任の免除または制限を認めていない地域においては、上記制限が適用されない場合があります。  

*Built at 2014-04-18T01:50:00Z-07:00*
