---
TOCTitle: 'MS02-037'
Title: 'マイクロソフト セキュリティ情報 MS02-037 - 警告'
ms:assetid: 'ms02-037'
ms:contentKeyID: 61228462
ms:mtpsurl: 'https://technet.microsoft.com/ja-JP/library/ms02-037(v=Security.10)'
---

マイクロソフト セキュリティ情報 MS02-037 - 警告
===============================================

SMTP クライアント EHLO コマンドへのサーバー応答で、バッファ オーバーランが発生する (326322)
-------------------------------------------------------------------------------------------

公開日: 2002年7月25日 | 最終更新日: 2002年8月15日

#### 概要 :

**このセキュリティ情報の対象となるユーザー** **:**
Microsoft® Exchange Server 5.5 を使用しているシステム管理者

**脆弱性の影響** **:**
任意のコードが実行される

**最大深刻度** **:**
中

**推奨する対応策** **:**
システム管理者はこの更新プログラムを適用することを検討してください。

**影響を受けるソフトウェア** **:**

-   Microsoft Exchange Server 5.5

### 詳細

問題
----

<span></span>
**技術的な説明** **:**
Internet Mail Connector (IMC) により、Microsoft Exchange Server が SMTP を介してほかのメール サーバーと通信できるようになります。IMC が接続する SMTP サーバーから SMTP 拡張 Hello (EHLO) プロトコル コマンドを受信すると、IMC は次の文字列で始まる状態応答を送信し、応答します。

250-&lt;Exchange server ID&gt;Hello&lt;Connecting server ID&gt;

-   &lt;Exchange server ID&gt; は、Exchange サーバーの完全修飾ドメイン名 (FQDN)。
-   &lt;Connecting server ID&gt; は、接続したサーバーの FQDN または IP アドレスのいずれか。Exchange5.5 IMC がこのIP アドレスを DNS 逆引き参照で解決できる場合、FQDN が使用される可能性があります。また DNS 逆引き参照で接続するサーバーの IP アドレスを解決することができない、またはそれに失敗した場合、その IP アドレスが使用される可能性があります。

EHLO プロトコル コマンドへの応答を生成する IMC コードに未チェックのバッファが含まれるためにセキュリティ上の脆弱性が発生します。メッセージの長さの合計が、ある特定の値を越える場合、そのデータによりバッファのオーバーランが発生します。ランダム データによりバッファがオーバーランした場合、IMC が異常終了する結果となる可能性があります。しかし、綿密に選択されたデータによりバッファのオーバーランが発生した場合、攻撃者は、IMC のセキュリティ コンテキスト （Exchange5.5 サービス アカウントとして実行されます） でコードを実行する可能性があります。

攻撃者は、単に IMC へデータを送信するだけでは、バッファ オーバーランを発生させることはできません。その代わり、攻撃者は、IMC が EHLO 応答を生成する際に、IMC 自体のバッファをオーバーランさせるような状況を作りだす必要があります。具体的には、DNS 逆引き参照を悪用するだけでなく、ある長さ以上の FQDN が使用される必要があります。

**問題を緩和する要素** **:**

-   IMC の DNS 逆引き参照の悪用を成功させるだけでなく、バッファのオーバーランを発生させる環境を作り出すのは困難です。攻撃者は、不正な DNS サーバーをセットアップし、そのサーバーに手動で不正な FQDN 情報を入力する可能性があります。しかしこれには、DNS 逆引き参照が実行される際に IMC に不正な DNS サーバーを強制的に参照させる手段を攻撃者が持っていることが必要となります。
-   IMC は、SMTP サポートが必要でない場合には、無効にすることができます。IMC が無効にされている場合、この脆弱性が悪用されることはありません。
-   [190026](http://support.microsoft.com/kb/190026) に記載されているように、レジストリ キーを設定し、EHLO の DNS 逆引き参照を無効にすることができます。その方法で構成したシステム上では、この脆弱性が悪用されることはありません。
-   バッファのオーバーランによって IMC が異常終了した場合、Exchange 5.5 IMC サービスを再開することによって、IMC の通常のサービスを再開することができます。

**深刻度** **:**

|                      | インターネット サーバー | イントラネット サーバー | クライアント システム |
|----------------------|-------------------------|-------------------------|-----------------------|
| **Exchange 5.5 SP4** | 中                      | 中                      | なし                  |

上記の[評価](http://www.microsoft.com/japan/technet/security/policy/rating1.mspx)はこの脆弱性の影響を受けるシステムの種類、システムの典型的な展開形式およびこの脆弱性がシステムに及ぼす影響に基づいています。この脆弱性の悪用は困難であるため、マイクロソフトはこの脆弱性の深刻度を 「中」 としました。

**脆弱性識別番号** **:**
[CAN-2002-0698](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=can-2002-0698)

**テストしたバージョン** **:**
マイクロソフトは Exchange 2000 および Exchange 5.5 のテストを行い、これらの脆弱性による影響を評価しました。それより前のバージョンに関しては[サポート](http://support.microsoft.com/lifecycle/)の対象となっていないため、この脆弱性による影響は不明です。

よく寄せられる質問
------------------

<span></span>
**どのようなことが起こる可能性がありますか?**

これは、[バッファ オーバーラン](http://www.microsoft.com/japan/security/glossary.mspx)の脆弱性です。最悪の場合、攻撃者はこの脆弱性を悪用し、影響を受ける Exchange サーバーを完全に制御する可能性があります。起こる可能性がより高い例では、攻撃者は Exchange サーバーを異常終了させる可能性があります。

攻撃者がこの脆弱性を悪用するのは困難です。ほとんどの場合、この脆弱性を悪用するためには、攻撃者はこの脆弱性の影響を受けるメール サーバーに接続するだけでなく、攻撃中にサーバーが、攻撃者の選択した DNS サーバーを参照することが必要条件となります。

**何が原因で起こりますか?**

拡張 Hello コマンドへ応答する Exchange 5.5 Internet Mail Connector 内のコードに未チェックのバッファが存在します。以下で説明するような状況下で、バッファのオーバーランが発生する可能性があります。

**Internet Mail Connector** **とは何ですか?**

Internet Mail Connector (IMC) は、Exchange がメール サーバーと相互運用することができるようにする Exchange Server のコンポーネントです。Exchange は、次の 2 つのプロトコルのいずれかを使用して、ほかのメール サーバーと通信することができます。ほかの Exchange サーバーと通信する際に使用される専用プロトコルおよび[Simple Message Transfer Protocol](http://www.ietf.org/rfc/rfc2821.txt) (SMTP) （英語情報） があります。SMTP は、サードパーティのサーバーと通信する際に使用される業界標準のプロトコルです。IMC は Exchange の一部で、SMTP を介した通信を処理します。Exchange IMC は、既定でインストールされません。Exchange Server Internet Mail Service と呼ばれることもあります。

**拡張** **Hello** **コマンドとは何ですか?**

拡張 Hello (EHLO) コマンドに関してご説明するために、まず SMTP サービス拡張に関してご説明します。SMTP プロトコルでは基本的なメール操作を指定しますが、SMTP 拡張と呼ばれる、多くのメール サーバーがサポートするサービスと機能があります。これは、[RFC 1869](http://www.ietf.org/rfc/rfc1869.txt) (英語情報) で定義されています。SMTP ベースの 2 つのメール サーバーが通信を開始する際、接続を開始するサーバーがほかのメール サーバーがサポートする SMTP サービス拡張がある場合、それを認識することが重要となります。EHLO コマンドは、このプロセスの一部です。2 つのサーバー間のメッセージの交換は、以下のように行われます。

1.  Server 1 がServer 2 への接続を確立します。
2.  Server 2 は "バナー" を送信します。
3.  Server 1 は EHLO を送信し、Server 2 がSMTP 拡張をサポートするかどうか確認します。
4.  Server 2 が EHLO をサポートする場合、Server 2 はEHLO に応答します。
5.  Server 1 は Server 2 にリクエストを送信し始めます。

**Exchange 5.5 IMC** **の** **EHLO** **コマンドが実装される方法の何が問題になっていますか?**

IMC は、送信される EHLO コマンドを適切に処理します。しかし、IMC が応答を形式化するために使用するソフトウェアに、未チェックのバッファが含まれます。この応答は具体的には、上記の質問のステップ 4 で、応答を作成するために使用されるコードです。攻撃者によって Hello コマンドへの応答が、IMC のバッファをオーバーランさせるデータを生成するシナリオを実行される可能性があります。 （しかし、これはかなり複雑なプロセスです）

**攻撃者はこの脆弱性により何をすることができますか?**

多くのバッファ オーバーランの攻撃と同様に、この場合も2 つの目的のいずれかを果たすために攻撃者が悪用する可能性があります。これらの目的は入力されるデータによって異なります。ランダム データによりバッファがオーバーランした場合、IMC が異常終了する可能性があります。一方、綿密に作成されたデータによりバッファのオーバーランが発生した場合、基本的には、IMC プロセスを変更し、攻撃者の任意の操作が実行される恐れがあります。IMC はシステムレベルの権限で実行されるため、これにより攻撃者はサーバーを制御できるようになる可能性があります。

**攻撃者はどのようにしてこの脆弱性を悪用するのですか?**

この脆弱性を悪用するのは、論理上は単純です。攻撃者は脆弱性の悪用に適する環境を作り、この脆弱性の影響を受ける Exchange 5.5 IMC に接続し、EHLO コマンドを送信することによって攻撃を開始します。しかし、この攻撃に適する環境を作るのは非常に困難です。

**「この攻撃に適する環境」 とはどのようなものですか?**

IMC が EHLO コマンドに応答する際、IMC は上記で説明したように、両方のサーバーを認識する最初の応答を作成します。IMC は完全修飾ドメイン名 (FQDN) (例 : "mailserver.microsoft.com") を使用して IMC 自体を認識します。IMC は状況に応じて IP アドレス、または FQDN のいずれかによってもう一方のサーバーを認識します。

以下の条件に当てはまる場合、「この攻撃に適する環境」 を意味します。

-   IMC がもう一方のサーバーの FQDN を認識する場合
-   IMC 自体の FQDN の長さおよびもう一方のサーバーの FQDN の長さがある特定の値を超える場合

これらの条件に当てはまる場合、IMC がバッファのオーバーランを発生する恐れがあり、その結果 IMC が異常終了する可能性があります。IMC がそれ自体のバッファをオーバーランさせ、攻撃者の望むコードが実行されるためには、別の条件が必要となります。つまり、もう一方のサーバーの FQDN に実行可能なコードが含まれていることが必要条件となります。

**IMC** **がもう一方のサーバーの** **IP** **アドレスまたは** **FQDN** **を使用するかどうかはどのように決定されますか?**

IMC は常に、もう一方のサーバーの FQDN を使用しようとします。しかし、このためには DNS 逆引き参照を行う必要があります。つまり、IMC は DNS サーバーを参照し、IP アドレスをサーバーに入力し、それに対応する FQDN を応答として受け取る必要があります。DNS 逆引き参照が何らかの理由で、失敗した場合、IMC は IP アドレスを使用するため、これによりバッファのオーバーランが発生する可能性はありません。

**攻撃者が** **DNS** **逆引き参照を成功させるのはどのくらい困難ですか?**

攻撃者は、近くの DNS サーバーへ不正なデータを送信し、そのデータがこの脆弱性の影響を受けるメールサーバーが使用している DNS サーバーへ伝搬するのを待つ必要があります。しかし、これには障害があります。該当の[業界標準](http://www.ietf.org/rfc/rfc1034.txt) （英語情報） では、FQDN の長さの限度が優先され、ほとんどの場合、この値はバッファをオーバーランさせるのに必要な長さよりも小さくなります。このように、標準に対応した DNS サーバーは、不正なデータを受信しない可能性が高いと言えます。

その代わり、攻撃者は、DNS サーバーをセットアップし、手動で不正なデータを入力する必要があります。しかし、これは、攻撃者はこの脆弱性の影響を受ける IMC が攻撃者の DNS サーバーを参照したことを確認する必要があることを意味します。このため、この脆弱性を悪用するのは、非常に困難であることは明らかであると言えます。

**DNS** **逆引き参照を無効にすることはできますか?**

EHLO の DNS 逆引き参照は [190026](http://support.microsoft.com/kb/190026) に記載されているように、レジストリ キーを設定することで無効にすることができます。この対策を講じたお客様は、バッファ オーバーランの攻撃から保護されます。

DNS 逆引き参照を無効にした場合、Internet Mail Service は SMTP メッセージ ヘッダの "Received From" の部分にあるホスト名を完全修飾ドメイン名へ解決しなくなりますが、その代わり nnn.nnn.nnn.nnn という形式の Internet Protocol (IP) を使用します。アドレスが、既に Internet Protocol (IP) の形式である場合、アドレスはそのままになります。

**この脆弱性は** **Exchange 2000** **に影響を及ぼしますか?**

いいえ、Exchange 2000には影響ありません。

**この脆弱性は、Windows 2000** **に同梱される** **SMTP** **サービスに影響を及ぼしますか?**

いいえ、影響ありません。

**この更新プログラムはどのようにこの脆弱性を排除しますか?**

この更新プログラムは、Exchange 5.5 IMC コードでのバッファの処理が適切に行われるようにします。

更新プログラム
--------------

<span></span>
この問題に対する日本語版更新プログラムは、次のサイトからダウンロードできます。

-   Microsoft Exchange 5.5 Service Pack 4:
    <http://www.microsoft.com/japan/exchange/previous/downloads/55/sp4/default.mspx>

#### 更新プログラムに関する追加情報

**対象プラットフォーム** **:**
この更新プログラムは Microsoft Exchange 5.5 [Service Pack 4](http://www.microsoft.com/japan/exchange/previous/downloads/55/sp4/default.mspx) を実行しているシステムにインストールすることができます。

**この修正を含む予定のサービス パック** **:**
なし

**再起動の必要性** **:**
なし

**更新プログラムのアンインストール** **:**
可

**更新プログラムに含まれる過去の修正** **:**
なし

**更新プログラムが正しくインストールされたか確認する方法** **:**

-   この更新プログラムがマシンにインストールされたことを確認するためには、マシンに次のレジストリ キーが作成されたことを確認して下さい。

    HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Updates\\Exchange Server 5.5\\SP5\\Q326322
-   各ファイルを確認するためには、次のレジストリ キーで、日付、時間そしてバージョン情報を参照して下さい。

    HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Updates\\Exchange Server 5.5\\SP5\\Q326322\\Filelist

**警告** **:**
なし

**他のセキュリティ更新プログラムの入手先** **:**
他のセキュリティ問題を解決する更新プログラムは以下のサイトから入手できます。

-   セキュリティ更新プログラムはマイクロソフト [ダウンロード センター](http://www.microsoft.com/downloads/results.aspx?displaylang=ja&freetext=security_patch)からダウンロードすることができます。「security\_patch」 のキーワード検索によって容易に見つけることができます。
-   コンシューマ プラットフォーム用の更新プログラムは、[Microsoft Update](http://update.microsoft.com/microsoftupdate/)Web サイトからダウンロードできます。

更新プログラムについてのご質問は、マイクロソフト プロダクト サポート までご連絡ください。マイクロソフトでは、ご質問の内容が弊社製品の不具合が原因の場合、サポート料金はいただきません。それ以外の場合には、サポート料金を請求させていただきますのでご注意ください。

[マイクロソフト プロダクト サポートへの連絡方法はこちらをご覧ください。](http://www.microsoft.com/japan/security/support/patchqa.mspx)

### その他の情報

**詳細情報** **:**

-   US マイクロソフトセキュリティ情報（MS02-037）

    [http://www.microsoft.com/technet/security/bulletin/ms02-037.mspx](http://technet.microsoft.com/security/bulletin/ms02-037)
-   サポート技術情報 （KB） 文書番号 ： 326322
    [\[MS02-037\] SMTP クライアント EHLO コマンドへのサーバーの応答でバッファ オーバーランが発生する](http://support.microsoft.com/kb/326322)

**更新履歴** **:**

-   2002/7/25: このセキュリティ情報ページを公開しました。
-   2002/7/26: このセキュリティ情報を更新し、更新プログラムのアンインストールが可能であることをお知らせしました。
-   2002/8/15: この問題に対する日本語版 KB を公開しました。

本セキュリティ情報に含まれている情報は、いかなる保証もない現状ベースで提供されるものです。Microsoft Corporation 及びその関連会社は、市場性および特定の目的への適合性を含めて、明示的にも黙示的にも、一切の保証をいたしません。さらに、Microsoft Corporation 及びその関連会社は、本文書に含まれている情報の使用及び使用結果につき、正確性、真実性等、いかなる表明・保証も行ないません。Microsoft Corporation、その関連会社及びこれらの権限ある代理人による口頭または書面による一切の情報提供またはアドバイスは、保証を意味するものではなく、かつ上記免責条項の範囲を狭めるものではありません。Microsoft Corporation、その関連会社 及びこれらの者の供給者は、直接的、間接的、偶発的、結果的損害、逸失利益、懲罰的損害、または特別損害を含む全ての損害に対して、状況のいかんを問わず一切責任を負いません。（Microsoft Corporation、その関連会社 またはこれらの者の供給者がかかる損害の発生可能性を了知している場合を含みます。) 結果的損害または偶発的損害に対する責任の免除または制限を認めていない地域においては、上記制限が適用されない場合があります。

*Built at 2014-04-18T01:50:00Z-07:00*
